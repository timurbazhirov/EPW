<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    		<meta name="keywords" content="Printable Quantum-Espresso Documentation,Running on parallel machines,Installation,Performance issues (PWscf),Developer Manual,Fhi2upf.x,Ld1.x,Main Page,Methodological Background,Naming convention for the pseudopotential,Unified pseudopotential format" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/wiki/opensearch_desc.php" title="QuantumEspresso (English)" />
    <title>Printable Quantum-Espresso Documentation - QuantumEspresso</title>
    <style type="text/css" media="screen,projection">/*<![CDATA[*/ @import "/wiki/skins/monobook/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="/wiki/skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "/wiki/skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "/wiki/skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if gte IE 6]><style type="text/css">@import "/wiki/skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="/wiki/skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="/wiki/index.php?title=-&amp;action=raw&amp;gen=js"></script>    <script type="text/javascript" src="/wiki/skins/common/wikibits.js"></script>
    <style type="text/css">/*<![CDATA[*/
@import "/wiki/index.php?title=MediaWiki:Common.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "/wiki/index.php?title=MediaWiki:Monobook.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "/wiki/index.php?title=-&action=raw&gen=css&maxage=18000";
/*]]>*/</style>              </head>
  <body                 class="ns-0">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <div id="bodyContent">
	    <div id="contentSub"></div>
	    	    	    <!-- start content -->

<a name="Introduction"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Introduction&amp;action=edit&amp;section=1" title="Introduction">edit</a>]</span> <span class="mw-headline">Introduction</span></h2>
<p>This guide covers the installation and usage of Quantum-ESPRESSO (opEn-Source Package for Research in Electronic Structure, Simulation, and Optimization).
</p><p>The Quantum-ESPRESSO distribution contains the following packages for the calculation of electronic-structure properties within
Density-Functional Theory, using a Plane-Wave basis set and pseudopotentials:
</p>
<ul><li> PWscf (Plane-Wave Self-Consistent Field)
</li><li> CP (Car-Parrinello)
</li></ul>
<p>and the following auxiliary packages:
</p>
<ul><li> PWgui (Graphical User Interface for PWscf): a graphical interface for producing input data files for PWscf.
</li><li> atomic: a program for atomic calculations and generation of pseudopotentials.
</li><li> iotk: an Input-Output ToolKit.&lt;/li&gt;
</li></ul>
<p>The Quantum-ESPRESSO codes work on many different types of Unix machines, including parallel machines using Message Passing Interface (MPI).
Running Quantum-ESPRESSO on Mac OS X and MS-Windows is also possible: see the <a href="/wiki/index.php/Installation" title="Installation">Installation</a> section of this guide.
</p><p>Further documentation, beyond what is provided in this guide, can be found in:
</p>
<ul><li> the other Quantum-Espresso Wiki pages, accessible via the <a href="/wiki/index.php/Main_Page" title="Main Page">Main Page</a>.
</li><li> the Doc/ directory of the Quantum-ESPRESSO distribution. In particular the INPUT_*.html and INPUT_*.pdf files contain the detailed listing of available input variables and cards.
</li><li> the Pw_forum mailing list (pw_forum@pwscf.org). You can subscribe to this list and browse and search its archives from the PWscf web site (<a href="http://www.pwscf.org" class="external free" title="http://www.pwscf.org" rel="nofollow">http://www.pwscf.org</a>). Only subscribed users can post. Please search the archives before posting: your question may have already been answered.&lt;/li&gt;<br />
</li><li> the “Scientific Software” page of the Democritos web site (<a href="http://www.democritos.it/scientific.php" class="external free" title="http://www.democritos.it/scientific.php" rel="nofollow">http://www.democritos.it/scientific.php</a>)
</li></ul>
<p>This guide does not explain solid state physics and its computational methods. If you want to learn that, read a good textbook, or consult the <a href="/wiki/index.php/Methodological_Background" title="Methodological Background">Methodological Background</a> section.
</p>
<a name="Codes"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Introduction&amp;action=edit&amp;section=2" title="Introduction">edit</a>]</span> <span class="mw-headline">Codes</span></h2>
<p>PWscf can currently perform the following kinds of calculations:
</p>
<ul><li> ground-state energy and one-electron (Kohn-Sham) orbitals
</li><li> atomic forces, stresses, and structural optimization
</li><li> molecular dynamics on the ground-state Born-Oppenheimer surface, also with variable-cell
</li><li> Nudged Elastic Band (NEB) and Fourier String Method Dynamics (SMD) for energy barriers and reaction paths
</li><li> phonon frequencies and eigenvectors at a generic wave vector, using Density-Functional Perturbation Theory
</li><li> effective charges and dielectric tensors
</li><li> electron-phonon interaction coefficients for metals
</li><li> interatomic force constants in real space
</li><li> third-order anharmonic phonon lifetimes
</li><li> Infrared and Raman (nonresonant) cross section
</li><li> macroscopic polarization and finite electric fields via Berry Phase
</li></ul>
<p>All of the above works for both insulators and metals, in any crystal structure, for many exchange-correlation functionals (including spin polarization, LDA+U, exact exchange), 
for both norm-conserving (Hamann-Schluter-Chiang) pseudopotentials in separable form, 
and --- with very few exceptions --- for Ultrasoft (Vanderbilt) pseudopotentials. The 
Projector Augmented Waves (PAW) method is implemented --- with the exception of linear 
response --- since v.4.0. Non-collinear magnetism and spin-orbit interactions are also implemented.  
Finite electric fields are implemented in both the supercell and the “modern theory of polarization” approaches. Various postprocessing and data analysis programs are available.
</p><p>CP can currently perform the following kinds of calculations:
</p>
<ul><li> Car-Parrinello molecular dynamics simulation (neutral and charged cases)
</li><li> Geometry optimization by damped dynamics
</li><li> Constant-temperature simulation with Nos&egrave; thermostats (including Nos&egrave;-Hoover chains for each atom)
</li><li> Variable-cell (Parrinello-Rahman) dynamics
</li><li> Nudged Elastic Band (NEB) for energy barriers and reaction path
</li><li> Dynamics with Wannier functions and under finite electric fields
</li></ul>
<p>All of the above works for many exchange-correlation functionals 
(including spin polarization, LDA+U, SIC for some specific systems,
meta-GGA), for both norm-conserving and Ultrasoft (Vanderbilt) pseudopotentials. Only systems described by the Gamma point are
allowed, but there is an implementation of dynamics for metals using  conjugate-gradient algorithms.
</p>
<a name="People"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Introduction&amp;action=edit&amp;section=3" title="Introduction">edit</a>]</span> <span class="mw-headline">People</span></h2>
<p>In the following, the cited affiliation is the one where the last known 
contribution was done and may no longer be valid.
</p><p>The maintenance and further development of the Quantum-ESPRESSO code
is promoted by the DEMOCRITOS National Simulation Center of INFM
(Italian Institute for Condensed Matter Physics) under the coordination of
Paolo Giannozzi (Univ.Udine, Italy), with the strong support
of the CINECA National Supercomputing Center in Bologna under the responsibility of Carlo Cavazzoni.
</p><p>The PWscf package was originally developed by Stefano Baroni, Stefano
de Gironcoli, Andrea Dal Corso (SISSA), Paolo Giannozzi, and many others.
We quote in particular:
</p>
<ul><li> Matteo Cococcioni (MIT) for DFT+U implementation.
</li><li> Oswaldo Dieguez (Rutgers) for Berry’s phase calculations.
</li><li> Michele Lazzeri (Paris VI) for the 2n+1 code and Raman cross section calculation with 2nd-order response.
</li><li> Ralph Gebauer (ICTP, Trieste) and Adriano Mosca Conte (SISSA, Trieste) for noncolinear magnetism.
</li><li> Carlo Sbraccia (Princeton) for NEB, Strings method, Metadynamics, for the improvements to structural optimization and to many other parts of the code.
</li><li> Alexander Smogunov (SISSA) for ballistic conductance.
</li><li> Paolo Umari (Democritos) for finite electric fields.
</li><li> Renata Wentzcovitch (Univ.Minnesota) for variable-cell molecular dynamics.
</li><li> Davide Ceresoli (SISSA), Ari Seitsonen, U. Gerstmann, Francesco Mauri (Univ.Paris VI) for GIPAW (NMR chemical shifts and EPR g-tensor)
</li><li> Lorenzo Paulatto (SISSA) for PAW implementation, built upon previous work by Guido Fratesi (Univ.Milano Bicocca) and Riccardo Mazzarello (SISSA)
</li></ul>
<p>The CP code is based on the original code written by Roberto Car and
Michele Parrinello. CP was developed by Alfredo Pasquarello (IRRMA, Lausanne),
Kari Laasonen (Oulu), Andrea Trave, Roberto Car (Princeton), 
Nicola Marzari (MIT), Paolo Giannozzi, and others.
FPMD, later merged with CP, was developed by Carlo Cavazzoni, 
Gerardo Ballabio (CINECA), Sandro Scandolo (ICTP), 
Guido Chiarotti (SISSA), Paolo Focher, and others.
We quote in particular:
</p>
<ul><li> Carlo Sbraccia (Princeton) for NEB and Metadynamics.
</li><li> Manu Sharma (Princeton) and Yudong Wu (Princeton) for maximally localized Wannier functions and dynamics with Wannier functions.
</li><li> Paolo Umari (MIT) for finite electric fields and conjugate gradients.
</li><li> Paolo Umari and Ismaila Dabo (MIT) for ensemble-DFT.
</li><li> Xiaofei Wang (Princeton) for META-GGA.
</li><li> The Autopilot feature was implemented by Targacept, Inc.
</li></ul>
<p>Other relevant contributions to Quantum-Espresso:
</p>
<ul><li> Gerardo Ballabio wrote "configure" for Quantum-Espresso.
</li><li> PWgui was written by Anton Kokalj (IJS Ljubljana) and is based on his GUIB concept (<a href="http://www-k3.ijs.si/kokalj/guib/" class="external free" title="http://www-k3.ijs.si/kokalj/guib/" rel="nofollow">http://www-k3.ijs.si/kokalj/guib/</a>).
</li><li> The pseudopotential generation package "atomic" was written by Andrea Dal Corso and it is the result of many additions to the original code by Paolo Giannozzi and others.
</li><li> The input/output toolkit <i>iotk</i> (<a href="http://www.s3.infm.it/iotk" class="external free" title="http://www.s3.infm.it/iotk" rel="nofollow">http://www.s3.infm.it/iotk</a>) used in Quantum-Espresso was written by Giovanni Bussi (ETHZ and S3 Modena).
</li><li> The calculation of the finite (imaginary) frequency molecular polarizability using the approximated Thomas-Fermi  + von Weizaecker scheme was contributed by Huy-Viet Nguyen (SISSA).
</li><li> The calculation of RPA frequency-dependent complex dielectric function was contributed by Andrea Benassi (S3 Modena).
</li><li> The interface with the Wannier90 code (<a href="http://www.wannier.org/" class="external free" title="http://www.wannier.org/" rel="nofollow">http://www.wannier.org/</a>) was written by A. Mostofi, J. Yates, Y.-S Lee (MIT).
</li><li> The BlueGene porting was done by Costas Bekas and Alessandro Curioni (IBM Zurich).
</li><li> Davide Ceresoli, Andrea Ferretti (S3), Guido Fratesi, Eyvaz Isaev (Moscow Steel and Alloy Inst), Axel Kohlmeyer (UPenn),Konstantin Kudin (Princeton), Sergey Lisenkov (Univ.Arkansas), Nicolas Mounet (MIT), Guido Roma (CEA), Pascal Thibaudeau (CEA), answered questions on the mailing list, found bugs, helped in porting to new architectures, wrote some code.
</li></ul>
<p>An alphabetical list of further contributors includes: Dario Alf&egrave;, Alain Allouche, 
Francesco Antoniella, Mauro Boero, Nicola Bonini, Claudia Bungaro, Matteo Calandra,
Paolo Cazzato, Gabriele Cipriani, Jiayu Dai, Cesar Da Silva, Alberto Debernardi, Gernot Deinzer, 
Martin Hilgeman,  Yosuke Kanai, Nicolas Lacorne, Stephane Lefranc, Kurt Maeder, Andrea Marini, 
Pasquale Pavone,  Mickael Profeta, Kurt Stokbro, Paul Tangney, Antonio Tilocca, Jaro Tobik, 
Malgorzata Wierzbowska, Silviu Zilberman, and let us apologize to everybody we have forgotten.
</p><p>This guide was mostly written by Paolo Giannozzi, Gerardo Ballabio and Carlo Cavazzoni.
</p>
<a name="Contacts"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Introduction&amp;action=edit&amp;section=4" title="Introduction">edit</a>]</span> <span class="mw-headline">Contacts</span></h2>
<p>The web site for Quantum-ESPRESSO is: <a href="http://www.quantum-espresso.org/" class="external free" title="http://www.quantum-espresso.org/" rel="nofollow">http://www.quantum-espresso.org/</a>.
Releases and patches of Quantum-ESPRESSO can be downloaded from this
site or following the links contained in it
(see also the PWscf web: <a href="http://www.pwscf.org/" class="external free" title="http://www.pwscf.org/" rel="nofollow">http://www.pwscf.org/</a>).
</p><p>Announcements about new versions of Quantum-ESPRESSO are available 
via a low-traﬃc mailing list Pw_users: (pw_users@pwscf.org). You can
subscribe (but not post) to this list from the PWscf web site.
</p><p>The recommended place where to ask questions about installation and
usage of Quantum-ESPRESSO, and to report bugs, is the Pw_forum mailing
list (pw_forum@pwscf.org). Here you can obtain help from the developers
and many knowledgeable users. You can browse and search its archive from 
the PWscf web site, but you have to subscribe in order to post to the list.
Please search the archives before posting: your question may have already
been answered.<br />
<b>Important notice:</b> only messages that appear to come from the 
registered user's e-mail address, in its <b>exact form</b>, will be
accepted. Messages "waiting for moderator approval" are automatically 
deleted with no further processing (sorry, too much spam). In case of 
trouble, carefully check that your return e-mail is the correct one 
(i.e. the one you used to subscribe).
</p><p>If you specifically need to contact the developers of Quantum-ESPRESSO
(and only them), write to developers. You find them at pwscf-dot-org (<b>notice</b>: the not-so-difficult riddle is needed to protect such
e-mail from spammers).
</p><p>Other pointers:
</p><p><b>DEMOCRITOS</b>: <a href="http://www.democritos.it/" class="external free" title="http://www.democritos.it/" rel="nofollow">http://www.democritos.it/</a><br />
<b>INFM</b>: <a href="http://www.infm.it/" class="external free" title="http://www.infm.it/" rel="nofollow">http://www.infm.it/</a><br />
<b>CINECA</b>: <a href="http://www.cineca.it/" class="external free" title="http://www.cineca.it/" rel="nofollow">http://www.cineca.it/</a><br />
<b>SISSA</b>: <a href="http://www.sissa.it/" class="external free" title="http://www.sissa.it/" rel="nofollow">http://www.sissa.it/</a><br />
</p>
<a name="Terms_of_use"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Introduction&amp;action=edit&amp;section=5" title="Introduction">edit</a>]</span> <span class="mw-headline">Terms of use</span></h2>
<p>Quantum-ESPRESSO is free software, released under the GNU General Public License 
(<a href="http://www.pwscf.org/License.txt" class="external free" title="http://www.pwscf.org/License.txt" rel="nofollow">http://www.pwscf.org/License.txt</a>, or the file License in the
distribution).
</p><p>All trademarks mentioned in this guide belong to their respective owners.
</p><p>We shall greatly appreciate if scientific work done using this code will contain 
an explicit acknowledgment and a reference to the Quantum-ESPRESSO
web page. We suggest these standard forms of citing Quantum-ESPRESSO in papers using the code:
</p><p>[SHORT] P. Giannozzi et al., <a href="http://www.quantum-espresso.org" class="external free" title="http://www.quantum-espresso.org" rel="nofollow">http://www.quantum-espresso.org</a>.
</p><p>[LONG] {\sc Quantum-ESPRESSO} is a community project for high-quality
quantum-simulation software, based on density-functional theory, and 
coordinated by Paolo Giannozzi. See <a href="http://www.quantum-espresso.org" class="external free" title="http://www.quantum-espresso.org" rel="nofollow">http://www.quantum-espresso.org</a>
and <a href="http://www.pwscf.org" class="external free" title="http://www.pwscf.org" rel="nofollow">http://www.pwscf.org</a>.
</p><p>Note the form {\sc Quantum-ESPRESSO} for textual citations of the code.
Pseudopotentials should be cited as
</p><p>[PSEUDO] We used the pseudopotentials C.pbe.rrjkus.UPF
and O.pbe.vbc.UPF from the <a href="http://www.quantum-espresso.org" class="external free" title="http://www.quantum-espresso.org" rel="nofollow">http://www.quantum-espresso.org</a> 
distribution.
</p><p><br />
Back to <a href="/wiki/index.php/Main_Page" title="Main Page">Main Page</a>
</p>
<a name="Download"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=1" title="Installation">edit</a>]</span> <span class="mw-headline">Download</span></h2>
<p>Presently, the Quantum-ESPRESSO package is only distributed in source form; some precompiled executables (binary files) are provided only for PWgui. Providing binaries would require too 
much eﬀort and would work only for a small number of machines anyway.
</p><p>Stable releases of the Quantum-ESPRESSO source package (current version is 4.0) can be downloaded from this URL: <a href="http://www.pwscf.org/download.htm" class="external free" title="http://www.pwscf.org/download.htm" rel="nofollow">http://www.pwscf.org/download.htm</a>.
</p><p>Uncompress and unpack the distribution using the command:
</p>
<pre>    tar zxvf espresso-4.0.tar.gz
</pre>
<p>(a hyphen before "zxvf" is optional). If your version of "tar" doesn’t recognize the "z" ﬂag:
</p>
<pre>    gunzip -c espresso-4.0.tar.gz | tar xvf -
</pre>
<p>A directory espresso-4.0/ , containing the distribution, will be created. 
Occasionally, patches for the current version, fixing some errors and bugs,
may be distributed as a "diff" file. In order to install a patch (for instance):
</p>
<pre>  cd espresso-4.0/
  patch -p1 &lt; /path/to/the/diff/file/espresso-4.0.1.diff
</pre>
<p>If more than one patch is present, they should be applied in the correct order.
</p><p>The bravest may access the (unstable) development version via anonymous CVS 
(Concurrent Version System): see the developer manual, section
<a href="/wiki/index.php/Developer_Manual#Using_CVS" title="Developer Manual">Developer_Manual#Using CVS</a>.
</p><p>Directory structure of the common part for all packages:
</p>
<pre> Modules/    Source file for modules that are common to all programs
 include/    files *.h included by fortran source files
 clib/       external libraries written in C
 flib/       external libraries written in Fortran
 install/    machine-dependent makefiles and tools for compilation and installation
 pseudo/     pseudopotential files used by examples
 upftools/   Source files for converters to unified pseudopotential format (UPF)
 examples/   Contains sample input and output files
 tests/      Contains automated tests (since v.4)
 Doc/        Documentation
</pre>
<p>Directory structure of the PWscf package:
</p>
<pre> PW/         Source files for scf calculations (pw.x)
 PP/         Source files for post-processing of pw.x data file
 PH/         Source files for phonon calculations (ph.x) and analysis programs
 Gamma/      Source files for Gamma-only phonon calculation (phcg.x)
 D3/         Source files for third-order derivative calculations (d3.x)
 PWCOND/     Source files for conductance calculations (pwcond.x)
 pwtools/    Source files for miscellaneous analysis programs
 vdW/        Source files for calculation of the molecular polarizability 
             at finite (imaginary) frequency using approximated Thomas-Fermi
             + von Weizacker scheme
</pre>
<pre> CPV/        Source files for Car-Parrinello code CP/FPMD
</pre>
<pre> atomic/     Source files for the pseudopotential generation package
 atomic_doc/ Documentation, tests and examples for the above
</pre>
<pre> iotk/       Input/Output Toolkit
</pre>
<pre> GUI/        Graphical User Interface (PWgui)
</pre>
<a name="Installation"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=2" title="Installation">edit</a>]</span> <span class="mw-headline">Installation</span></h2>
<p>To install Quantum-ESPRESSO from source, you need C and Fortran-95
compilers (Fortran-90 is not suﬃcient, but most “Fortran-90” compilers are
actually Fortran-95-compliant). If you don’t have a commercial Fortran-95
compilers, you may install the free g95 compiler: (<a href="http://www.g95.org/" class="external free" title="http://www.g95.org/" rel="nofollow">http://www.g95.org/</a>) or
the GNU fortran compiler gfortran: (<a href="http://www.gfortran.org/" class="external free" title="http://www.gfortran.org/" rel="nofollow">http://www.gfortran.org/</a>).
Note that both the C and the F90 compilers must be in your PATH, or else
their full path must be explicitly given.
</p><p>You also need a minimal Unix environment: basically, a command shell (e.g.,
bash or tcsh) and the utilities make, awk and sed. MS-Windows users need
to have Cygwin (a UNIX environment which runs under Windows) installed:
see <a href="http://www.cygwin.com/" class="external free" title="http://www.cygwin.com/" rel="nofollow">http://www.cygwin.com/</a>. Note that the scripts contained in the distribution
assume that the local  language is set to the standard, i.e. "C"; other settings 
may break them. Use
</p>
<pre>   export LC_ALL=C
</pre>
<p>or
</p>
<pre>   setenv LC_ALL C
</pre>
<p>to prevent any problem when running scripts (including installation scripts).
</p><p>Instructions for the impatient:
</p>
<pre>   cd espresso-4.0/
   ./configure
    make all
</pre>
<p>Executable programs (actually, symlinks to them) will be placed in the bin/
subdirectory.
</p><p>If you have problems or would like to tweak the default settings, read the
detailed instructions below.
</p>
<a name="Con.EF.AC.81gure"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=3" title="Installation">edit</a>]</span> <span class="mw-headline">Configure</span></h2>
<p>To configure the Quantum-ESPRESSO source package, run the configure script. It will (try to) detect compilers and libraries available on your machine, and set up things accordingly. Presently it is expected to work on most Linux 32- and 64-bit PCs (all Intel and AMD CPUs), PC clusters, IBM SP
machines, SGI Origin and Altix, some HP-Compaq Alpha machines, NEC SX, Cray X1, Mac
OS X, MS-Windows PCs. It may work with some assistance also on other architectures (see below).
</p><p>For cross-compilation, you have to specify the target machine with the --host option (see below). This feature has not been extensively tested, but we had at least one successful report (compilation for NEC SX6 on a PC).
</p><p>Specifically, configure generates the following files:
</p>
<pre>   make.sys:           compilation rules and ﬂags
   configure.msg:      a report of the configuration run
   include/fft_defs.h: defines the type of fortran variable containing a C pointer
   include/c_defs.h:   defines C to fortran calling convention and a few more things
                       (used by C files)
   
</pre>
<p>configure.msg is only used by configure to print its final report. It isn’t
needed for compilation. NOTA BENE: unlike previous versions, configure
no longer runs the makedeps.sh shell script that updates dependencies. If
you modify the program sources, run makedeps.sh or type make depend to
update files make.depend in the various subdirectories.
</p><p>You should always be able to compile the Quantum-ESPRESSO suite
of programs without having to edit any of the generated files. However you
may have to tune configure by specifying appropriate environment variables
and/or command-line options. Usually the most tricky part is to get external
libraries recognized and used: see the <a href="/wiki/index.php/Installation#Libraries" title="Installation"> Libraries</a>
section for details and hints.
</p><p>Environment variables may be set in any of these ways:
</p>
<pre>    export VARIABLE=value               # sh, bash, ksh
    ./configure
    setenv VARIABLE value               # csh, tcsh
    ./configure
    ./configure VARIABLE=value          # any shell
</pre>
<p>Some environment variables that are relevant to configure are:
</p>
<pre>    ARCH:         label identifying the machine type (see below)
    F90, F77, CC: names of Fortran 95, Fortran 77, and C compilers
    MPIF90:       name of parallel Fortran 95 compiler (using MPI)
    CPP:          source file preprocessor (defaults to $CC -E)
    LD:           linker (defaults to $MPIF90)
    CFLAGS, FFLAGS, F90FLAGS, CPPFLAGS, LDFLAGS: compilation ﬂags
    LIBDIRS:      extra directories to search for libraries (see below)
</pre>
<p>For example, the following command line:
</p>
<pre>    ./configure MPIF90=mpf90 FFLAGS="-O2 -assume byterecl" \
                 CC=gcc CFLAGS=-O3 LDFLAGS=-static
</pre>
<p>instructs configure to use mpf90 as Fortran 95 compiler with ﬂags -O2
-assume byterecl, gcc as C compiler with ﬂags -O3, and to link with ﬂags
-static. Note that the value of FFLAGS must be quoted, because it contains
spaces.
</p><p>If your machine type is unknown to configure, you may use the ARCH
variable to suggest an architecture among supported ones. Try the one that
looks more similar to your machine type; you’ll probably have to do some
additional tweaking. Currently supported architectures are:
</p>
<pre>     ia32:   Intel 32-bit machines (x86) running Linux
     ia64:   Intel 64-bit (Itanium) running Linux
     amd64:  AMD 64-bit (Opteron) running Linux
     aix:    IBM AIX machines
     mips:   SGI MIPS machines
     alpha:  HP-Compaq alpha machines
     alinux: HP-Compaq alpha running Linux
     sparc:  Sun SPARC machines
     solaris:PC's running SUN-Solaris
     crayx1: Cray X1 machines
     macppc: Apple PowerPC machines running Mac OS X
     mac686: Apple Intel machines running Mac OS X
     cygwin: MS-Windows PCs with Cygwin
     necsx:  NEC SX-6 and SX-8 machines
     ppc64:  Linux PowerPC machines, 64 bits
     ppc64-mn:as above, with IBM xlf compiler
</pre>
<p>Finally, configure recognizes the following command-line options:
</p>
<pre>     --disable-parallel: compile serial code, even if parallel environment is available
     --disable-shared: don’t use shared libraries: generate static executables
     --enable-shared: use shared libraries.
     --host=target&nbsp;: specify target machine for cross-compilation.
                     Target must be a string identifying the architecture that you want
                     to compile for; you can obtain it by running config.guess on
                     the target machine.
</pre>
<p>If you want to modify the configure script (advanced users only!), see the 
Developer Manual, <a href="/wiki/index.php/Developer_Manual#How_to_edit_the_configure_script" title="Developer Manual"> How to edit the configure script</a> section. You will need GNU Autoconf (<a href="http://www.gnu.org/software/autoconf/" class="external free" title="http://www.gnu.org/software/autoconf/" rel="nofollow">http://www.gnu.org/software/autoconf/</a>)
installed.
</p>
<a name="Libraries"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=4" title="Installation">edit</a>]</span> <span class="mw-headline">Libraries</span></h3>
<p>Quantum-ESPRESSO makes use of the following external libraries:
</p>
<ul><li> BLAS (<a href="http://www.netlib.org/blas/" class="external free" title="http://www.netlib.org/blas/" rel="nofollow">http://www.netlib.org/blas/</a>) and LAPACK (<a href="http://www.netlib.org/lapack/" class="external free" title="http://www.netlib.org/lapack/" rel="nofollow">http://www.netlib.org/lapack/</a>) for linear algebra
</li><li> FFTW (<a href="http://www.fftw.org/" class="external free" title="http://www.fftw.org/" rel="nofollow">http://www.fftw.org/</a>) for Fast Fourier Transforms
</li></ul>
<p>A copy of the needed routines is provided with the distribution. However,
when available, optimized vendor-specific libraries can be used instead: this
often yields huge performance gains.
</p><p><b>BLAS and LAPACK</b> Quantum-ESPRESSO can use the following architecture-
specific replacements for BLAS and LAPACK:
</p>
<pre>     MKL for Intel Linux PCs
     ACML for AMD Linux PCs
     ESSL for IBM machines
     complib.sgimath for SGI Origin
     SCSL for SGI Altix
     SUNperf for Sun
     cxml for HP-Compaq Alphas.
</pre>
<p>If none of these is available, we suggest that you use the optimized ATLAS
library (<a href="http://math-atlas.sourceforge.net/" class="external free" title="http://math-atlas.sourceforge.net/" rel="nofollow">http://math-atlas.sourceforge.net/</a>). Note that ATLAS is not
a complete replacement for LAPACK: it contains all of the BLAS, plus the
LU code, plus the full storage Cholesky code. Follow the instructions in the
ATLAS distributions to produce a full LAPACK replacement.
</p><p>Sergei Lisenkov reported success and good performances with optimized
BLAS by Kazushige Goto. They can be freely downloaded  (but not redistributed):
<a href="http://www.cs.utexas.edu/users/flame/goto/" class="external free" title="http://www.cs.utexas.edu/users/flame/goto/" rel="nofollow">http://www.cs.utexas.edu/users/flame/goto/</a>
</p><p><b>FFT</b> Quantum-ESPRESSO can use the following vendor-specific FFT 
libraries:
</p>
<pre>     IBM ESSL
     SGI SCSL
     SUN sunperf
     NEC ASL.

</pre>
<p>If you use FFTW, you have to choose before compilation whether to
load the built-in copy (v.2) of FFTW or a precompiled v.2 or v.3 FFTW
library. This is done using preprocessing options: -D__FFTW 
(for precompiled v.2), -D__FFTW -D__USE_INTERNAL_FFTW 
(for internal v.2), -D__FFTW3 (for precompiled v.3). 
Presently, configure only recognizes external FFTW v.2; if not found, 
it falls back to the internal copy. If you have recent
versions of MKL installed, you may use the 
FFTW interface provided with MKL, but you will have to compile it
and to modify the make.sys accordingly.
</p><p><br />
If you want to link to a precompiled FFTW v.&lt;3 library, you will need
the corresponding fftw.h include file. That may or may not have been
installed on your system together with the library: in particular, most Linux
distributions split libraries into “base” and “development” packages, include
files normally belonging to the latter. Thus if you can’t find fftw.h on your
machine, chances are you must install the FFTW development package (how
to do this and what it is exactly called depends on your operating system
version).
</p><p>If instead the file is there, but configure doesn’t find it, you may specify
its location in the INCLUDEFFTW environment variable. For example:
</p>
<pre>  ./configure INCLUDEFFTW="/usr/lib/fftw-2.1.3/fftw"
</pre>
<p>If everything else fails, you’ll have to modify the make.sys file manually: see
the section on <a href="/wiki/index.php/Installation#Manual_con.EF.AC.81gurations" title="Installation"> manual configuration</a>. 
</p><p><b>MPI libraries</b> For parallel execution, Quantum-ESPRESSO uses the MPI libraries.
In well-configured machine, configure should find the appropriate parallel compiler
for you, and this should find the appropriate libraries. Since often this doesn't 
happen, especially on PC clusters, see the section on 
<a href="/wiki/index.php/Installation#Linux_PC_clusters_with_MPI" title="Installation"> Linux PC clusters with MPI</a>.
</p><p><b>Other libraries</b> Quantum-ESPRESSO can use the MASS vector math
library from IBM, if available (only on AIX).
</p><p>The configure script attempts to find optimized libraries, but may fail
if they have been installed in non-standard places. You should examine
the final value of BLAS_LIBS, LAPACK_LIBS, FFT_LIBS, MPI_LIBS (if needed),
MASS_LIBS (IBM only), either in the output of configure or in the generated
make.sys, to check whether it found all the libraries that you intend to use.
</p><p>If some library was not found, you can specify a list of directories to search
in the environment variable LIBDIRS, and rerun configure; directories in the
list must be separated by spaces. For example:
</p>
<pre>  ./configure LIBDIRS="/opt/intel/mkl70/lib/32 /usr/lib/math"
</pre>
<p>If this still fails, you may set some or all of the *_LIBS variables manually
and retry. For example:
</p>
<pre>  ./configure BLAS_LIBS="-L/usr/lib/math -lf77blas -latlas_sse"
</pre>
<p>Beware that in this case, configure will blindly accept the specified value,
and won’t do any extra search. This is so that if configure finds any library
that you don’t want to use, you can override it.
</p><p><b>Please note:</b> If you change any settings after a previous (successful or
failed) compilation, you must run "make clean" before recompiling, unless you
know exactly which routines are aﬀected by the changed settings and how to
force their recompilation.
</p>
<a name="Manual_configurations"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=5" title="Installation">edit</a>]</span> <span class="mw-headline">Manual configurations</span></h3>
<p>If "configure" stops before the end, and you don't find a way to fix
it, you have to write working "make.sys", "include/fft_defs.h" and
"include/c_defs.h" files. 
For the latter two files, follow the explanations in 
"include/defs.h.README". 
</p><p>If "configure" has run till the end, you should need only to
edit "make.sys". A few templates (each for a diﬀerent machine type)
are provided in the install/ directory: they have names of the
form Make.system, where "system" is a string identifying the 
architecture and compiler.
</p><p>If you have the Intel compiler ifc v.6 or earlier, you will have to 
run the script ifcmods.sh.
</p><p>Most likely (and even more so if there isn’t an exact match to your 
machine type), you’ll have to tweak make.sys by hand. In particular, 
you must
specify the full list of libraries that you intend to link to.
</p><p><b>NOTA BENE:</b> If you modify the program sources, run the script makedeps.sh
or type make depend to update files make.depend in the various subdirectories.
</p>
<a name="Compile"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=6" title="Installation">edit</a>]</span> <span class="mw-headline">Compile</span></h2>
<p>There are a few adjustable parameters in Modules/parameters.f90. The
present values will work for most cases. All other variables are dynamically
allocated: you do not need to recompile your code for a diﬀerent system.
</p><p>At your option, you may compile the complete Quantum-ESPRESSO
suite of programs (with make all), or only some specific programs.
</p><p>make with no arguments yields a list of valid compilation targets. Here is
a list:
</p>
<ul><li> make pw produces PW/pw.x.
</li></ul>
<p>pw.x calculates electronic structure, structural optimization, molecular dynamics, barriers with NEB.
</p>
<ul><li> make ph produces PH/ph.x
</li></ul>
<p>ph.x calculates phonon frequencies and displacement patterns, dielectric tensors, eﬀective charges (uses data produced by pw.x).
</p>
<ul><li> make d3 produces D3/d3.x
</li></ul>
<p>d3.x calculates anharmonic phonon lifetimes (third-order derivatives of the energy), 
using data produced by pw.x and ph.x (Ultrasoft pseudopotentials not supported).
</p>
<ul><li> make gamma produces Gamma/phcg.x.
</li></ul>
<p>phcg.x is a version of ph.x that calculates phonons at q = 0 using conjugate-gradient minimization of the density functional expanded to second-order. Only the Γ  (q = 0) point is used for Brillouin zone integration. It is faster and takes less memory than ph.x, but does not support Ultrasoft pseudopotentials.
</p>
<ul><li> make pp produces several codes for data postprocessing, in PP/ (see list below).
</li><li> make tools produces several utility programs, mostly for phonon calculations, in pwtools/ (see list below).
</li><li> make pwcond produces PWCOND/pwcond.x, for ballistic conductance calculations.
</li></ul>
<ul><li> make pwall produces all of the above.
</li></ul>
<ul><li> make ld1 produces code atomic/ld1.x for pseudopotential generationd (see the specific documentation in atomic doc/).
</li></ul>
<ul><li> make upf produces utilities for pseudopotential conversion in directory upftools/ (see section 4, “Pseudopotentials”).
</li></ul>
<ul><li> make cp produces the Car-Parrinello code CP in CPV/cp.x. and the postprocessing code CPV/cppp.x.
</li></ul>
<ul><li> make all produces all of the above.
</li></ul>
<p>For the setup of the GUI, refer to the PWgui-X.Y.Z /INSTALL file, where
X.Y.Z stands for the version number of the GUI (should be the same as the
general version number). If you are using the CVS-sources, see
the GUI/README file instead.
</p><p>The codes for data postprocessing in PP/ are:
</p>
<ul><li> pp.x extracts the specified data from files produced by pw.x, prepare data for plotting by writing them into formats that can be read by several plotting programs.
</li><li> bands.x extracts and reorders eigenvalues from files produced by pw.x for band structure plotting
</li><li> projwfc.x calculates projections of wavefunction over atomic orbitals, performs L&ouml;wdin population analysis and calculates projected density of states. These can be summed using auxiliary code sumpdos.x.
</li><li> dipole.x calculates the dipole moment for isolated systems (molecules) and the Makov-Payne correction for molecules in supercells (beware: meaningful results only if the charge density is completely contained into the Wigner-Seitz cell)
</li><li> plotrho.x produces PostScript 2-d contour plots
</li><li> plotband.x reads the output of bands.x, produces band structure PostScript plots*
</li><li> average.x calculates planar averages of quantities produced by pp.x (potentials, charge, magnetization densities,...)
</li><li> voronoy.x divides the charge density into Voronoy polyhedra (obsolete, use at your own risk)
</li><li> dos.x calculates electronic Density of States (DOS)
</li><li> pw2wan.x: interface with code WanT for calculation of transport properties via Wannier (also known as Boyd) functions: see <a href="http://www.wannier-transport.org/" class="external free" title="http://www.wannier-transport.org/" rel="nofollow">http://www.wannier-transport.org/</a>
</li><li> pmw.x generates Poor Man’s Wannier functions, to be used in LDA+U calculations
</li><li> pw2casino.x: interface with CASINO code for Quantum Monte Carlo calculation (<a href="http://www.tcm.phy.cam.ac.uk/~mdt26/casino.html" class="external free" title="http://www.tcm.phy.cam.ac.uk/~mdt26/casino.html" rel="nofollow">http://www.tcm.phy.cam.ac.uk/~mdt26/casino.html</a>).
</li></ul>
<p>The utility programs in pwtools/ are:
</p>
<ul><li> dynmat.x applies various kinds of Acoustic Sum Rule (ASR), calculates LO-TO splitting at q = 0 in insulators, IR and Raman cross sections (if the coeﬃcients have been properly calculated), from the dynamical matrix produced by ph.x
</li><li> q2r.x calculates Interatomic Force Constants (IFC) in real space from dynamical matrices produced by ph.x on a regular q-grid
</li><li> matdyn.x produces phonon frequencies at a generic wave vector using the IFC file calculated by q2r.x; may also calculate phonon DOS
</li><li> fqha.x for quasi-harmonic calculations
</li><li> lambda.x calculates the electron-phonon coeﬃcient λ and the function α2 F (ω )
</li><li> dist.x calculates distances and angles between atoms in a cell, taking into account periodicity
</li><li> ev.x fits energy-vs-volume data to an equation of state
</li><li> kpoints.x produces lists of k-points
</li><li> pwi2xsf.sh, pwo2xsf.sh process respectively input and output files (not data files!) for pw.x and produce an XSF-formatted file suitable for plotting with XCrySDen, a powerful crystalline and molecular structure visualization program (<a href="http://www.xcrysden.org/" class="external free" title="http://www.xcrysden.org/" rel="nofollow">http://www.xcrysden.org/</a>). BEWARE: the pwi2xsf.sh shell script requires the pwi2xsf.x executables to be located somewhere in your $PATH.
</li><li> band_plot.x: undocumented and possibly obsolete
</li><li> bs.awk, mv.awk are scripts that process the output of pw.x (not data files!). Usage:
</li></ul>
<pre>        awk -f bs.awk &lt; my-pw-file &gt; myfile.bs
        awk -f mv.awk &lt; my-pw-file &gt; myfile.mv
 
</pre>
<p>The files so produced are suitable for use with xbs, a very simple X-windows utility to display molecules, available at: <a href="http://www.ccl.net/cca/software/X-WINDOW/xbsa/README.shtml" class="external free" title="http://www.ccl.net/cca/software/X-WINDOW/xbsa/README.shtml" rel="nofollow">http://www.ccl.net/cca/software/X-WINDOW/xbsa/README.shtml</a>
</p>
<ul><li> path_int.sh/path_int.x: utility to generate, starting from a path (a set of images), a new one with a diﬀerent number of images. The initial and final points of the new path can diﬀer from those in the original one. Useful for NEB calculations.
</li><li> kvecs FS.x, bands FS.x: utilities for Fermi Surface plotting using XCrySDen
</li></ul>
<p><b>Other utilities:</b>
</p>
<ul><li> VdW/ contains the sources for the calculation of the finite (imaginary) frequency molecular polarizability using the approximated Thomas-Fermi + von Weiz&auml;cker scheme, contributed by H.-V. Nguyen (Sissa and Hanoi University). Compile with make vdw, executables in VdW/vdw.x, no documentation yet, but an example in examples/example34. 
</li></ul>
<a name="Run_examples"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=7" title="Installation">edit</a>]</span> <span class="mw-headline">Run examples</span></h2>
<p>As a final check that compilation was successful, you may want to run some or
all of the examples contained within the examples directory of the 
Quantum-ESPRESSO distribution. Those examples try to exercise all the programs
and features of the Quantum-ESPRESSO package. A list of examples and
of what each example does is contained in examples/README. For details,
see the README file in each example’s directory. If you find that any relevant
feature isn’t being tested, please contact us (or even better, write and send
us a new example yourself&nbsp;!).
</p><p>If you haven’t downloaded the full Quantum-ESPRESSO distribution and
don’t have the examples, you can get them from the Test and Examples Page
of the Quantum-ESPRESSO web site (<a href="http://www.pwscf.org/tests.htm" class="external free" title="http://www.pwscf.org/tests.htm" rel="nofollow">http://www.pwscf.org/tests.htm</a>).
The necessary pseudopotentials are included.
</p><p>To run the examples, you should follow this procedure:
</p><p>1. Go to the examples directory and edit the environment variables file, setting the following variables as needed:
</p>
<pre>        BIN_DIR= directory where Quantum-ESPRESSO executables reside
        PSEUDO_DIR= directory where pseudopotential files reside
        TMP_DIR= directory to be used as temporary storage area
</pre>
<p>If you have downloaded the full Quantum-ESPRESSO distribution, you may set 
BIN_DIR=$TOPDIR/bin and PSEUDO_DIR=$TOPDIR/pseudo, where $TOPDIR is the root of the Quantum-ESPRESSO source tree. In order to be able to run all the examples, the PSEUDO_DIR directory must contain all the needed pseudopotentials.
If any of these are missing, you can download them (and many others) from the Pseudopotentials Page of the Quantum-ESPRESSO web site (<a href="http://www.pwscf.org/pseudo.htm" class="external free" title="http://www.pwscf.org/pseudo.htm" rel="nofollow">http://www.pwscf.org/pseudo.htm</a>). TMP_DIR must be a directory you have read and write access to, with enough available space to host the temporary files produced by the example runs, and possibly oﬀering high I/O performance (i.e., don’t use an NFS-mounted directory).
</p><p>2. If you have compiled the parallel version of Quantum-ESPRESSO (this is the default if parallel libraries are detected), you will usually have to specify a driver program (such as poe or mpiexec) and the number of processors: see section 
<a href="/wiki/index.php/Running_on_parallel_machines" title="Running on parallel machines">Running on parallel machines</a> for details. In order to do that, edit again the environment variables file and set the PARA_PREFIX and PARA_POSTFIX variables as needed. Parallel executables will be run by a command like this:
</p>
<pre>     $PARA_PREFIX pw.x $PARA_POSTFIX &lt; file.in &gt; file.out
</pre>
<p>For example, if the command line is like this (as for an IBM SP):
</p>
<pre>     poe pw.x -procs 4 &lt; file.in &gt; file.out
</pre>
<p>you should set PARA_PREFIX="poe", PARA_POSTFIX="-procs 4". Furthermore, if your machine does not support interactive use, you must run the commands specified below through the batch queueing system installed on that machine. Ask your system administrator for instructions.
</p><p>3. To run a single example, go to the corresponding directory (for instance, example/example01) and execute:
</p>
<pre>     ./run_example
</pre>
<p>This will create a subdirectory results, containing the input and output files generated by the calculation. Some examples take only a few seconds to run, while others may require several minutes depending on your system.
</p><p>To run all the examples in one go, execute:
</p>
<pre>     ./run_all_examples
</pre>
<p>from the examples directory. On a single-processor machine, this typically takes one to three hours. The make clean script cleans the examples tree, by removing all the results subdirectories. However, if additional subdirectories have been created, they aren’t deleted.
</p><p>4. In each example’s directory, the reference subdirectory contains verified output files, that you can check your results against. They were generated on a Linux PC using the Intel compiler. On diﬀerent architectures the precise numbers could be slightly diﬀerent, in particular if diﬀerent FFT dimensions are automatically selected. For this reason, a plain diff of your results against the reference data doesn’t work, or at least, it requires human inspection of the results. Instead, you can run the 
check_example script in the examples directory:
</p>
<pre>     ./check_example example_dir
</pre>
<p>where example dir is the directory of the example that you want to check (e.g., ./check_example example01). You can specify multiple directories. 
</p><p><b>Note</b>: check_example does only a fair job, and only for a few examples. 
For pw.x only, a much better series of automated tests (under development)
is available in directory tests/. Edit variables PARA_PREFIX, 
PARA_POSTFIX (if needed) in file "check_pw.x.j"; explanations on how to run it
are in the header of the file.
</p>
<a name="Installation_tricks_and_problems"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=8" title="Installation">edit</a>]</span> <span class="mw-headline">Installation tricks and problems</span></h2>
<a name="All_machines"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=9" title="Installation">edit</a>]</span> <span class="mw-headline">All machines</span></h3>
<p>Working fortran-95 and C compilers are needed in order
to compile Quantum-ESPRESSO. Most so-called “fortran-90” compilers implement the fortran-95 standard, but older versions may not be fortran-95
compliant.
</p><p>If you get “Compiler Internal Error” or similar messages: your compiler version is buggy.
Try to lower
the optimization level, or to remove optimization, just for the routine that
has problems. If it doesn’t work, or if you experience weird problems, try to
install patches for your version of the compiler (most vendors release at least
a few patches for free), or to upgrade to a more recent version.
</p><p>If you get error messages at the loading phase that looks like 
“file XYZ.o: unknown (unrecognized, invalid, wrong, missing, ... ) file type”, or 
"file format not recognized for fiel XYZ.a”, one of
the following things have happened:
</p><p>1. you have leftover object files from a compilation with another compiler: run make clean and recompile.
</p><p>2. make does not stop at the first compilation error (it happens with some compilers). Remove file XYZ.o and look for the compilation error.
</p><p>If many symbols are missing in the loading phase: you did not specify the
location of all needed libraries (LAPACK, BLAS, FFTW, machine-specific
optimized libraries). If you did, but symbols are still missing, see below (for
Linux PC). Remember: Quantum-Espresso if self-contained (with the exception of
MPI libraries for parallel compilation). If system libraries are missing, the
problem cannot be in Quantum-Espresso.
</p>
<a name="IBM_AIX"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=10" title="Installation">edit</a>]</span> <span class="mw-headline">IBM AIX</span></h3>
<p>On IBM machines with ESSL libraries installed, there is a 
potential conﬂict between a few LAPACK routines that are also part of ESSL, 
but with a diﬀerent calling sequence. The appearence of run-time errors like
</p>
<pre>   ON ENTRY TO ZHPEV       PARAMETER NUMBER       1 HAD AN ILLEGAL VALUE
</pre>
<p>is a signal that you are calling the bad routine. If you have defined -D__ESSL
you should load ESSL before LAPACK: see variable LAPACK_LIBS in make.sys.
</p><p>On some IBM AIX machines, configure stop with an obscure error saying that
it has no permission to run /usr/bin/oslevel. This is no longer a problem 
for version 3.2 or later. 
</p>
<a name="Linux_PC"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=11" title="Installation">edit</a>]</span> <span class="mw-headline">Linux PC</span></h3>
<p>The web site of Axel Kohlmeyer contains a very informative
section on compiling and running CPMD on Linux. Most of its contents
applies to the Quantum-ESPRESSO code as well:
<a href="http://www.theochem.rub.de/~axel.kohlmeyer/cpmd-linux.html" class="external free" title="http://www.theochem.rub.de/~axel.kohlmeyer/cpmd-linux.html" rel="nofollow">http://www.theochem.rub.de/~axel.kohlmeyer/cpmd-linux.html</a>. In particular, there is a set of ATLAS libraries, containing all of LAPACK and no external reference to fortran libraries: <a href="http://www.theochem.rub.de/~axel.kohlmeyer/cpmd-linux.html#atlas" class="external free" title="http://www.theochem.rub.de/~axel.kohlmeyer/cpmd-linux.html#atlas" rel="nofollow">http://www.theochem.rub.de/~axel.kohlmeyer/cpmd-linux.html#atlas</a>
</p><p>It is convenient to create semi-statically linked executables (with only
libc/libm/libpthread linked dynamically). If you want to produce a binary
that runs on diﬀerent machines, compile it on the oldest machine you have
(i.e. the one with the oldest version of the operating system).
</p><p>If you get errors like 
</p>
<pre>  IPO Error: unresolved&nbsp;: __svml_cos2
</pre>
<p>at the linking stage,
this means that your compiler is optimized to use the SSE version of sine, cosine 
etc. contained in the SVML library. Append '-lsvml' to the list of libraries in 
your make.sys file (info by Axel Kohlmeyer, oct.2007).
</p>
<a name="Linux_PCs_with_Portland_Group_compiler_.28pgf90.29"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=12" title="Installation">edit</a>]</span> <span class="mw-headline">Linux PCs with Portland Group compiler (pgf90)</span></h4>
<p>Quantum-ESPRESSO does not work reliably, or not at all, with many versions of the Portland Group compiler (in particular, v.5.2 and 6.0). Version
5.1 used to work, v.6.1 is reported to work (info from Paolo Cazzato). Use
the latest version of each release of the compiler, with patches if available:
see the Portland Group web site,
<a href="http://www.pgroup.com/faq/install.htm#release" class="external free" title="http://www.pgroup.com/faq/install.htm#release" rel="nofollow">http://www.pgroup.com/faq/install.htm#release</a> info
</p>
<a name="Linux_PCs_with_Pathscale_compiler"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=13" title="Installation">edit</a>]</span> <span class="mw-headline">Linux PCs with Pathscale compiler</span></h4>
<p>Versions 2.3 ad 2.4 of the Pathscale compiler crash when compiling CPV/phasefactors.f90. Workaround:
replace SUM(na(1:nsp)) with nat (info by Paolo Cazzato; fixed since version
3.1.1).
</p>
<a name="Linux_PCs_with_gfortran"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=14" title="Installation">edit</a>]</span> <span class="mw-headline">Linux PCs with gfortran</span></h4>
<p>Quantum-espresso v.4 supports gfortran v.4.1 and later; note however that only basic
functionalities have been tested. More advanced ones may or may not work. In particular:
reading files produced by previous versions of Q-E may not work, apparently due to a
gfortran bug.
</p><p>Quantum-espresso versions &lt; 4 needs some tweaking, such as replacing
</p>
<pre> INTEGER, EXTERNAL &nbsp;:: iargc
</pre>
<p>with 
</p>
<pre> INTEGER &nbsp;:: iargc
</pre>
<p>in PW/startup.f90, and the following one:
"I noticed that gfortran (version 4.1 and 4.2)  compiled code (32bit and 64bit; linux debian) 
crashes in three routines (actually operator definitions) of Modules/basic_algebra_routines.f90,
in particular: matrix_times_vector, vector_times_matrix, matrix. For example:
</p>
<pre>   &nbsp;!-----------------------------------------------------------------------
    FUNCTION matrix_times_vector( mat, vec )
     &nbsp;!-----------------------------------------------------------------------
     &nbsp;!
      IMPLICIT NONE
     &nbsp;!
      REAL(DP), INTENT(IN)&nbsp;:: vec(:)
      REAL(DP), INTENT(IN)&nbsp;:: mat(:,:)
      REAL(DP)            &nbsp;:: matrix_times_vector(SIZE( vec ))
      INTEGER             &nbsp;:: dim
     &nbsp;!
      dim = SIZE( vec )
     &nbsp;!
      CALL DGEMV( 'N', dim, dim, 1.0_DP, mat, dim, &amp;
                  vec, 1, 0.0_DP, matrix_times_vector, 1 )
     &nbsp;!
    END FUNCTION  matrix_times_vector
</pre>
<p>The actual segmentation fault is in DGEMV, but the crash is independent on the blas used.
However by making the changes for all three operators as indicated below, the segmentation 
fault disappears and compiled code runs OK.
</p>
<pre>   &nbsp;!-----------------------------------------------------------------------
    FUNCTION matrix_times_vector( mat, vec )
     &nbsp;!-----------------------------------------------------------------------
     &nbsp;!
      IMPLICIT NONE
     &nbsp;!
      REAL(DP), INTENT(IN)&nbsp;:: vec(:)
      REAL(DP), INTENT(IN)&nbsp;:: mat(:,:)
      REAL(DP)            &nbsp;:: matrix_times_vector(SIZE( vec )), v_aux(SIZE( vec ))
      INTEGER             &nbsp;:: dim
     &nbsp;!
      dim = SIZE( vec )
     &nbsp;!
      CALL DGEMV( 'N', dim, dim, 1.0_DP, mat, dim, &amp;
                  vec, 1, 0.0_DP, v_aux, 1 )
      matrix_times_vector = v_aux
     &nbsp;!
    END FUNCTION  matrix_times_vector
</pre>
<p>Now an auxiliary v_aux is passed to DGEMV and after copied to matrix_times_vector.
As my knowledge of fortran95 is close to zero, I don't know why&amp;how, but the fact is that
this fixes the problem for gfortran compiled code." (info by Tone Kokalj, oct.2007)
</p>
<a name="Linux_PCs_with_Intel_compiler_.28ifort.2C_formerly_ifc.29"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=15" title="Installation">edit</a>]</span> <span class="mw-headline">Linux PCs with Intel compiler (ifort, formerly ifc)</span></h4>
<p>If configure doesn’t find the compiler, or if you get “Error loading shared
libraries...” at run time, you may have forgotten to execute the script that
sets up the correct path and library path. Unless your system manager has
done this for you, you should execute the appropriate script — located in
the directory containing the compiler executable — in your initialization files.
Consult the documentation provided by Intel.
</p><p>Starting from the latests v 8.1 patchlevels, the recommended way to build
semi-statically linked binaries is to use the -i-static ﬂag; for multi-threaded
libraries the linker ﬂag would be -i-static -openmp (linking libguide is
no longer needed and the compiler will pick the correct one). For previous
versions, try -static-libcxa (this will give an incomplete semi-static link
on newer versions).
</p><p>Each major release of the Intel compiler diﬀers a lot from the previous one.
Do not mix compiled objects from diﬀerent releases: they may be incompatible.
</p><p>In case of trouble, update your version with the most recent patches,
available via Intel Premier support (registration free of charge for Linux):
<a href="http://developer.intel.com/software/products/support/#premier" class="external free" title="http://developer.intel.com/software/products/support/#premier" rel="nofollow">http://developer.intel.com/software/products/support/#premier</a>.
</p><p><b>ifort v.10:</b> on 64-bit AMD CPUs, at least some versions of ifort 10.1 
miscompile subroutine write_rho_xml in Module/xml_io_base.f90 with -O2
options. Using -O1 instead solves the problem (info by Carlo Cavazzoni, March 2008).
</p><p><b>ifort v.9:</b> The latest (July 2006) 32-bit version of ifort 9.1 works ﬂawlessy.
Earlier versions yielded “Compiler Internal Error”.
</p><p>At least some versions of ifort 9.0 have a buggy preprocessor that either
prevents compilation of iotk, or produces runtime errors in cft3. Update
to a more patched version, or modify make.sys to explicitly perform 
preprocessing using /lib/cpp, as in the following example (courtesy from Sergei
Lisenkov):
</p>
<pre>  .f90.o:
          $(CPP) $(CPPFLAGS) $&lt; -o $*.F90
          $(MPIF90) $(F90FLAGS) -c $*.F90 -o $*.o
</pre>
<pre>  CPP       = /lib/cpp
  CPPFLAGS  = -P -C -traditional $(DFLAGS) $(IFLAGS)
   
</pre>
<p>On some versions of RedHat Linux, you may get an obscure error: IPO
link: can not find "(" ... , due to a bad system configuration. Add
option -no-ipo to LDFLAGS in file make.sys.
</p><p><b>ifort v.8:</b> Some releases of ifort 8 yield “Compiler Internal Error”. Update
to a more patched version: 8.0.046 for v. 8.0, 8.1.018 for v. 8.1.
</p><p>There is a well known problem with ifort 8 and pthreads (that are used
both in Debian Woody and Sarge) that causes “segmentation fault” errors
(info from Lucas Fernandez Seivane). Version 7 did not have this problem.
</p><p><b>ifc v.7:</b> Some releases of ifc 7.0 and 7.1 yield “Compiler Internal Error”
Update to the last version (should be 7.1.41).
</p><p>Warnings “size of symbol ... changed ...” are produced by ifc 7.1 a
the loading stage. These seem to be harmless, but they may cause the
loader to stop, depending on your system configuration. If this happen
and no executable is produced, add the following to LDFLAGS: -Xlinker
--noinhibit-exec.
</p><p>Linux distributions using glibc 2.3 or later (such as e.g. RedHat 9) may be
incompatible with ifc 7.0 and 7.1. The incompatibility shows up in the form
of messages “undefined reference to ‘errno’ ” at linking stage. A workaround
is available: see <a href="http://newweb.ices.utexas.edu/misc/ctype.c" class="external free" title="http://newweb.ices.utexas.edu/misc/ctype.c" rel="nofollow">http://newweb.ices.utexas.edu/misc/ctype.c</a>.
</p>
<a name="Linux_PCs_with_MKL_libraries"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=16" title="Installation">edit</a>]</span> <span class="mw-headline">Linux PCs with MKL libraries</span></h4>
<p>On Intel CPUs it is very convenient to use Intel MKL libraries. They can be
also used for AMD CPU, selecting the appropriate machine-optimized
libraries, and also together with non-Intel compilers.
MKL contains optimized FFT routines and a FFTW interface, to be separately
compiled, giving a nice speedup with respect to FFTW (but see below!).
If configure doesn’t find MKL, try configure --enable-shared. 
Note that ifort 8 fails to load with MKL v. 5.2 or earlier
versions, because some symbols that are referenced by MKL are missing
There is a fix for this (info from Konstantin Kudin): add libF90.a from ifc
7.1 at the linking stage, as the last library. Note that some combinations of
not-so-recent versions of MKL and ifc may yield a lot of “undefined references” 
when statically loaded: use configure --enable-shared, or remove
the -static option in make.sys. Note that pwcond.x works only with recent
versions (v.7 or later) of MKL.
</p><p>When using/testing/benchmarking MKL on SMP (multiprocessor) machines, 
one should set the environmental variable OMP_NUM_THREADS to 1,
unless the OpenMP parallelization is desired (do not confuse OpenMP and
OpenMPI!!! they refer to diﬀerent parallelization paradigms). MKL by default
sets the variable to the number of CPUs installed and thus gives the impression 
of a much better performance, as the CPU time is only measured
for the master thread (info from Axel Kohlmeyer).
</p><p>"One more remark on the subject of intel MKL. I've been doing
some more detailed testing recently and found that Intel is
now turning on multithreading without any warning and that
is for example why their FFT seems faster than FFTW. for serial
and OpenMP based runs this makes no difference (in fact the
multi-threaded FFT helps), but if you run MPI locally, you
actually lose performance. also if you use the 'numactl' tool
on linux to bind a job to a specific cpu core, MKL will still
try to use all available cores (and slow down badly). the
cleanest way of avoiding this mess is to either link with
-lmkl_intel_lp64 -lmkl_sequential -lmkl_core (on 64-bit
i.e. x86_64 and ia64, on ia32 it is -lmkl_intel -lmkl_sequential -lmkl_core) or edit the libmkl_&lt;platform&gt;.a file (I'm using now a file libmkl10.a with:
GROUP (libmkl_intel_lp64.a libmkl_sequential.a libmkl_core.a)
works like a charm" (info from Axel Kohlmeyer, April 2008).
</p>
<a name="Fun_with_precompiled_libraries"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=17" title="Installation">edit</a>]</span> <span class="mw-headline">Fun with precompiled libraries</span></h4>
<p>Since there is no standard fortran 
compiler for Linux, diﬀerent compilers have diﬀerent ideas about the right way to
call external libraries. As a consequence you may have a mismatch between
what your compiler calls (“symbols”) and the actual name of the required
library call. Use the nm command to determine the name of a library call, as
in the following examples:
</p>
<pre>     nm /usr/local/lib/libblas.a | grep -i 'T daxpy'
</pre>
<pre>     nm /usr/local/lib/liblapack.a | grep -i 'T zhegv'
</pre>
<p>where typical location and name of libraries is assumed. Most precompiled
libraries have lowercase names with one or two underscores (_) appended.
configure should select the appropriate preprocessing options in make.sys,
but in case of trouble, be aware that:
</p>
<ul><li> the Absoft compiler is case-sensitive (like C and unlike other Fortran compilers) and does not add an underscore to symbol names (note that if your libraries contain uppercase or mixed case names, you are out
</li></ul>
<p>of luck: You must either recompile your own libraries, or change the #define’s in include/f defs.h);
</p>
<ul><li> both Portland compiler (pgf90) and Intel compiler (ifort/ifc) are case insensitive and add an underscore to symbol names.
</li></ul>
<p>Another potential source of trouble is the incompatibility between I/O
libraries used by diﬀerent fortran compilers. This manifests itself under the
form of missing routines with strange names 
(like s_wsfe, do_fio...) at
linking stage. Possible workarounds include
</p>
<ul><li> loading the missing routines; it is often suﬃcient to load -lg2c (sometimes -lm may also be needed); or
</li><li> (better) to replace the BLAS routine xerbla (it should be the only one containing I/O calls) with a recompiled object. Locate the library containing this routine using nm, for instance:
</li></ul>
<pre>           nm /path/to/your/libs/libf77blas.a | grep 'T xerbla'
</pre>
<p>and replace the object xerbla.o in the library with the one you will compile. In flib/:
</p>
<pre>           make xerbla.o
           ar rv /path/to/your/libs/libf77blas.a xerbla.o
</pre>
<p>If nothing works, you may need to recompile the libraries with your fortran
compiler, or to use the internal (slow) copy.
</p>
<a name="AMD_CPUs.2C_Intel_Itanium"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=18" title="Installation">edit</a>]</span> <span class="mw-headline">AMD CPUs, Intel Itanium</span></h3>
<p>AMD Athlon CPUs can be basically treated
like Intel Pentium CPUs. You can use the Intel compiler and MKL with
Pentium-3 optimization.
</p><p>Konstantin Kudin reports that the best results in terms of performances
are obtained with ATLAS optimized BLAS/LAPACK libraries, using AMD
Core Math Library (ACML) for the missing libraries. ACML can be freely
downloaded from AMD web site. Beware: some versions of ACML – i.e.
the GCC version with SSE2 – crash PWscf. The “ nosse2” version appears
to be stable. Load first ATLAS, then ACML, then -lg2c, as in the following example (replace what follows -L with something appropriate to your
configuration):
</p>
<pre>  -L/location/of/fftw/lib/ -lfftw \
  -L/location/of/atlas/lib -lf77blas -llapack -lcblas -latlas \
  -L/location/of/gnu32_nosse2/lib -lacml -lg2c
</pre>
<p>64-bit CPUs like the AMD Opteron and the Intel Itanium are supported and
should work both in 32-bit emulation and in 64-bit mode. Both the Portland
and the Intel compiler (v8.1 EM64T-edition, available via Intel Premier support) should work. 64-bit executables can address a much larger memory
space, but apparently they are not especially faster than 32-bit executables.
The Intel compiler has been reported to be more reliable and to produce
faster executables wrt the Portland compiler. You may also try g95 or gfortran.
</p>
<a name="Linux_PC_clusters_with_MPI"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=19" title="Installation">edit</a>]</span> <span class="mw-headline">Linux PC clusters with MPI</span></h3>
<p>PC clusters running some version of MPI
are a very popular computational platform nowadays. Quantum-ESPRESSO
is known to work with at least two of the major MPI implementations
(MPICH, LAM-MPI), plus with the newer MPICH2 and OpenMPI implementation. The
number of possible configurations, in terms of type and version of the MPI libraries, kernels, system libraries, compilers, is very large. Quantum-ESPRESSO
compiles and works on all non-buggy, properly configured hardware and software combinations. You may have to recompile MPI libraries: not all MPI 
installations contain support for the fortran-90 compiler of your choice 
(or for any fortran-90 compiler at all!).
See Axel Kohlmeyer’s web site for precompiled versions of the MPI libraries.
Very useful step-by-step instructions can be found in the following post by 
Javier Antonio Montoya: <a href="http://www.democritos.it/pipermail/pw_forum/2008April/008818.htm" class="external free" title="http://www.democritos.it/pipermail/pw_forum/2008April/008818.htm" rel="nofollow">http://www.democritos.it/pipermail/pw_forum/2008April/008818.htm</a> .
</p><p>If Quantum-ESPRESSO does not work for some reason on a PC cluster,
try first if it works in serial execution. A frequent problem with parallel
execution is that Quantum-ESPRESSO does not read from standard input,
due to the configuration of MPI libraries: see section
<a href="/wiki/index.php/Running_on_parallel_machines#Trouble_with_input_files" title="Running on parallel machines">Running on parallel machines</a>
and Axel Kohlmeyer’s web site for more info.
</p><p>If you are dissatisfied with the performances in parallel execution, read
the section on <a href="/wiki/index.php/Performance_issues_%28PWscf%29#Parallelization_issues" title="Performance issues (PWscf)">Parallelization issues</a>. See also the following post from
Axel Kohlmeyer:
<a href="http://www.democritos.it/pipermail/pw_forum/2008-April/008796.html" class="external free" title="http://www.democritos.it/pipermail/pw_forum/2008-April/008796.html" rel="nofollow">http://www.democritos.it/pipermail/pw_forum/2008-April/008796.html</a>
</p>
<a name="Intel_Mac_OS_X"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=20" title="Installation">edit</a>]</span> <span class="mw-headline">Intel Mac OS X</span></h3>
<p>Newer Mac OS-X machines with Intel CPUs are supported by configure,
at least with gcc4+g95, since v.3.2; version 4 and later also support 
gfortran and the Intel compiler ifort with MKL libraries.
</p>
<a name="Intel_Mac_OS_X_with_ifort"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=21" title="Installation">edit</a>]</span> <span class="mw-headline">Intel Mac OS X with ifort</span></h4>
<p>"Uninstall darwin ports, fink and developer tools. The presence of all of
those at the same time generates many spooky events in the compilation
procedure.  I installed just the developer tools from apple, the intel
fortran compiler and everything went on great" (Info by Riccardo Sabatini, 
Nov. 2007)
</p>
<a name="Intel_Mac_OS_X_10.4_and_10.5_with_g95_and_gfortran"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=22" title="Installation">edit</a>]</span> <span class="mw-headline">Intel Mac OS X 10.4 and 10.5 with g95 and gfortran</span></h4>
<p>The stable and unstable versions of g95 are known to work. Recent gfortran versions 
also work, but they may require an updated version of Developer Tools (XCode 2.4.1 
or 2.5), that can be downloaded from Apple. Some tests fails with mysterious errors,
that disappear if fortran BLAS are linked instead of system Atlas libraries. Use:
</p>
<pre>  BLAS_LIBS      = ../flib/blas.a -latlas
</pre>
<p>(Info by Paolo Giannozzi, jan.2008)
</p>
<a name="Old_Machines"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=23" title="Installation">edit</a>]</span> <span class="mw-headline">Old Machines</span></h3>
<a name="PowerPc_Mac_OS_X"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=24" title="Installation">edit</a>]</span> <span class="mw-headline">PowerPc Mac OS X</span></h4>
<p>Compilation with xlf under Mac OSX 10.4 (“Tiger”) may
produce the following linkage error:
</p>
<pre> ld: Undefined symbols:
 _sprintf$LDBLStub
 _fprintf$LDBLStub
 _printf$LDBLStub
</pre>
<p>Workaround: add -lSystemStubs to LDFLAGS in make.sys (information by
Fabrizio Cleri, May 2006).   Other workaround: Set gcc version to 3.3. 
This is done with command
</p>
<pre> sudo gcc_select 3.3
</pre>
<p>If you get the message “Error trying to determine current cc version (got)”
change the order of directory in your PATH variable in order to make /opt/ibm/..
to appear at its end. The xlc alias to cc will stop working, but as soon you
have set gcc version, you can change PATH to its normal directory order
(information by Cesar Da Silva, May 2006).
</p><p>On some ppc Mac, g95 does not find mathematical libraries such as sin, cos, tan 
Workaround: add -lSystemStubs to any of the *_LIBS (not to LDFLAGS) in make.sys
(information by Rosa di Felice, July 2007).
</p><p>Because of an upgrade to a new release of GCC (4.0.1) with MacOSX
10.4.5, the IBM fortran compiler does not work correctly with an error message such as
</p>
<pre>  /usr/bin/ld: warning -L: directory name
    (/usr/lib/gcc/powerpc-apple-darwin8/4.0.0) does not exist
  /usr/bin/ld: can’t locate file for: -lgcc
</pre>
<p>and fails to run configure properly. The easiest way to correct this bug is to
help the XLF compiler to find the correct location of gcc. Do the following:
</p>
<pre>     1. sudo mv /etc/opt/ibmcmp/xlf/8.1/xlf.cfg
     /etc/opt/ibmcmp/xlf/8.1/xlf.cfg.2006.MM.DD.HH.MM.SS
     with MM.DD.HH.MM.SS is the current date (MM=month, DD=day
     etc...), then
</pre>
<pre>     2. sudo /opt/ibmcmp/xlf/8.1/bin/xlf configure -gcc /usr -install
     -smprt /opt/ibmcmp/xlsmp/1.4 -xlf /opt/ibmcmp/xlf/8.1 -xlfrt
     /opt/ibmcmp/xlf/8.1 -xlflic /opt/ibmcmp/xlf/8.1
     /opt/ibmcmp/xlf/8.1/etc/xlf.base.cfg
</pre>
<p>replaces the xlf.cfg with the correct location (info by Pascal Thibaudeau,
April 2006).
</p><p>The Absoft 9.1 compiler on Mac OS-X does not work (info by Axel
Kohlmeyer, June 2006).
</p><p>Due to bugs in XLF v.8.1, the libiotk.a library does not work if generated as a static library. Workaround: replace ../iotk/src/libiotk.a
with ../iotk/src/*.o in make.sys. Versions later than 3.1.1 generate a dynamical library. In order to run the executables, the environment variable DYLD LIBRARY PATH must be set to point to the library. With sh/bash,
define:
</p>
<pre>   export DYLD_LIBRARY_PATH=$TOPDIR/iotk/src
</pre>
<p>and with csh, tcsh:
</p>
<pre>   setenv DYLD_LIBRARY_PATH $TOPDIR/iotk/src
</pre>
<p>(info by Pascal Thibaudeau, September 2006).
</p><p><br />
</p>
<a name="SGI_machines_with_IRIX.2FMIPS_compiler"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=25" title="Installation">edit</a>]</span> <span class="mw-headline">SGI machines with IRIX/MIPS compiler</span></h4>
<p>The script moduledep.sh
used by configure doesn’t work properly on old SGI machines: some strings
are truncated (likely a IRIX weirdness). A workaround by Andrea Ferretti:
<a href="http://www.democritos.it/pipermail/pw_forum/2006-May/004200.html" class="external free" title="http://www.democritos.it/pipermail/pw_forum/2006-May/004200.html" rel="nofollow">http://www.democritos.it/pipermail/pw_forum/2006-May/004200.html</a>.
</p><p>Many versions of the MIPS compiler yield compilation errors in conjunction 
with FORALL constructs. There is no known solution other than
editing the FORALL construct that gives a problem, or to replace it with an
equivalent DO...END DO construct.
</p><p>Some versions of the MIPS compiler are confused by the presence of
multiple variable renaming in modules, i.e. by constructs like:
</p>
<pre>   USE mymodule, newname =&gt; oldname
</pre>
<p>in the same file. Workaround: don’t use twice the same newname. Fixed in recent versions.
</p><p><br />
</p>
<a name="Linux_Alphas_with_Compaq_compiler"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=26" title="Installation">edit</a>]</span> <span class="mw-headline">Linux Alphas with Compaq compiler</span></h4>
<p>If at linking stage you get error messages like: 
“undefined reference to ‘for_check_mult_overﬂow64’ ” with
Compaq/HP fortran compiler on Linux Alphas, check the following page:
<a href="http://linux.iol.unh.edu/linux/fortran/faq/cfal-X1.0.2.html" class="external free" title="http://linux.iol.unh.edu/linux/fortran/faq/cfal-X1.0.2.html" rel="nofollow">http://linux.iol.unh.edu/linux/fortran/faq/cfal-X1.0.2.html</a>.
</p>
<a name="T3E"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Installation&amp;action=edit&amp;section=27" title="Installation">edit</a>]</span> <span class="mw-headline">T3E</span></h4>
<p>T3D/T3E is no longer supported since v.3.
</p>
<a name="Running_on_parallel_machines"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Running_on_parallel_machines&amp;action=edit&amp;section=1" title="Running on parallel machines">edit</a>]</span> <span class="mw-headline">Running on parallel machines</span></h2>
<p>Parallel execution is strongly system- and installation-dependent. Typically
one has to specify:
</p>
<ol><li> a launcher program, such as poe, mpirun, mpiexec, with or without  appropriate options
</li><li> the number of processors, typically as an option to the launcher program,  but in some cases to be specified after the program to be executed;
</li><li> the program to be executed, with the proper path if needed: for instance, pw.x, or ./pw.x, or $HOME/bin/pw.x, or whatever applies;
</li><li> other quantum-espresso specific parallelization options, to be read and interpreted by the running code:
<ol><li> the number of “pools” into which processors are to be grouped (for pw.x);
</li><li> the number of “task groups” into which processors are to be grouped (for pw.x and cp.x);
</li><li> the number of “images” used by NEB calculations (for pw.x and cp.x);
</li><li> the number of processors performing iterative diagonalization (for pw.x) or orthonormalization (for cp.x).
</li></ol>
</li></ol>
<p>Item 1) and 2) are machine- and installation-dependent, and may be diﬀerent for
interactive and batch execution. Note that large parallel machines are 
often  configured so as to disallow interactive execution: if in doubt, 
ask your system administrator.
Item 3) also depend on your specific configuration (shell, execution path, etc).
Item 4) is optional: see section <a href="/wiki/index.php/Running_on_parallel_machines#Understanding_Parallelism_in_Quantum-Espresso" title="Running on parallel machines">Understanding Parallelism</a> for the meaning of the 
various options.
</p><p>For illustration, here’s how to run pw.x on 16 processors partitioned into
8 pools (2 processors each), for several typical cases. For convenience, we
also give the corresponding values of PARA PREFIX, PARA POSTFIX to be used
in running the examples distributed with Quantum-ESPRESSO (see section
<a href="/wiki/index.php/Installation#Run_examples" title="Installation">Run examples</a>).
</p><p><b>IBM SP machines,</b> batch:
</p>
<pre>  pw.x -npool 8 &lt; input
  PARA_PREFIX="", PARA_POSTFIX="-npool 8"
</pre>
<p>This should also work interactively, with environment variables NPROC
set to 16, MP HOSTFILE set to the file containing a list of processors.
</p><p><b>IBM SP machines,</b> interactive, using poe:
</p>
<pre>  poe pw.x -procs 16 -npool 8 &lt; input
  PARA_PREFIX="poe", PARA_POSTFIX="-procs 16 -npool 8"
</pre>
<p><b>SGI Origin and PC clusters</b> using mpirun:
</p>
<pre>  mpirun -np 16 pw.x -npool 8 &lt; input
  PARA_PREFIX="mpirun -np 16", PARA_POSTFIX="-npool 8"
</pre>
<p><b>PC clusters</b> using mpiexec:
</p>
<pre>  mpiexec -n 16 pw.x -npool 8 &lt; input
  PARA_PREFIX="mpiexec -n 16", PARA_POSTFIX="-npool 8"
</pre>
<a name="Understanding_Parallelism_in_Quantum-Espresso"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Running_on_parallel_machines&amp;action=edit&amp;section=2" title="Running on parallel machines">edit</a>]</span> <span class="mw-headline">Understanding Parallelism in Quantum-Espresso</span></h3>
<p>Quantum-ESPRESSO uses MPI parallelization.
Data structures are distributed across processors organized in a hierarchy
of groups, which are identified by different MPI communicators level.
The groups hierarchy is as follow:
</p>
<pre> world _ images _ pools _ task groups
               \_ ortho groups
</pre>
<p>world is the group of all processors (MPI_COMM_WORLD).
</p><p>Processors can then be divided into different "images",
corresponding to a point in configuration space (i.e. to
a different set of atomic positions). Such partitioning 
is used when performing Nudged Elastic band (NEB), Meta-dynamics 
and Laio-Parrinello simulations.
</p><p>When k-point sampling is used, each image group can be 
subpartitioned into "pools", and k-points can distributed
to pools.
</p><p>Within each pool, reciprocal space basis set (plane waves)
and real-space grids are distributed across processors.
This is usually referred to as "plane-wave parallelization".
All linear-algebra operations on array of  plane waves / 
real-space grids are automatically and effectively parallelized.
3D FFT is used to transform electronic wave functions from
reciprocal to real space and vice versa. The 3D FFT is
parallelized by distributing planes of the 3D grid in real
space to processors (in reciprocal space, it is columns of
G-vectors that are distributed to processors). 
</p><p>In order to allow good parallelization of the 3D FFT when 
the number of processors exceeds the number of FFT planes,
data can be redistributed to "task groups" so that each group 
can process several wavefunctions at the same time.
</p><p>A further level of parallelization, independent on
plane-wave (pool) parallelization, is the parallelization of
subspace diagonalization (pw.x) or iterative orthonormalization
(cp.x). Both operations required the diagonalization of 
arrays whose dimension is the number of Kohn-Sham states
(or a small multiple). All such arrays are distributed block-like
across the "ortho group", a subgroup of the pool of processors,
organized in a square 2D grid. The diagonalization is then performed
in parallel using standard linear algebra operations. 
(This diagonalization is used by, but should not be confused with,
the iterative Davidson algorithm).
</p><p>Images and pools are loosely coupled and processors communicate
between different images and pools only once in a while, whereas
processors within each pool are tightly coupled and communications
are significant.
</p><p>To control the number of images, pools and task groups,
command line switch: -nimage -npools -ntg can be used.
The dimension of the ortho group is set to the largest
value compatible with the number of processors and with
the number of electronic states. The user can choose a smaller
value using the command line switch -ndiag (pw.x) or -northo (cp.x) .
As an example consider the following command line:
</p>
<pre> mpirun -np 4096 ./pw.x -nimage 8 -npool 2 -ntg 8 -ndiag 144 -input myinput.in
</pre>
<p>This execute the PWscf code on 4096 processors, to simulate a system
with 8 images, each of which is distributed across 512 processors.
K-points are distributed across 2 pools of 256 processors each, 
3D FFT is performed using 8 task groups (64 processors each, so
the 3D real-space grid is cut into 64 slices), and the diagonalization
of the subspace Hamiltonian is distributed to a square grid of 144
processors (12x12).
</p><p>Default values are: -nimage 1 -npool 1 -ntg 1&nbsp;; ndiag is chosen
by the code as the fastest n^2 (n integer) that fits into the size
of each pool.
</p>
<a name="Tricks_and_problems"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Running_on_parallel_machines&amp;action=edit&amp;section=3" title="Running on parallel machines">edit</a>]</span> <span class="mw-headline">Tricks and problems</span></h3>
<a name="Trouble_with_MPI_libraries"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Running_on_parallel_machines&amp;action=edit&amp;section=4" title="Running on parallel machines">edit</a>]</span> <span class="mw-headline">Trouble with MPI libraries</span></h4>
<p>Many users of Quantum-Espresso, in particular those working on PC clusters,
have to rely on themselves (or on less-than-adequate system managers) for 
the correct configuration of software for 
parallel execution. Mysterious and irreproducible crashes in parallel
execution are very often a consequence of a bad software configuration.
Very useful step-by-step instructions can be found in the following post
by Javier Antonio Montoya:
<a href="http://www.democritos.it/pipermail/pw_forum/2008April/008818.htm" class="external free" title="http://www.democritos.it/pipermail/pw_forum/2008April/008818.htm" rel="nofollow">http://www.democritos.it/pipermail/pw_forum/2008April/008818.htm</a> .
</p>
<a name="Understanding_parallel_I.2FO"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Running_on_parallel_machines&amp;action=edit&amp;section=5" title="Running on parallel machines">edit</a>]</span> <span class="mw-headline">Understanding parallel I/O</span></h4>
<p>In parallel exeution, each processor has its own slice of wavefunctions, 
to be written to temporary files during the calculation. The way wavefunctions 
are written by pw.x is governed by variable wf_collect, in namelist control. 
If wf_collect=.true., the final wavefunctions are collected into a single 
directory, written by a single processor, whose format is independent on 
the number of processors. If wf_collect=.false. (default) each processor
writes its own slice of the final 
wavefunctions to disk in the internal format used by PWscf. 
</p><p>The former case requires more
disk I/O and disk space, but produces portable data files; the latter case
requires less I/O and disk space, but the data so produced can be read only
by a job running on the same number of processors and pools, and if all files
are on a file system that is visible to all processors (i.e., you cannot use local
scratch directories: there is presently no way to ensure that the distribution
of processes on processors will follow the same pattern for diﬀerent jobs).
</p><p>cp.x instead always collects the final wavefunctions into a single directory.
Files written by pw.x can be read by cp.x only if wf_collect=.true. (and if
produced for k=0 case). 
</p><p>With the new file format (v.3.1 and later) all data (except 
wavefunctions in pw.x if wf_collect=.false.) is written to and read from
a single directory outdir/prefix.save. A copy of pseudopotential files
is also written there. If some processor cannot access outdir/prefix.save,
it reads the pseudopotential files from the pseudopotential directory
specified in input data. Unpredictable results may follow if those files
are not the same as those in the data directory!
</p><p>Avoid I/O to network-mounted disks (via NFS) as much as you can! 
Ideally the scratch directory (ESPRESSO_TMPDIR) should be a modern 
Parallel File System. If you do not have any, you can use local
scratch disks (i.e. each node is physically connected to a disk
and writes to it) but you may run into trouble anyway if you 
need to access your files that are scattered in an unpredictable
way across disks residing on different nodes.
</p><p>You can use option "disk_io='minimal'", or even 'none', if you run
into trouble (or angry system managers) with eccessive I/O with pw.x. 
Note that this will increase your memory usage and may limit or prevent 
restarting from interrupted runs.
</p>
<a name="Trouble_with_input_files"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Running_on_parallel_machines&amp;action=edit&amp;section=6" title="Running on parallel machines">edit</a>]</span> <span class="mw-headline">Trouble with input files</span></h4>
<p>Some implementations of the MPI library have problems with input 
redirection in parallel. This typically shows up under the form of
mysterious errors when reading data. If this happens, use the option 
-in (or -inp or -input), followed by the input file name. 
Example: <i>pw.x -in inputfile npool 4 &gt; outputfile</i>. Of course the 
input file must be accessible by the processor that must read it
(only one processor reads the input file and subsequently broadcasts
its contents to all other processors).
</p><p>Apparently the LSF implementation of MPI libraries manages to ignore or to
confuse even the -in/inp/input mechanism that is present in all quantum-espresso 
codes. In this case, use the -i option of mpirun.lsf to provide an input
file.
</p>
<a name="IBM_sp5"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Running_on_parallel_machines&amp;action=edit&amp;section=7" title="Running on parallel machines">edit</a>]</span> <span class="mw-headline">IBM sp5</span></h4>
<p>A bug in the poe environment of IBM sp5 machines may cause a dramatic 
slowdown of quantumespresso in parallel execution. Workaround: set
environment variable MP STDINMODE to 0, as in
</p>
<pre> export MP_STDINMODE=0
</pre>
<p>for sh/bash,
</p>
<pre> setenv MP_STDINMODE 0
</pre>
<p>for csh/tcsh; or start the code with option stdinmode 0 to poe:
</p>
<pre> poe stdinmode 0 [options] [executable code] &lt; input file
</pre>
<p>(maybe obsolete)
</p>
<a name="Cray_XT3"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Running_on_parallel_machines&amp;action=edit&amp;section=8" title="Running on parallel machines">edit</a>]</span> <span class="mw-headline">Cray XT3</span></h4>
<p>On the cray xt3 there is a special hack to keep files in
memory instead of writing them without changes to the code.
You have to do a: 
module load iobuf
before compiling and then add liobuf at link time.
If you run a job you set the environment variable 
IOBUF_PARAMS to proper numbers and you can gain a lot.
Here is one example:
</p><p>env IOBUF_PARAMS='*.wfc*:noflush:count=1:size=15M:verbose,*.dat:count=2:size=50M: \
lazyflush:lazyclose:verbose,*.UPF*.xml:count=8:size=8M:verbose'\
pbsyod ~/pwscf/pwscfcvs/bin/pw.x npool 4 in si64pw2x2x2.inp &gt; &amp; \
si64pw2x2x232moreiobuf.out &amp;
</p><p>This will ignore all flushes on the *wfc* (scratch files) using a
single i/o buffer large enough to contain the whole file (~12 MB here).
this way they are actually never(!) written to disk.
The *.dat files are part of the restart, so needed, but you can be
'lazy' since they are writeonly. .xml files have a lot of accesses
(due to iotk), but with a few rather small buffers, this can be
handled as well. You have to pay attention not to make the buffers
too large, if the code needs a lot of memory, too and in this example
there is a lot of room for improvement. After you have tuned those
parameters, you can remove the 'verboses' and enjoy the fast execution.
Apart from the i/o issues the cray xt3 is a really nice and fast machine.
(Info by Axel Kohlmeyer, maybe obsolete)
</p>
<a name="Pseudopotentials"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Printable_Quantum-Espresso_Documentation&amp;action=edit&amp;section=1" title="Edit section: Pseudopotentials">edit</a>]</span> <span class="mw-headline">Pseudopotentials</span></h2>
<a name="Supported_format"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Pseudopotentials&amp;action=edit&amp;section=1" title="Pseudopotentials">edit</a>]</span> <span class="mw-headline">Supported format</span></h3>
<p>Currently PWscf and CP support both Ultrasoft (US) Vanderbilt pseudopotentials (PPs) and Norm-Conserving (NC) Hamann-Schluter-Chiang 
PPs in separable Kleinman-Bylander form. Calculation of third-order 
derivatives is not (yet) implemented with US PPs. The Gamma-only phonon
code is also restricted to NC PPs.
</p><p>The Quantum-ESPRESSO package uses a <a href="/wiki/index.php/Unified_pseudopotential_format" title="Unified pseudopotential format">unified pseudopotential format</a> (UPF <a href="http://www.pwscf.org/format.htm" class="external autonumber" title="http://www.pwscf.org/format.htm" rel="nofollow">[1]</a>) for all types of PPs, but still accepts a number of other formats:
</p>
<ul><li> the “old PWscf ” format for NC PPs (PWscf only!),
</li><li> the “new PWscf ” format for NC and US PPs,
</li><li> the “Vanderbilt” format (formatted, not binary) for NC and US PPs.
</li></ul>
<p>Support for the “old CP” and “old FPMD” formats for NC PPs (CP only) is discontinued 
in v.4 and later. See also <a href="http://www.pwscf.org/oldformat.htm" class="external free" title="http://www.pwscf.org/oldformat.htm" rel="nofollow">http://www.pwscf.org/oldformat.htm</a>.
</p>
<a name="Obtaining_a_pseudopotential"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Pseudopotentials&amp;action=edit&amp;section=2" title="Pseudopotentials">edit</a>]</span> <span class="mw-headline">Obtaining a pseudopotential</span></h3>
<p>A large collection of PPs (currently about 75 elements covered) can be
downloaded from the Pseudopotentials Page of the Quantum-ESPRESSO
web site (<a href="http://www.pwscf.org/pseudo.htm" class="external free" title="http://www.pwscf.org/pseudo.htm" rel="nofollow">http://www.pwscf.org/pseudo.htm</a>). Check the <a href="/wiki/index.php/Naming_convention_for_the_pseudopotential" title="Naming convention for the pseudopotential">naming convention for the pseudopotential</a> files.
</p><p>Other electronic-structure packages  provide
tables of PPs that can be freely downloaded,
but need to be converted into
a suitable format for use with Quantum-ESPRESSO:
</p>
<ul><li> CAMPOS: <a href="https://wiki.fysik.dtu.dk/dacapo/Pseudopotential_Library" class="external free" title="https://wiki.fysik.dtu.dk/dacapo/Pseudopotential_Library" rel="nofollow">https://wiki.fysik.dtu.dk/dacapo/Pseudopotential_Library</a>
</li></ul>
<p>Binary Vanderbilt format, can be converted using the <a href="/wiki/index.php/Uspp2upf.x" title="Uspp2upf.x">uspp2upf.x</a> utility in the upftools/
directory. In case of trouble with binary files read this:<br />
<a href="http://www.theochem.ruhr-uni-bochum.de/~axel.kohlmeyer/cpmd-linux.html#endian" class="external free" title="http://www.theochem.ruhr-uni-bochum.de/~axel.kohlmeyer/cpmd-linux.html#endian" rel="nofollow">http://www.theochem.ruhr-uni-bochum.de/~axel.kohlmeyer/cpmd-linux.html#endian</a> 
</p>
<ul><li> ABINIT: <a href="http://www.abinit.org/Psps/?text=psps" class="external free" title="http://www.abinit.org/Psps/?text=psps" rel="nofollow">http://www.abinit.org/Psps/?text=psps</a>
</li></ul>
<p>Some of these pseudopotentials can be converted using the <a href="/wiki/index.php/Fhi2upf.x" title="Fhi2upf.x">fhi2upf.x</a> utility in the upftools/
directory
</p>
<a name="Generating_a_pseudopotential"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Pseudopotentials&amp;action=edit&amp;section=3" title="Pseudopotentials">edit</a>]</span> <span class="mw-headline">Generating a pseudopotential</span></h3>
<p>If you do not find there the PP you need (because there is no PP for the
atom you need or you need a diﬀerent exchange-correlation functional or a
diﬀerent core-valence partition or for whatever reason may apply), it may be
taken, if available, from published tables, such as e.g.:
</p>
<ul><li> G.B. Bachelet, D.R. Hamann and M. Schluter, Phys. Rev. B 26, 4199 (1982)
</li><li> X. Gonze, R. Stumpf, and M. Scheﬄer, Phys. Rev. B 44, 8503 (1991)
</li><li> S. Goedecker, M. Teter, and J. Hutter, Phys. Rev. B 54, 1703 (1996)
</li></ul>
<p>or otherwise it must be generated. Since version 2.1, Quantum-ESPRESSO
includes a <a href="/wiki/index.php/Ld1.x" title="Ld1.x">PP generation package</a>, in the directory <tt style="font-size:120%">atomic/</tt> (sources) and
<tt style="font-size:120%">atomic_doc/</tt> (documentation, tests and examples). The package can generate
both NC and US PPs in UPF format. We refer to its documentation for
instructions on how to generate PPs with the <tt style="font-size:120%">atomic/</tt> code.
</p><p>Other PP generation packages are available on-line:
</p>
<ul><li> David Vanderbilt’s code (UltraSoft PPs): <a href="http://www.physics.rutgers.edu/~dhv/uspp/index.html" class="external free" title="http://www.physics.rutgers.edu/~dhv/uspp/index.html" rel="nofollow">http://www.physics.rutgers.edu/~dhv/uspp/index.html</a>
</li><li> OPIUM (Norm-Conserving PPs): <a href="http://opium.sourceforge.net" class="external free" title="http://opium.sourceforge.net" rel="nofollow">http://opium.sourceforge.net</a>
</li><li> Fritz Haber’s code (Norm-Conserving PPs): <a href="http://www.fhi-berlin.mpg.de/th/fhi98md/fhi98PP" class="external free" title="http://www.fhi-berlin.mpg.de/th/fhi98md/fhi98PP" rel="nofollow">http://www.fhi-berlin.mpg.de/th/fhi98md/fhi98PP</a>
</li><li> Jose´-Luis Martins’ code (Norm-Conserving PPs): <a href="http://bohr.inesc-mn.pt/~jlm/pseudo.html" class="external free" title="http://bohr.inesc-mn.pt/~jlm/pseudo.html" rel="nofollow">http://bohr.inesc-mn.pt/~jlm/pseudo.html</a>
</li></ul>
<p>The first two codes produce PPs in one of the acceptable formats; the
third, in a format that can be converted to unified format using the
utilities of directory <tt style="font-size:120%">upftools/</tt>.
</p><p><b>Remember:</b> always test the PPs on simple test systems before proceeding
to serious calculations.
</p>
<a name="References"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Pseudopotentials&amp;action=edit&amp;section=4" title="Pseudopotentials">edit</a>]</span> <span class="mw-headline">References</span></h3>
<p>This section contains an extended list of references for NC PPs.<br />
</p><p>Here is the very basic and essential:
</p>
<ul><li> D. R. Hamann, M. Schluter, and C. Chiang, Phys. Rev. Lett. 43, 1494 (1979)
</li><li> L. Kleinmann and D. M. Bylander, Phys. Rev. Lett. 48, 1425 (1982) 
</li></ul>
<p>The second reference discusses the fully seperable Kleinman-Bylander (KB) form of the NC PP.
This is what is implemented in Quantum Espresso and most PW-based DFT codes. The reference
below contains a more comprehensive discussion and is highly recommended.
</p>
<ul><li> X. Gonze, R. Stumpf, M. Scheffler, Phys. Rev. B 44, 8503 (1991)
</li></ul>
<p>It is often necessary to include unbound high angular momentum states in the NC PP. For example,
d states in silicon. D. R. Hamann generalized this procedure to states of arbitrary energy:
</p>
<ul><li> D. R. Hamann, Phys. Rev. B 40, 2980 (1989) 
</li></ul>
<p>The construction of the NC PP within the r_c is not unique and so there are several prescriptions
with that of Troullier-Martins (TM) and Rappe-Rabe-Kaxiras-Joannopoulos (RRKJ) being the
most frequently used:
</p>
<ul><li> A. M. Rappe, K. M. Rabe, E. Kaxiras, and J. D. Joannopoulos, Phys. Rev. B 41, 1227 (1990)
</li><li> N. Troullier and J. L. Martins, Phys. Rev. B 43, 1993 (1991) 
</li></ul>
<p>When there is a significant overlap of the valence and core charge density, it is often necessary
to use nonlinear core corrections (NLCC):
</p>
<ul><li> S. G. Louie, S. Froyen, and M. L. Cohen, Phys. Rev. B 26, 1738 (1982)
</li><li> D. Porezag, M. R. Pederson, and A. Y. Liu, Phys. Rev. B 60, 14312 (1999)
</li></ul>
<p>Finally here are advanced topics in NC PP, mostly for the very ambitious:
</p>
<ul><li> E. L. Shirley, D. C. Allan, R. M. Martin, and J. D. Joannopoulos, Phys. Rev. B 40, 3652 (1989) 
</li><li> M. Teter, Phys. Rev. B 48, 5031 (1993) 
</li><li> N. J. Ramer and A. M. Rappe, Phys. Rev. B, 12471 (1999)
</li></ul>
<a name="Using_PWscf"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=1" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Using PWscf</span></h2>
<p>Input files for the PWscf codes may be either written by hand (the good old
way), or produced via the “PWgui” graphical interface by Anton Kokalj, 
included in the Quantum-ESPRESSO distribution. See PWgui-x.y.z /INSTALL
(where x.y.z is the version number) for more info on PWgui, or GUI/README
if you are using CVS sources.
</p><p>You may take the examples distributed with Quantum-ESPRESSO as
templates for writing your own input files: see section 2.3, “Run examples”.
In the following, whenever we mention “Example N”, we refer to those. Input
files are those in the results directories, with names ending in .in (they’ll
appear after you’ve run the examples).
</p><p>Note about exchange-correlation: the type of exchange-correlation used
in the calculation is read from PP files. All PP’s must have been generated
using the same exchange-correlation.
</p>
<a name="Electronic_and_ionic_structure_calculations"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=2" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Electronic and ionic structure calculations</span></h3>
<p>Electronic and ionic structure calculations are performed by program pw.x.
</p>
<a name="Input_data"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=3" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Input data</span></h4>
<p>The input data is organized as several namelists, followed by other fields
introduced by keywords.
</p><p>The namelists are
</p>
<pre>     &amp;CONTROL: general variables controlling the run
     &amp;SYSTEM: structural information on the system under investigation
     &amp;ELECTRONS: electronic variables: self-consistency, smearing
     &amp;IONS (optional): ionic variables: relaxation, dynamics
     &amp;CELL (optional): variable-cell dynamics
     &amp;PHONON (optional): information required to produce data for
     phonon calculations
   
</pre>
<p>Optional namelist may be omitted if the calculation to be performed
does not require them. This depends on the value of variable calculation
in namelist &amp;CONTROL. Most variables in namelists have default values. Only
the following variables in &amp;SYSTEM must always be specified:
</p>
<pre>     ibrav (integer): bravais-lattice index
     celldm (real, dimension 6): crystallographic constants
     nat (integer): number of atoms in the unit cell
     ntyp (integer): number of types of atoms in the unit cell
     ecutwfc (real): kinetic energy cutoff (Ry) for wavefunctions.
</pre>
<p>For metallic systems, you have to specify how metallicity is treated by setting
variable occupations. If you choose occupations=’smearing’, you have
to specify the smearing width degauss and optionally the smearing type
smearing. If you choose occupations=’tetrahedra’, you need to specify 
a suitable uniform k-point grid (card K POINTS with option automatic).
Spin-polarized systems must be treated as metallic system, except the 
special case of a single k-point, for which occupation numbers can be fixed
(occupations=’from input’ and card OCCUPATIONS).
</p><p>Explanations for the meaning of variables ibrav and celldm are in file
INPUT PW. Please read them carefully. There is a large number of other
variables, having default values, which may or may not fit your needs.
</p><p>After the namelists, you have several fields introduced by keywords with
self-explanatory names:
</p>
<pre>      ATOMIC SPECIES
      ATOMIC POSITIONS
      K POINTS
      CELL PARAMETERS (optional)
      OCCUPATIONS (optional)
      CLIMBING IMAGES (optional)
      
</pre>
<p>The keywords may be followed on the same line by an option. Unknown
fields (including some that are specific to CP code) are ignored by PWscf.
See file Doc/INPUT PW for a detailed explanation of the meaning and format
of the various fields.
</p><p>Note about k points: The k-point grid can be either automatically generated 
or manually provided as a list of k-points and a weight in the Irreducible
Brillouin Zone only of the Bravais lattice of the crystal. The code will 
generate (unless instructed not to do so: see variable nosym) all required k-points
and weights if the symmetry of the system is lower than the symmetry of the
Bravais lattice. The automatic generation of k-points follows the convention
of Monkhorst and Pack.
</p>
<a name="Typical_cases"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=4" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Typical cases</span></h4>
<p>We may distinguish the following typical cases for pw.x:
</p><p><b>single-point (fixed-ion) SCF calculation:</b> Set calculation=’scf’.
</p><p>Namelists &amp;IONS and &amp;CELL need not to be present (this is the default).<br />
See Example 01.
</p><p><b>band structure calculation:</b> First perform a SCF calculation as above;
then do a non-SCF calculation by specifying calculation=’bands’ or
calculation=’nscf’, with the desired k-point grid and number nbnd
of bands. If you are interested in calculating only the Kohn-Sham states
for the given set of k-points, use calculation=’bands’. If you are
interested in further processing of the results of non-SCF calculations
(for instance, in DOS calculations) use calculations=’nscf’.
Specify nosym=.true. to avoid generation of additional k-points in
low symmetry cases. Variables prefix and outdir, which determine
the names of input or output files, should be the same in the two runs.<br />
See Example 01. <i>Important:</i> atomic positions are read from input,
NOT from the data file!
</p><p><b>structural optimization:</b> Specify calculation=’relax’ and add namelist &amp;IONS.
</p><p>All options for a single SCF calculation apply, plus a few others. You
may follow a structural optimization with a non-SCF band-structure
calculation, but do not forget to update the input ionic coordinates.<br />
See Example 03.
</p><p><b>molecular dynamics:</b> Specify calculation=’md’ and time step dt.
</p><p>Use variable ion dynamics in namelist &amp;IONS for a fine-grained control
of the kind of dynamics. Other options for setting the initial temperature and for thermalization using velocity rescaling are available. Remember: this is MD on the electronic ground state, not Car-Parrinello MD.<br /> 
See Example 04.
</p><p><b>polarization via Berry Phase:</b> See Example 10, its README, and the documentation in the header of PW/bp_c_phase.f90.
</p><p><b>Nudged Elastic Band calculation:</b>  Specify calculation=’neb’ and add namelist &amp;IONS.
</p><p>All options for a single SCF calculation apply, plus a few others. In the
namelist &amp;IONS the number of images used to discretize the elastic band
must be specified. All other variables have a default value. Coordinates
of the initial and final image of the elastic band have to be specified
in the ATOMIC POSITIONS card. A detailed description of all input
variables is contained in the file Doc/INPUT PW. See also Example 17.
</p>
<a name="Data_files"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=5" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Data files</span></h4>
<p>The output data files are written in the directory specified by variable
outdir, with names specified by variable prefix (a string that is prepended
to all file names, whose default value is: prefix=’pwscf’). The <i>iotk</i>
toolkit is used to write the file in a XML format, whose definition can
be found in the <a href="/wiki/index.php/Developer_Manual" title="Developer Manual">Developer Manual</a>. In order to use the data directory
on a different machine, you need to convert the binary files to formatted
and back, using the <i>bin/iotk</i> script (v.4 and later).
</p><p>The execution stops if you create a file "prefix.EXIT" in the working 
directory. IMPORTANT NOTE: this is the directory where the program 
is executed, NOT the directory "outdir" defined in input, where files 
are written. Note that with some versions of MPI, the "working directory" 
is the directory where the pw.x executable is! The advantage of this 
procedure is that all files are properly closed, whereas  just killing 
the process may leave data and output files in unusable state.
</p>
<a name="Phonon_calculations"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=6" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Phonon calculations</span></h3>
<p>Phonon calculation is a multiple-step process, with at least two steps:
First, you have to find the ground-state atomic and electronic configuration;
Second, you can calculate phonons using Density-Functional Perturbation Theory.
Further processing to calculate Interatomic Force Constants, to add macroscopic
electric field and impose Acoustic Sum Rules at q=0 may be needed.
</p><p>Since version 4 it is possible to safely stop execution of the phonon code using
the same mechanism of the pw.x code, i.e. by creating a file prefix.EXIT in the 
working directory. Execution can be resumed by setting 'recover=.true.' in the
subsequent input data.
</p>
<a name="Single-q_calculation"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=7" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Single-q calculation</span></h4>
<p>The phonon code ph.x calculates normal modes at a given q-vector, starting
from data files produced by pw.x with a simple SCF calculation. For phonons 
at a generic q-vector, you need to specify the option lnscf=.true. in the
input data of ph.x
( an alternative procedure for phonons at a generic q-vector is to perform
first a SCF calculation, then a band-structure calculation (see above) with 
calculation=’phonon’, specifying the q-vector in variable xq of namelist &amp;PHONON ).
</p><p>The output data file appear in the directory specified by variables outdir,
with names specified by variable prefix. After the output file(s) has been
produced (do not remove any of the files, unless you know which are used
and which are not), you can run ph.x.
</p><p>The first input line of ph.x is a job identifier. At the second line the
namelist &amp;INPUTPH starts. The meaning of the variables in the namelist
(most of them having a default value) is described in file INPUT PH. Variables
outdir and prefix must be the same as in the input data of pw.x. Presently
you must also specify amass (real, dimension ntyp): the atomic mass of each
atomic type.
</p><p>After the namelist you must specify the q-vector of the phonon mode.
This must be the same q-vector given in the input of pw.x.
</p><p>Notice that the dynamical matrix calculated by ph.x at q = 0 does not
contain the non-analytic term occuring in polar materials, i.e. there is no
LO-TO splitting in insulators. Moreover no Acoustic Sum Rule (ASR) is
applied. In order to have the complete dynamical matrix at q = 0 including
the non-analytic terms, you need to calculate eﬀective charges by specifying
option epsil=.true. to ph.x.
</p><p>Use program dynmat.x to calculate the correct LO-TO splitting, IR cross
sections, and to impose various forms of ASR. If ph.x was instructed to 
calculate Raman coeﬃcients, dynmat.x will also calculate Raman cross sections
for a typical experimental setup.
</p><p>A sample phonon calculation is performed in Example 02.
</p>
<a name="Calculation_of_interatomic_force_constants_in_real_space"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=8" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Calculation of interatomic force constants in real space</span></h4>
<p>First, dynamical matrices D(q) are calculated and saved for a suitable uniform 
grid of q-vectors (only those in the Irreducible Brillouin Zone of the
crystal are needed). Although this can be done one q-vector at the time, a
simpler procedure is to specify variable ldisp=.true. and to set variables
nq1,nq2,nq3 to some suitable Monkhorst-Pack grid, that will be automatically
generated, centered at q = 0. Do not forget to specify epsil=.true.
in the input data of ph.x if you want the correct TO-LO splitting in polar
materials.
</p><p>Second, code q2r.x reads the D(q) dynamical matrices produced in the
preceding step and Fourier-transform them, writing a file of Interatomic Force
Constants in real space, up to a distance that depends on the size of the grid
of q-vectors. Program matdyn.x may be used to produce phonon modes and
frequencies at any q using the Interatomic Force Constants file as input.
See Example 06.
</p>
<a name="Calculation_of_electron-phonon_interaction_coefficients"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=9" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Calculation of electron-phonon interaction coefficients</span></h4>
<p>The calculation of electron-phonon coeﬃcients in metals is made diﬃcult by
the slow convergence of the sum at the Fermi energy. It is convenient to 
calculate phonons, for each q-vector of a suitable grid, using a smaller k-point
grid, saving the dynamical matrix and the self-consistent first-order variation
of the potential (variable fildvscf). Then a non-SCF calculation with
a larger k-point grid is performed. Finally the electron-phonon calculation is
performed by specifying elph=.true., trans=.false., and the input files
fildvscf, fildyn. The electron-phonon coeﬃcients are calculated using several
values of gaussian broadening (see PH/elphon.f90) because this quickly
shows whether results are converged or not with respect to the k-point grid
and Gaussian broadening. See Example 07.
</p><p>All of the above must be repeated for all desired q-vectors and the final
result is summed over all q-vectors, using pwtools/lambda.x. The input
data for the latter is described in the header of pwtools/lambda.f90.
</p>
<a name="Post-processing"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Using_PWscf&amp;action=edit&amp;section=10" title="Using PWscf">edit</a>]</span> <span class="mw-headline">Post-processing</span></h3>
<p>There are a number of auxiliary codes performing postprocessing tasks such
as plotting, averaging, and so on, on the various quantities calculated by
pw.x. Such quantities are saved by pw.x into the output data file(s).
</p><p>The main postprocessing code pp.x reads data file(s), extracts or calculates 
the selected quantity, writes it into a format that is suitable for plotting.
</p><p>Quantities that can be read or calculated are:
</p>
<pre>     charge density
     spin polarization
     various potentials
     local density of states at EF
     local density of electronic entropy
     STM images
     wavefunction squared
     electron localization function
     planar averages
     integrated local density of states
</pre>
<p>Various types of plotting (along a line, on a plane, three-dimensional, polar)
and output formats (including the popular cube format) can be specified.
The output files can be directly read by the free plotting system Gnuplot
(1D or 2D plots), or by code plotrho.x that comes with PWscf (2D plots),
or by advanced plotting software XCrySDen and gOpenMol (3D plots).
</p><p>See file INPUT_PP for a detailed description of the input for code pp.x.
See Example 05 for a charge density plot.
</p><p>The postprocessing code bands.x reads data file(s), extracts eigenvalues,
regroups them into bands (the algorithm used to order bands and to resolve
crossings may not work in all circumstances, though). The output is written
to a file in a simple format that can be directly read by plotting program
plotband.x. Unpredictable plots may results if k-points are not in sequence
along lines. See Example 05 for a simple band plot.
</p><p>The postprocessing code projwfc.x calculates pro jections of wavefunction
over atomic orbitals. The atomic wavefunctions are those contained
in the pseudopotential file(s). The L¨wdin population analysis (similar to
</p><p>Mulliken analysis) is presently implemented. The projected DOS (PDOS,
the DOS pro jected onto atomic orbitals) can also be calculated and written
to file(s). More details on the input data are found in the header of file
PP/projwfc.f90. The auxiliary code sumpdos.x (courtesy of Andrea Ferretti) 
can be used to sum selected PDOS, by specifiying the names of files
containing the desired PDOS. Type sumpdos.x -h or look into the source
code for more details. The total electronic DOS is instead calculated by code
PP/dos.x. See Example 08 for total and pro jected electronic DOS calculations.
</p><p>The postprocessing code path int.x is intended to be used in the framework of NEB calculations. 
It is a tool to generate a new path (what is actually generated is the restart file) starting from 
an old one through interpolation (cubic splines). The new path can be discretized with a different 
number of images (this is its main purpose), images are equispaced and the interpolation can be also
performed on a subsection of the old path. The input file needed by path int.x can be easily set up 
with the help of the self-explanatory path_int.sh shell script.
</p>
<a name="Using_CP"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=1" title="Using CP">edit</a>]</span> <span class="mw-headline">Using CP</span></h2>
<p>This section is intended to explain how to perform basic Car-Parrinello (CP)
simulations using the CP codes.
</p><p>It is important to understand that a CP simulation is a sequence of different runs, some of them used to “prepare” the initial state of the system,
and other performed to collect statistics, or to modify the state of the system
itself, i.e. modify the temperature or the pressure.
</p><p>To prepare and run a CP simulation you should:
</p><p>1. Define the system:
</p>
<pre>        (a) atomic positions
        (b) system cell
        (c) pseudopotentials
        (d) number of electrons and bands
        (e) cut-oﬀs
        (f) FFT grids (CP code only)
</pre>
<p>2. The first run, when starting from scratch, is always an electronic minimization, with fixed ions and cell, to bring the electronic system on the ground state (GS) relative to the starting atomic configuration.<br />
Example of input file (Benzene Molecule):
</p>
<pre>        &amp;control
           title = ’ Benzene Molecule ’,
           calculation = ’cp’,
           restart_mode = ’from_scratch’,
           ndr = 51,
           ndw = 51,
           nstep = 100,
           iprint = 10,
           isave = 100,
           tstress = .TRUE.,
           tprnfor = .TRUE.,
           dt    = 5.0d0,
           etot_conv_thr = 1.d-9,
           ekin_conv_thr = 1.d-4,
           prefix = ’c6h6’
           pseudo_dir=’/scratch/acv0/benzene/’,
           outdir=’/scratch/acv0/benzene/Out/’
        /
        &amp;system
           ibrav = 14,
           celldm(1) = 16.0,
           celldm(2) = 1.0,
           celldm(3) = 0.5,
           celldm(4) = 0.0,
           celldm(5) = 0.0,
           celldm(6) = 0.0,
           nat = 12,
           ntyp = 2,
           nbnd = 15,
           nelec = 30,
           ecutwfc = 40.0,
           nr1b= 10, nr2b = 10, nr3b = 10,
           xc_type = ’BLYP’
        /
        &amp;electrons
           emass = 400.d0,
           emass_cutoff = 2.5d0,
           electron_dynamics = ’sd’,
        /
        &amp;ions
           ion_dynamics = ’none’,
        /
        &amp;cell
           cell_dynamics = ’none’,
           press = 0.0d0,
         /
         ATOMIC_SPECIES
         C 12.0d0 c_blyp_gia.pp
         H 1.00d0 h.ps
         ATOMIC_POSITIONS (bohr)
         C     2.6 0.0 0.0
         C     1.3 -1.3 0.0
         C    -1.3 -1.3 0.0
         C    -2.6 0.0 0.0
         C    -1.3 1.3 0.0
         C     1.3 1.3 0.0
         H     4.4 0.0 0.0
         H     2.2 -2.2 0.0
         H    -2.2 -2.2 0.0
         H    -4.4 0.0 0.0
         H    -2.2 2.2 0.0
         H     2.2 2.2 0.0
  
</pre>
<p>You can find the description of the input variables in file INPUT CP in the Doc/ directory. A short description of the logic behind the choice of parameters in contained in INPUT.HOWTO
</p>
<a name="Reach_the_electronic_groundstate_.28GS.29"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=2" title="Using CP">edit</a>]</span> <span class="mw-headline">Reach the electronic groundstate (GS)</span></h3>
<p>The first step in a CP scheme is to reach the electronic ground state, for a given electronic position.
Sometimes a single run is not enough to reach the GS. In this case, you need to re-run the electronic minimization stage. Use the input of the first run, changing restart mode = ’from scratch’ to restart mode = ’restart’.
</p><p><b>Important:</b> unless you are already experienced with the system you are studying or with the code internals, usually you need to tune some input parameters, like emass, dt, and cut-oﬀs. For this purpose, a few trial runs could be useful: you can perform short minimizations (say, 10 steps) changing and adjusting these parameters to your need. You could specify the degree of convergence with these two thresholds:
</p><p><b>etot conv thr:</b> total energy diﬀerence between two consecutive steps
</p><p><b>ekin conv thr:</b> value of the fictitious kinetic energy of the electrons
</p><p>Usually we consider the system on the GS when ekin conv thr &lt;∼ 10−5 . You could check the value of the fictitious kinetic energy on the standard output (column EKINC).
</p><p>Different strategies are available to minimize electrons, but the most used ones are:
</p>
<ul><li> steepest descent:
</li></ul>
<pre> electron_dynamics = ’sd’
</pre>
<ul><li> damped dynamics:
</li></ul>
<pre> electron_dynamics = ’damp’,
 electron_damping = 0.1,
</pre>
<p>See input description to compute damping factor, usually the value is between 0.1 and 0.5.
</p>
<a name="Relax_the_system"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=3" title="Using CP">edit</a>]</span> <span class="mw-headline">Relax the system</span></h3>
<p>Once your system is in the GS, depending on how you have prepared the starting atomic configuration, you 
</p>
<ul><li> if you have set the atomic positions “by hand” and/or from a classical code, check the forces on atoms, and if they are large (∼0.1 − 1.0 atomic units), you should perform an ionic minimization, otherwise the system could break up during the dynamics.
</li><li> if you have taken the positions from a previous run or a previous ab-initio simulation, check the forces, and if they are too small (∼ 10−4 atomic units), this means that atoms are already in equilibrium positions and, even if left free, they will not move. Then you need to randomize positions a little bit. see below.
</li></ul>
<p>1. Minimize ionic positions.
</p><p>As we pointed out in 4) if the interatomic forces are too high, the system could “explode” if we switch on the ionic dynamics. To avoid that we need to relax the system.
Again there are different strategies to relax the system, but the most used are again steepest descent or damped dynamics for ions and electrons. You could also mix electronic and ionic minimization scheme freely, i.e. ions in steepest and electron in damping or vice versa.
</p><p>(a) suppose we want to perform a steepest for ions. Then we should specify the following section for ions:
</p>
<pre>        &amp;ions
          ion_dynamics = ’sd’,
        /
        Change also the ionic masses to accelerate the minimization:
</pre>
<pre>        ATOMIC_SPECIES
         C 2.0d0 c_blyp_gia.pp
         H 2.00d0 h.ps
</pre>
<p>while leaving unchanged other input parameters.
<b>Note</b> that if the forces are really high (&gt; 1.0 atomic units), you
should always use stepest descent for the first relaxation steps
(∼ 100).
</p><p>(b) as the system approaches the equilibrium positions, the steepest descent scheme slows down, so is better to switch to damped dynamics:
</p>
<pre>        &amp;ions
          ion_dynamics = ’damp’,
          ion_damping = 0.2,
          ion_velocities = ’zero’,
        /
</pre>
<p>A value of ion damping between 0.05 and 0.5 is usually used for many systems. It is also better to specify to restart with    zero ionic and electronic velocities, since we have changed the masses.
</p><p>Change further the ionic masses to accelerate the minimization:
</p>
<pre>          ATOMIC_SPECIES
          C 0.1d0 c_blyp_gia.pp
          H 0.1d0 h.ps
</pre>
<p>(c) when the system is really close to the equilibrium, the damped dynamics slow down too, especially because, since we are moving electron and ions together, the ionic forces are not properly correct, then it is often better to perform a ionic step every N electronic steps, or to move ions only when electron are in their GS (within the chosen threshold).
</p><p>This can be specified adding, in the ionic section, the ion_nstepe parameter, then the ionic input section become as follows:
</p>
<pre>        &amp;ions
          ion_dynamics = ’damp’,
          ion_damping = 0.2,
          ion_velocities = ’zero’,
          ion_nstepe = 10,
        /
</pre>
<p>Then we specify in the control input section:
</p>
<pre>          etot_conv_thr = 1.d-6,
          ekin_conv_thr = 1.d-5,
          forc_conv_thr = 1.d-3
</pre>
<p>As a result, the code checks every 10 electronic steps whether
the electronic system satisfies the two thresholds etot_conv_thr,
ekin_conv_thr: if it does, the ions are advanced by one step.
The process thus continues until the forces become smaller than
forc_conv_thr.<br />
<b>Note</b> that to fully relax the system you need many run, and different strategies, that you shold mix and change in order to speed-up the convergence. The process is not automatic, but is strongly based on experience, and trial and error.
</p><p>Remember also that the convergence to the equilibrium positions depends on the energy threshold for the electronic GS, in fact correct forces (required to move ions toward the minimum) are obtained only when electrons are in their GS. Then a small threshold on forces could not be satisfied, if you do not require an even smaller threshold on total energy.
</p><p>2. Randomization of positions.
</p><p>If you have relaxed the system or if the starting system is already in
the equilibrium positions, then you need to move ions from the equilibrium positions, otherwise they won’t move in a dynamics simulation.
After the randomization you should bring electrons on the GS again, in order to start a dynamic with the correct forces and with electrons in the GS. Then you should switch oﬀ the ionic dynamics and activate the randomization for each species, specifying the amplitude of the randomization itself. This could be done with the following ionic input section:
</p>
<pre>         &amp;ions
           ion_dynamics = ’none’,
           tranp(1) = .TRUE.,
           tranp(2) = .TRUE.,
           amprp(1) = 0.01
           amprp(2) = 0.01
         /
</pre>
<p>In this way a random displacement (of max 0.01 a.u.) is added to atoms of specie 1 and 2. All other input parameters could remain the same.
Note that the diﬀerence in the total energy (etot) between relaxed and
randomized positions can be used to estimate the temperature that will
be reached by the system. In fact, starting with zero ionic velocities,
all the diﬀerence is potential energy, but in a dynamics simulation, the
energy will be equipartitioned between kinetic and potential, then to
estimate the temperature take the diﬀerence in energy (de), convert it
in Kelvins, divide for the number of atoms and multiply by 2/3.
Randomization could be useful also while we are relaxing the system,
especially when we suspect that the ions are in a local minimum or in
an energy plateau.
</p>
<a name="CP_dynamics"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=4" title="Using CP">edit</a>]</span> <span class="mw-headline">CP dynamics</span></h3>
<p>At this point after having minimized the electrons, and with ions dis-
placed from their equilibrium positions, we are ready to start a CP
dynamics. We need to specify ’verlet’ both in ionic and electronic
dynamics. The threshold in control input section will be ignored, like
any parameter related to minimization strategy. The first time we perform a CP run after a minimization, it is always better to put velocities equal to zero, unless we have velocities, from a previous simulation, to
specify in the input file. Restore the proper masses for the ions. In this
way we will sample the microcanonical ensemble. The input section
changes as follow:
</p>
<pre>          &amp;electrons
             emass = 400.d0,
             emass_cutoff = 2.5d0,
             electron_dynamics = ’verlet’,
             electron_velocities = ’zero’,
          /
          &amp;ions
             ion_dynamics = ’verlet’,
             ion_velocities = ’zero’,
          /
          ATOMIC_SPECIES
          C 12.0d0 c_blyp_gia.pp
          H 1.00d0 h.ps
</pre>
<p>If you want to specify the initial velocities for ions, you have to set
ion velocities = ’from input’, and add the IONIC VELOCITIES
card, after the ATOMIC_POSITION card, with the list of velocities in atomic units.
</p><p><b>IMPORTANT:</b> in restarting the dynamics after the first CP run, remember to remove or comment the velocities parameters:
</p>
<pre>          &amp;electrons
             emass = 400.d0,
             emass_cutoff = 2.5d0,
             electron_dynamics = ’verlet’,
            &nbsp;! electron_velocities = ’zero’,
          /
          &amp;ions
             ion_dynamics = ’verlet’,
            &nbsp;! ion_velocities = ’zero’,
          /
</pre>
<p>otherwise you will quench the system interrupting the sampling of the
microcanonical ensemble.
</p>
<a name="Varying_the_temperature"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=5" title="Using CP">edit</a>]</span> <span class="mw-headline"> Varying the temperature </span></h4>
<p>It is possible to change the temperature of the system or to sample the canonical ensemble fixing the average temperature, this is done using the Nose thermostat. To activate this thermostat for ions you have to specify in the ions input section:
</p>
<pre>          &amp;ions
             ion_dynamics = ’verlet’,
             ion_temperature = ’nose’,
             fnosep = 60.0,
             tempw = 300.0,
            &nbsp;! ion_velocities = ’zero’,
          /  
  
</pre>
<p>where fnosep is the frequency of the thermostat in THz, this should be
chosen to be comparable with the center of the vibrational spectrum of
the system, in order to excite as many vibrational modes as possible.
tempw is the desired average temperature in Kelvin.
</p><p><b>Note</b> to avoid a strong coupling between the Nose' thermostat and the system, proceed by step. Don't switch on the thermostat from a completely relaxed configuration, but before adding a random displacement is strongly recommended. Check which is the average temperature via few step of a microcanonical simulation. Don't increase the temperature too much. Finally switch on the thermostat. In the case of molecular system, different modes has to be thermalized, in that case it is better to use a chain of thermostat or equivalently running different simulations with different frequencies. 
</p>
<a name="The_Nose.27_for_electrons"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=6" title="Using CP">edit</a>]</span> <span class="mw-headline"> The Nose' for electrons </span></h4>
<p>It is possible to specify also the thermostat for the electrons, this is
usually activated in metal or in system where we have a transfer of
energy between ionic and electronic degrees of freedom. Beware: the
usage of electronic thermostats is quite delicate. The following information 
comes from K. Kudin: 
</p><p><i>The main issue is that there is usually some “natural” fictitious kinetic energy that electrons gain from the ionic motion (“drag”). One could easily quantify how much of the fictitious energy comes from this drag by doing a CP run, then a couple of CG (same as BO) steps, and then going back to CP.  The fictitious electronic energy at the last CP restart will be purely due to the drag effect.</i>
</p><p><i>The thermostat on electrons will either try to overexcite the otherwise "cold" electrons,  or it will try to take them down to an unnaturally cold state where their fictitious kinetic energy   is even below what would be just due pure drag. Neither of this is good.</i>
</p><p><i>I think the only workable regime with an electronic thermostat is a mild overexcitation of the electrons, however, to do this one will need to know rather precisely what is the fictititious kinetic energy due to the</i>
drag.
</p><p><br />
</p>
<a name="Self-interaction_Correction"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=7" title="Using CP">edit</a>]</span> <span class="mw-headline"> Self-interaction Correction </span></h4>
<p>The self-interaction correction (SIC) included in the CP part of QE is based on the Constrained Local-Spin-Density approach proposed my F. Mauri and coworkers (M. D'Avezac et al. <i>PRB 71</i>, 205210 (2005)). It was used the fisdrt time in the QE-package by F. Baletto, C. Cavazzoni and S.Scandolo (<i>PRL95</i>, 176801 (2005)).
</p><p>This approach is a simple and nice way to treat ONE, and only one, excess charge (EC). 
More, it is necessary to check a priori the spin up and spin down eigen-values are not too much different, for the corresponding neutral system. working in the Local-Spind-Density-Approximation (setting nspin = 2).
If these two conditions are satisfy and you are interest in charged systems, you could apply the SIC.
This approach is a on-the-fly method to correct the self-interaction with the excess charge with itself.
Other post-processing approaches, such as the Makov-Payne, are available (see PW pages for more info).
</p><p>Briefly, both the Hartree and the exchange-correlation part has been corrected to avoid the interaction of the EC with tself.
</p><p>For example, for the Boron atoms, where we have an even number of electrons (valence electrons = 3), the parameters for working with the SIC are:
</p>
<pre>          &amp;system
          nbnd= 2,
          nelec= 3,
          nelup = 2,
          neldw = 1,
          sic_alpha = 1.d0,
          sic_epsilon = 1.0d0,
          sic = 'sic_mac',
          force_pairing = .true.,
</pre>
<pre>          &amp;ions
          ion_dynamics = 'none',
          ion_radius(1) = 0.8d0,
          sic_rloc = 1.0,
</pre>
<pre>          ATOMIC_POSITIONS (bohr)
          B 0.00 0.00 0.00 0 0 0 1
</pre>
<p><br />
The two main parameters are:
<i>force_pairing = .true.</i> which forces the paired electrons to be the same; and the <i>sic=sic_mac</i> which is the variable to use the Mauri's correction.
Remember to add an extra-column in ATOMIC_POSITIONS with <i>1</i> to active the sic for those atoms.
</p><p><br />
<b>Warning:</b> 
Problems are coming using this approach for dissociation mechanism driven by excess electrons,.
</p><p><b>Comment1:</b>
Two parameters <i>sic_alpha</i> and <i>sic_epsilon</i> have been introduced following the suggestion of M. Sprik (ICR(05)) to treat the radical (OH)-H_2O. In any case, a complete ab-initio approach is followed using <i>sic_alpha=sic_epsilon=1</i>.
</p><p><b>Comment2:</b>
When you applied this SIC scheme to a molecule or to an atom, which are neutral, keep in mind to add the correction to the energy level as proposed by Landau: in a neutral system, subtracting the self-intereaction, the unpaired e- feels a charge system, even if using a compensating positive background. The correction term is approx. ~2.317(Madelung)/2L_box, where L_box is the linear dimension of your box (=celldm(1)).
</p><p><b>Comment3:</b>
An example is going to appear asap, in the while for firther information send an email to francesca.baletto@kcl.ac.uk.
</p>
<a name="Variable-cell_MD"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=8" title="Using CP">edit</a>]</span> <span class="mw-headline"> Variable-cell MD </span></h3>
<p>The variable-cell MD is when the Car-Parrinello technique is also applied to the cell. This technique is useful to study system at very high pressure.
</p>
<a name="Conjugate_Gradient"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=9" title="Using CP">edit</a>]</span> <span class="mw-headline"> Conjugate Gradient </span></h3>
<p>This page is under construction.
</p>
<a name="ensemble-DFT"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Using_CP&amp;action=edit&amp;section=10" title="Using CP">edit</a>]</span> <span class="mw-headline"> ensemble-DFT </span></h4>
<p>The ensemble-DFT (eDFT) is a robust method to simulate the metals in the framework of <i>ab-initio</i> molecular dynamics. It was introduced in 1997 by Marzari et al.
</p><p>The specific subroutines for the eDFT are in ensemble_dft.f90 where you define all the quantities of interest. The subroutine inner_loop_cold.f90 (in older version than CVS it was called inner_cold.f90), called both by cg_sub.f90, control the inner loop, and so the minimization of the free energy A with respect to the occupation matrix.
</p><p><br />
To select a eDFT calculations, the user has to choice:
</p>
<pre>           calculation = 'cp'
           occupations= 'ensemble' 
           tcg = .true.
           passop= 0.3
           maxiter = 250
</pre>
<p>to use the CG procedure. In the eDFT it is also the outer loop, where the energy is minimized with respect to the wavefunction keeping fixed the occupation matrix.
While the specific parameters for the inner loop. Since eDFT was born to treat metals, keep in mind that we want to describe the broadening of the occupations around the Fermi energy.
Below the new parameters in the electrons list, are listed.
</p>
<ul><li> <b>smearing</b>: is to select the occupation distribution; there are two options: the Fermi-Dirac smearing='fd', and the cold-smearing if smearing='cs' (better) 
</li><li> <b>degauss</b>: is the electronic temperature; it controls the broadening of the occupation numbers around the Fermi energy. 
</li><li> <b>ninner</b>: is the number of iterative cycles in the inner loop, done to minimize the free energy A with respect the occupation numbers. The range is 2-8.
</li><li> <b>conv_thr</b>: is the threshold value to stop the search of the 'minimum' free energy.
</li><li> <b>niter_cold_restart</b>: controls the frequency at which a full iterative inner cycle is done. It is in the range 1-ninner. It is a trick to speed up the calculation.
</li><li> <b>lambda_cold</b>: is the length step along the search line for the best value for A, when the iterative cycle is not performed. The value is close to 0.03, smaller for large and complicated metallic systems.
</li></ul>
<p><b>NOTA</b> the degauss is in Hartree, while in PW is in Ryd (!!!). The range is 0.011-0.022 Ha.
</p><p>The input for a Al surface is:
</p>
<pre>           &amp;CONTROL
            calculation = 'cp',
            restart_mode = 'from_scratch',
            nstep  = 10,
            iprint = 5,
            isave  = 5,
            dt    = 125.0d0,
            prefix = 'Aluminum_surface',
            pseudo_dir = '~/UPF/',
            outdir = '/scratch/'
            ndr=50
            ndw=51
           /
           &amp;SYSTEM
            ibrav=  14,
            celldm(1)= 21.694d0, celldm(2)= 1.00D0, celldm(3)= 2.121D0,
            celldm(4)= 0.0d0,   celldm(5)= 0.0d0, celldm(6)= 0.0d0,
            nat= 96,
            ntyp= 1,
            nspin=1,
            ecutwfc= 15,
            nbnd=160,
            nelec=291,
            xc_type = 'pbe'
            occupations= 'ensemble',
            smearing='cs',
            degauss=0.018,
           /
           &amp;ELECTRONS
            orthogonalization = 'Gram-Schmidt',
            startingwfc = 'random',
            ampre = 0.02,
            tcg = .true.,
            passop= 0.3,
            maxiter = 250,
            emass_cutoff = 3.00,
            conv_thr=1.d-6
            n_inner = 2,
            lambda_cold = 0.03,
            niter_cold_restart = 2,
           /
           &amp;IONS
            ion_dynamics  = 'verlet',
            ion_temperature = 'nose'
            fnosep = 4.0d0,
            tempw = 500.d0
           /
           ATOMIC_SPECIES
            Al 26.89 Al.pbe.UPF
</pre>
<p><b>NOTA1</b>  remember that the time step is to integrate the ionic dynamics, so you can choose something in the range of 1-5 fs. <br />
<b>NOTA2</b> with eDFT you are simulating metals or systems for which the occupation number is also fractional, so the number of band, nbnd, has to be chosen in order to have some empty states. As a rule of thumb, starting with an initial occupation numbers around 1.6-1.8 (more bands are you considering more the calculation is accurate, but it is longer. The CPU time scales almost linear with the number of bands.) <br />
<b>NOTA3</b> the parameter emass_cutoff is used during the preconditioning and it has a completely different meaning with respect to the CP. It ranges between 4 and 7.
</p><p>All the other parameters have the same meaning in the usual CP input, and they are discussed above.
</p>
<a name="Performance_issues_.28PWscf.29"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Performance_issues_%28PWscf%29&amp;action=edit&amp;section=1" title="Performance issues (PWscf)">edit</a>]</span> <span class="mw-headline">Performance issues (PWscf)</span></h2>
<a name="CPU_time_requirements"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Performance_issues_%28PWscf%29&amp;action=edit&amp;section=2" title="Performance issues (PWscf)">edit</a>]</span> <span class="mw-headline">CPU time requirements</span></h3>
<p>The following holds for code pw.x and for non-US PPs. For US PPs there
are additional terms to be calculated, that may add from a few percent up to 30-40%
to execution time. For phonon calculations, each of the
<span class="texhtml">3<i>N</i><sub><i>a</i><i>t</i></sub></span> modes requires a CPU time of the same order of that required by a
self-consistent calculation in the same system. For cp.x, the required CPU time of 
each time step is in the order of the time <span class="texhtml"><i>T</i><sub><i>h</i></sub> + <i>T</i><sub><i>o</i><i>r</i><i>t</i><i>h</i></sub> + <i>T</i><sub><i>s</i><i>u</i><i>b</i></sub></span> 
defined below.
</p><p>The computer time required for the self-consistent solution at fixed ionic
positions, <span class="texhtml"><i>T</i><sub><i>s</i><i>c</i><i>f</i></sub></span> , is:
</p>
<dl><dd><span class="texhtml"><i>T</i><sub><i>s</i><i>c</i><i>f</i></sub> = <i>N</i><sub><i>i</i><i>t</i><i>e</i><i>r</i></sub><i>T</i><sub><i>i</i><i>t</i><i>e</i><i>r</i></sub> + <i>T</i><sub><i>i</i><i>n</i><i>i</i><i>t</i></sub></span>
</dd></dl>
<p>where <span class="texhtml"><i>N</i><sub><i>i</i><i>t</i><i>e</i><i>r</i></sub></span> = niter = number of self-consistency iterations, 
<span class="texhtml"><i>T</i><sub><i>i</i><i>t</i><i>e</i><i>r</i></sub></span> = CPU
time for a single iteration, <span class="texhtml"><i>T</i><sub><i>i</i><i>n</i><i>i</i><i>t</i></sub></span> = initialization time for a single iteration.
Usually <span class="texhtml"><i>T</i><sub><i>i</i><i>n</i><i>i</i><i>t</i></sub> &lt;  &lt; <i>N</i><sub><i>i</i><i>t</i><i>e</i><i>r</i></sub><i>T</i><sub><i>i</i><i>t</i><i>e</i><i>r</i></sub></span> .
</p><p>The time required for a single self-consistency iteration <span class="texhtml"><i>T</i><sub><i>i</i><i>t</i><i>e</i><i>r</i></sub></span> is:
</p>
<dl><dd><span class="texhtml"><i>T</i><sub><i>i</i><i>t</i><i>e</i><i>r</i></sub> = <i>N</i><sub><i>k</i></sub><i>T</i><sub><i>d</i><i>i</i><i>a</i><i>g</i></sub> + <i>T</i><sub><i>r</i><i>h</i><i>o</i></sub> + <i>T</i><sub><i>s</i><i>c</i><i>f</i></sub></span>
</dd></dl>
<p>where <span class="texhtml"><i>N</i><sub><i>k</i></sub></span> = number of k-points, <span class="texhtml"><i>T</i><sub><i>d</i><i>i</i><i>a</i><i>g</i></sub></span> = CPU time per 
hamiltonian iterative diagonalization, <span class="texhtml"><i>T</i><sub><i>r</i><i>h</i><i>o</i></sub></span> = CPU time for charge density 
calculation, <span class="texhtml"><i>T</i><sub><i>s</i><i>c</i><i>f</i></sub></span> = CPU time for Hartree and exchange-correlation potential
calculation.
</p><p>The time for a Hamiltonian iterative diagonalization <span class="texhtml"><i>T</i><sub><i>d</i><i>i</i><i>a</i><i>g</i></sub></span> is:
</p>
<dl><dd><span class="texhtml"><i>T</i><sub><i>d</i><i>i</i><i>a</i><i>g</i></sub> = <i>N</i><sub><i>h</i></sub><i>T</i><sub><i>h</i></sub> + <i>T</i><sub><i>o</i><i>r</i><i>t</i><i>h</i></sub> + <i>T</i><sub><i>s</i><i>u</i><i>b</i></sub></span>
</dd></dl>
<p>where <span class="texhtml"><i>N</i><sub><i>h</i></sub></span> = number of H ψ products needed by iterative diagonalization, <span class="texhtml"><i>T</i><sub><i>h</i></sub></span> = CPU time per H ψ product, <span class="texhtml"><i>T</i><sub><i>o</i><i>r</i><i>t</i><i>h</i></sub></span> = CPU time for orthonormalization,
<span class="texhtml"><i>T</i><sub><i>s</i><i>u</i><i>b</i></sub></span> = CPU time for subspace diagonalization.
</p><p>The time <span class="texhtml"><i>T</i><sub><i>h</i></sub></span> required for a H ψ product is
</p>
<dl><dd><span class="texhtml"><i>T</i><sub><i>h</i></sub> = <i>a</i><sub>1</sub><i>M</i><i>N</i> + <i>a</i><sub>2</sub><i>M</i><i>N</i><sub>1</sub><i>N</i><sub>2</sub><i>N</i><sub>3</sub><i>l</i><i>o</i><i>g</i>(<i>N</i><sub>1</sub><i>N</i><sub>2</sub><i>N</i><sub>3</sub>) + <i>a</i><sub>3</sub><i>M</i><i>P</i><i>N</i>.</span>
</dd></dl>
<p>The first term comes from the kinetic term and is usually much smaller
than the others. The second and third terms come respectively from local
and nonlocal potential. <span class="texhtml"><i>a</i><sub>1</sub>,<i>a</i><sub>2</sub>,<i>a</i><sub>3</sub></span> are prefactors, M = number of valence
bands, N = number of plane waves (basis set dimension), <span class="texhtml"><i>N</i><sub>1</sub>,<i>N</i><sub>2</sub>,<i>N</i><sub>3</sub></span> =
dimensions of the FFT grid for wavefunctions (<span class="texhtml"><i>N</i><sub>1</sub><i>N</i><sub>2</sub><i>N</i><sub>3</sub></span> ∼ 8N ), P =
number of projectors for PPs (summed on all atoms, on all values of the
angular momentum l, and m = 1, . . . , 2l + 1)
</p><p>The time <span class="texhtml"><i>T</i><sub><i>o</i><i>r</i><i>t</i><i>h</i></sub></span> required by orthonormalization is
</p>
<dl><dd><img class='tex' src="/wiki/images/math/8/5/0/850f1b3e8a31c1274099e91357e894b7.png" alt="T_{orth} = b_1 N M_x^2" /> 
</dd></dl>
<p>and the time <span class="texhtml"><i>T</i><sub><i>s</i><i>u</i><i>b</i></sub></span> required by subspace diagonalization is
</p>
<dl><dd><img class='tex' src="/wiki/images/math/0/1/0/010d75eb5219fd0bd285a68a6c85a488.png" alt="T_{sub} = b_2 M_x^3" />
</dd></dl>
<p>where <span class="texhtml"><i>b</i><sub>1</sub></span> and <span class="texhtml"><i>b</i><sub>2</sub></span> are prefactors, <span class="texhtml"><i>M</i><sub><i>x</i></sub></span> = number of trial wavefunctions (this will
vary between M and a few times M , depending on the algorithm).
</p><p>The time <span class="texhtml"><i>T</i><sub><i>r</i><i>h</i><i>o</i></sub></span> for the calculation of charge density from wavefunctions is
</p>
<dl><dd><span class="texhtml"><i>T</i><sub><i>r</i><i>h</i><i>o</i></sub> = <i>c</i><sub>1</sub><i>M</i><i>N</i><sub><i>r</i>1</sub><i>N</i><sub><i>r</i>2</sub><i>N</i><sub><i>r</i>3</sub><i>l</i><i>o</i><i>g</i>(<i>N</i><sub><i>r</i>1</sub><i>N</i><sub><i>r</i>2</sub><i>N</i><sub><i>r</i>3</sub>) + <i>c</i><sub>2</sub><i>M</i><i>N</i><sub><i>r</i>1</sub><i>N</i><sub><i>r</i>2</sub><i>N</i><sub><i>r</i>3</sub> + <i>T</i><sub><i>u</i><i>s</i></sub></span>
</dd></dl>
<p>where <span class="texhtml"><i>c</i><sub>1</sub>,<i>c</i><sub>2</sub>,<i>c</i><sub>3</sub></span> are prefactors, <span class="texhtml"><i>N</i><sub><i>r</i>1</sub>,<i>N</i><sub><i>r</i>2</sub>,<i>N</i><sub><i>r</i>3</sub></span> = dimensions of the FFT grid for charge density (<span class="texhtml"><i>N</i><sub><i>r</i>1</sub><i>N</i><sub><i>r</i>2</sub><i>N</i><sub><i>r</i></sub>3</span>∼ <span class="texhtml">8<i>N</i><sub><i>g</i></sub></span> , where <span class="texhtml"><i>N</i><sub><i>g</i></sub></span> = number of G-vectors for the charge density), and Tus = CPU time required by ultrasoft
contribution (if any).
</p><p>The time <span class="texhtml"><i>T</i><sub><i>s</i><i>c</i><i>f</i></sub></span> for calculation of potential from charge density is
</p>
<dl><dd><span class="texhtml"><i>T</i><sub><i>s</i><i>c</i><i>f</i></sub> = <i>d</i><sub>2</sub><i>N</i><sub><i>r</i>1</sub><i>N</i><sub><i>r</i>2</sub><i>N</i><sub><i>r</i>3</sub> + <i>d</i><sub>3</sub><i>N</i><sub><i>r</i>1</sub><i>N</i><sub><i>r</i>2</sub><i>N</i><sub><i>r</i>3</sub><i>l</i><i>o</i><i>g</i>(<i>N</i><sub><i>r</i>1</sub><i>N</i><sub><i>r</i>2</sub><i>N</i><sub><i>r</i>3</sub>)</span>
</dd></dl>
<p>where <span class="texhtml"><i>d</i><sub>1</sub>,<i>d</i><sub>2</sub></span> are prefactors.
</p>
<a name="Memory_requirements"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Performance_issues_%28PWscf%29&amp;action=edit&amp;section=3" title="Performance issues (PWscf)">edit</a>]</span> <span class="mw-headline">Memory requirements</span></h3>
<p>A typical self-consistency or molecular-dynamics run requires a maximum
memory in the order of O double precision complex numbers, where
</p>
<dl><dd><span class="texhtml"><i>O</i> = <i>m</i><i>M</i><i>N</i> + <i>P</i><i>N</i> + <i>p</i><i>N</i><sub>1</sub><i>N</i><sub>2</sub><i>N</i><sub>3</sub> + <i>q</i><i>N</i><sub><i>r</i>1</sub><i>N</i><sub><i>r</i>2</sub><i>N</i><sub><i>r</i>3</sub></span>
</dd></dl>
<p>with m, p, q = small factors; all other variables have the same meaning as
above. Note that if the Γ-point only (q = 0) is used to sample the Brillouin
Zone, the value of N will be cut into half.
</p><p>The memory required by the phonon code follows the same patterns, with
somewhat larger factors m, p, q .
</p>
<a name="File_space_requirements"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Performance_issues_%28PWscf%29&amp;action=edit&amp;section=4" title="Performance issues (PWscf)">edit</a>]</span> <span class="mw-headline">File space requirements</span></h3>
<p>A typical pw.x run will require an amount of temporary disk space in the
order of O double precision complex numbers:
</p>
<dl><dd><span class="texhtml"><i>O</i> = <i>N</i><sub><i>k</i></sub><i>M</i><i>N</i> + <i>q</i><i>N</i><sub><i>r</i>1</sub><i>N</i><sub><i>r</i>2</sub><i>N</i><sub><i>r</i>3</sub></span>
</dd></dl>
<p>where q = 2 · mixing ndim (number of iterations used in self-consistency,
default value = 8) if disk io is set to ’high’ or not specified; q = 0 if
disk io=’low’ or ’minimal’.
</p>
<a name="Parallelization_issues"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Performance_issues_%28PWscf%29&amp;action=edit&amp;section=5" title="Performance issues (PWscf)">edit</a>]</span> <span class="mw-headline">Parallelization issues</span></h3>
<p>pw.x and cp.x can run in principle on any number of processors. The eﬀectiveness of 
parallelization is ultimately judged by the <i>scaling</i>, i.e. how the time needed
to perform a job scales with the number of processors, and depends upon:
</p>
<ol><li> the size and type of the system under study;
</li><li> the judicious choice of the various levels of parallelization (detailed in the <a href="/wiki/index.php/Running_on_parallel_machines" title="Running on parallel machines">Running on parallel machines</a> sections);
</li><li> the availability of fast interprocess communications (or lack thereof).
</li></ol>
<p>Ideally one would like to have linear scaling, i.e. <img class='tex' src="/wiki/images/math/e/4/3/e432ff0cd42705513a531265d5372328.png" alt="T_N \sim T_0/N_p" /> for 
<span class="texhtml"><i>N</i><sub><i>p</i></sub></span> processors. In addition, one would like to have linear scaling of
the RAM per processor: <img class='tex' src="/wiki/images/math/9/5/3/9530b4199aff1af5f2f001b09e5c411d.png" alt="O_N \sim O_0/N_p" />, so that large-memory systems
fit into the RAM of each processor.
</p><p>As a general rule, image parallelization:
</p>
<ol><li> may give good scaling, but the slowest image will determine the overall performances (<i>load balancing</i> may be a problem);
</li><li> requires very little communications (suitable for ethernet communications);
</li><li> does not reduce the required memory per processor (unsuitable for large-memory jobs).
</li></ol>
<p>Parallelization on k-points:
</p>
<ol><li> guarantees (almost) linear scaling if the number of k-points is a multiple of the number of pools;
</li><li> requires little communications (suitable for ethernet communications);
</li><li> does not reduce the required memory per processor (unsuitable for large-memory jobs).
</li></ol>
<p>Parallelization on plane-waves:
</p>
<ol><li> yields good to very good scaling, especially if the number of processors in a pool is a divisor of <span class="texhtml"><i>N</i><sub>3</sub></span> and <span class="texhtml"><i>N</i><sub><i>r</i>3</sub></span> (the dimensions along the z-axis of the FFT grids, which may coincide);
</li><li> requires heavy communications (suitable for Gigabit ethernet up to 4, 8 CPUs at most, specialized communication hardware needed for 8 or more processors );
</li><li> yields almost linear reduction of memory per processor with the number of processors in the pool.
</li></ol>
<p>A note on scaling: optimal serial performances are achieved when the data are as much as possible 
kept into the cache. As a side eﬀect, plane-wave parallelization may yield superlinear (better than
linear) scaling, thanks to the increase in serial speed coming from the reduction of data size 
(makingit easier for the machine to keep data in the cache).
</p><p>For each system there is an optimal range of number of processors on which to run the job. 
A too large number of processors will yield performance degradation. If the size of pools
is especially delicate: <span class="texhtml"><i>N</i><sub><i>p</i></sub></span> should not exceed by much <span class="texhtml"><i>N</i><sub>3</sub></span> and <span class="texhtml"><i>N</i><sub><i>r</i>3</sub></span>. For large jobs, it is convenient to further subdivide a pool of 
processors into <i>task groups</i>. The 3D FFT grid is parallelized using ation of the 3D FFT when the number of processors exceeds the number of FFT planes, data can be redistributed to "task groups" so that each group can process several wavefunctions at the same time.
</p><p>The optimal number of processors for the <i>ortho</i> (cp.x) or <i>ndiag</i> (pw.x) parallelization, 
taking care of linear algebra operations involving <img class='tex' src="/wiki/images/math/6/2/7/627dfe3da8c871a94e9f209e28cc7121.png" alt="M\times M" /> matrices, is automatically
chosen by the code.
</p><p>Actual parallel performances will also depend a lot on the available software (MPI libraries) and on the available communication hardware. For
Beowulf-style machines (clusters of PC) the newest version 1.1 and later of the OpenMPI libraries (<a href="http://www.openmpi.org/" class="external free" title="http://www.openmpi.org/" rel="nofollow">http://www.openmpi.org/</a>) seems to yield better performances than other implementations (info by Kostantin Kudin). Note however that you need a decent communication hardware (at least Gigabit ethernet) in order to have acceptable performances with PW parallelization. Do not expect good scaling with cheap hardware: plane-wave calculations are by no means an “embarrassing parallel” problem.
</p><p>Also note that multiprocessor motherboards for Intel Pentium CPUs typically have just one memory bus for all processors. This dramatically
slows down any code doing massive access to memory (as most codes in the Quantum-ESPRESSO package do) that runs on processors of the same
motherboard.
</p>
<a name="Troubleshooting_.28PWscf.29"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=1" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">Troubleshooting (PWscf)</span></h2>
<p>Almost all problems in PWscf arise from incorrect input data and result in
error stops. Error messages should be self-explanatory, but unfortunately
this is not always true. If the code issues a warning messages and continues,
pay attention to it but do not assume that something is necessarily wrong in
your calculation: most warning messages signal harmless problems.
</p><p>Typical pw.x and/or ph.x (mis-)behavior:
</p>
<a name="pw.x_says_.27error_while_loading_shared_libraries.27_or_.27cannot_open_shared_object_.EF.AC.81le.27_and_does_not_start"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=2" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x says 'error while loading shared libraries' or 'cannot open shared object file' and does not start</span></h3>
<p>Possible reasons:
</p>
<ul><li> If you are running on the same machines on which the code was compiled, this is a library configuration problem. The solution is machine-dependent. On Linux, find the path to the missing libraries; then either add it to file /etc/ld.so.conf and run ldconfig (must be done as root), or add it to variable LD_LIBRARY_PATH and export it. Another possibility is to load non-shared version of libraries (ending with .a)  instead of shared ones (ending with .so).
</li><li> If you are <i>not</i> running on the same machines on which the code was compiled: you need either to have the same shared libraries installed on both machines, or to load statically all libraries (using appropriate configure or loader options). The same applies to Beowulf-style parallel machines: the needed shared libraries must be present on all PC’s.
</li></ul>
<a name="syntax_errors_when_running_examples"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=3" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">syntax errors when running examples</span></h3>
<p>The scripts used by examples assume that /bin/sh is a standard Bourne shell.
In some versions of Ubuntu Linux, /bin/sh is linked to something else. If
you get strange errors like:
<i>../check_failure.sh: 2: Syntax error: "(" unexpected</i>, edit the scripts
and change /bin/sh to /bin/bash, or modify /bin/sh in such a way that it points 
to a standard Bourne shell. Then complain with the maintainers of the
Linux distribution for their ill-conceived choice.
</p>
<a name="errors_in_examples_with_parallel_execution"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=4" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">errors in examples with parallel execution</span></h3>
<p>If you get error messages in
the example scripts – i.e. not errors in the codes – on a parallel machine, such
as e.g.&nbsp;: “run example: -n: command not found” you have forgotten
the ‘”‘ in the definitions of PARA_PREFIX and PARA_POSTFIX.
</p>
<a name="pw.x_prints_the_.EF.AC.81rst_few_lines_and_then_nothing_happens_.28parallel_execution.29"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=5" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x prints the first few lines and then nothing happens (parallel execution)</span></h3>
<p>If the code looks like it is not reading from input, maybe
it isn’t: the MPI libraries need to be properly configured to accept input
redirection. See section “Running on parallel machines”, or inquire with
your local computer wizard (if any).
</p>
<a name="pw.x_stops_with_error_in_reading"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=6" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x stops with error in reading</span></h3>
<p>There is an error in the input data.
Usually it is a misspelled namelist variable, or an empty input file. Note that
out-of-bound indices in dimensioned variables read in the namelist may cause
the code to crash with really mysterious error messages. Also note that input
data files containing ^M (Control-M) characters at the end of lines (typically,
files coming from Windows PC) may yield error in reading. If none of the
above applies and the code stops at the first namelist (“control”) and you are
running in parallel: your MPI libraries might not be properly configured to
allow input redirection, so that what you are eﬀectively reading is an empty
file. See above.
</p>
<a name="pw.x_mumbles_something_like_.27cannot_recover.27_or_.27error_reading_recover_.EF.AC.81le.27"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=7" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x mumbles something like 'cannot recover' or 'error reading recover file'</span></h3>
<p>You are trying to restart from a previous job that either
produced corrupted files, or did not do what you think it did. No luck: you
have to restart from scratch.
</p>
<a name="pw.x_stops_with_.27inconsistent_DFT.27_error"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=8" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x stops with 'inconsistent DFT' error</span></h3>
<p>As a rule, the ﬂavor of
DFT used in the calculation should be the same as the one used in the
generation of PP’s, and all PP’s should be generated using the same ﬂavor
of DFT. This is actually enforced: the type of DFT is read from PP files and
it is checked that the same DFT is read from all PP’s. If this does not hold,
the code stops with the above error message.
</p><p>If you really want to use PP’s generated with diﬀerent DFT, or to perform
a calculation with a DFT that diﬀers from what used in PP generation,
change the appropriate field in the PP file(s), at your own risk.
</p>
<a name="pw.x_stops_with_error_in_cdiaghg_or_rdiaghg"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=9" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x stops with error in cdiaghg or rdiaghg</span></h3>
<p>Possible reasons for such
behavior are not always clear, but they typically fall into one of the following
cases:
</p>
<ul><li> serious error in data, such as bad atomic positions or bad crystal structure/supercell;
</li><li> a bad PP, typicall with a ghost, but also a US-PP with non-positive charge density, leading to a violation of positiveness of the S matrix appearing in the US-PP formalism; 
</li><li> a failure of the algorithm performing subspace diagonalization. The LAPACK algorithms used by cdiaghg/rdiaghg are very robust and extensively tested. Still, it may seldom happen that such algorithms fail. Try to use conjugate-gradient diagonalization (diagonalization=’cg’), a slower but very robust algorithm, and see what happens.
</li><li> buggy libraries. Machine-optimized mathematical libraries are very fast but sometimes not so robust from a numerical point of view.  Suspicious behavior: you get an error that is not reproducible on other architectures or that disappears if the calculation is repeated with even minimal changes in parameters. Known cases: HP-Compaq alphas with cxml libraries, Mac OS-X with system blas/lapack. Try to use compiled BLAS and LAPACK (or better, ATLAS) instead of machine-optimized libraries.
</li></ul>
<a name="pw.x_crashes_with_.27.EF.AC.82oating_invalid.27_or_.27.EF.AC.82oating_divide_by_zero.27"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=10" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x crashes with 'ﬂoating invalid' or 'ﬂoating divide by zero'</span></h3>
<p>If this happens on HP-Compaq True64 Alpha machines with an old version
of the compiler: the compiler is most likely buggy. Otherwise, move to next
item.
</p>
<a name="pw.x_crashes_with_no_error_message_at_all"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=11" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x crashes with no error message at all</span></h3>
<p>This happens quite often
in parallel execution, or under a batch queue, or if you are writing the output
to a file. When the program crashes, part of the output, including the error
message, may be lost, or hidden into error files where nobody looks into. It
is the fault of the operating system, not of the code. Try to run interactively
and to write to the screen. If this doesn’t help, move to next point.
</p>
<a name="pw.x_crashes_with_.27segmentation_fault.27_or_similarly_obscure_messages"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=12" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x crashes with 'segmentation fault' or similarly obscure messages</span></h3>
<p>Possible reasons:
</p>
<ul><li> too much RAM memory requested, or too much stack memory requested (see next item).
</li><li> if you are using highly optimized mathematical libraries, verify that they are designed for your hardware. In particular, for Intel compiler  and MKL libraries, verify that you loaded the correct set of CPU-specifiic MKL libraries.
</li><li> buggy compiler. If you are using Portland or Intel compilers on Linux PC’s or clusters, see the <a href="/wiki/index.php/Installation" title="Installation">Installation</a> section.
</li></ul>
<a name="pw.x_works_for_simple_systems.2C_but_not_for_large_systems_or_whenever_more_RAM_is_needed"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=13" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x works for simple systems, but not for large systems or whenever more RAM is needed</span></h3>
<p>Possible solutions:
</p>
<ul><li> increase the amount of RAM you are authorized to use (which may be much smaller than the available RAM). Ask your system administrator if you don’t know what to do. 
</li><li> reduce nbnd to the strict minimum, or reduce the cutoﬀs, or the cell size
</li><li> use conjugate-gradient (diagonalization=’cg’: slow but very robust): it requires less memory than the default Davidson algorithm.
</li><li> in parallel execution, use more processors, or use the same number of processors with less pools. Remember that parallelization with respect to k-points (pools) does not distribute memory: parallelization with respect to R- (and G-) space does.
</li><li> IBM only (32-bit machines): if you need more than 256 MB you must specify it at link time (option -bmaxdata).
</li><li> buggy or weird-behaving compiler. Some versions of the Portland and Intel compilers on Linux PC’s or clusters have this problem. For Intel ifort 8.1 and later, the problem seems to be due to the allocation of large automatic arrays that exceeds the available stack. Increasing the stack size (with commands limits or ulimit) may (or may not) solve the problem. Versions &gt; 3.2 try to avoid this problem by removing the stack size limit at startup. See: <a href="http://www.democritos.it/pipermail/pw_forum/2007-September/007176.html" class="external free" title="http://www.democritos.it/pipermail/pw_forum/2007-September/007176.html" rel="nofollow">http://www.democritos.it/pipermail/pw_forum/2007-September/007176.html</a> , <a href="http://www.democritos.it/pipermail/pw_forum/2007-September/007179.html" class="external free" title="http://www.democritos.it/pipermail/pw_forum/2007-September/007179.html" rel="nofollow">http://www.democritos.it/pipermail/pw_forum/2007-September/007179.html</a>
</li></ul>
<a name="pw.x_crashes_in_parallel_execution_with_an_obscure_message_related_to_MPI_errors"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=14" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x crashes in parallel execution with an obscure message related to MPI errors</span></h3>
<p>Random crashes due to MPI errors have often been reported in Linux
PC clusters. We cannot rule out the possibility that bugs in Quantum-ESPRESSO 
cause such behavior, but we are quite confident that the likely
explanation is a hardware problem (defective RAM for instance) or a software
bug (in MPI libraries, compiler, operating system).
</p><p>See also info from Axel Kohlmeyer: <a href="http://www.democritos.it/pipermail/pw_forum/2005-April/002338.html" class="external free" title="http://www.democritos.it/pipermail/pw_forum/2005-April/002338.html" rel="nofollow">http://www.democritos.it/pipermail/pw_forum/2005-April/002338.html</a>
</p>
<a name="pw.x_runs_but_nothing_happens"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=15" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x runs but nothing happens</span></h3>
<p>Possible reasons:
</p>
<ul><li> in parallel execution, the code died on just one processor. Unpredictable behavior may follow.
</li><li> in serial execution, the code encountered a ﬂoating-point error and goes on producing NaN’s (Not a Number) forever unless exception handling is on (and usually it isn’t). In both cases, look for one of the reasons given above.
</li><li> maybe your calculation will take more time than you expect.
</li></ul>
<a name="pw.x_yields_weird_results"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=16" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x yields weird results</span></h3>
<p>Possible solutions:
</p>
<ul><li> if this happens after a change in the code or in compilation or preprocessing options, try 'make clean', recompile. The 'make' command should take care of all dependencies, but do not rely too heavily on it. If the problem persists, 'make clean', recompile with reduced optimization level. 
</li><li> maybe your input data are weird.
</li></ul>
<a name="pw.x_stops_with_error_message_.E2.80.9Cthe_system_is_metallic.2C_specify_occupations.E2.80.9D"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=17" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x stops with error message “the system is metallic, specify occupations”</span></h3>
<p>You did not specify state occupations, but you need to, since your system appears to have an odd number of electrons. The variable
controlling how metallicity is treated is occupations in namelist &amp;SYSTEM.
The default, occupations=’fixed’, occupies the lowest nelec/2 states and
works only for insulators with a gap. In all other cases, use ’smearing’ or
’tetrahedra’. See file INPUT_PW for more details.
</p>
<a name="pw.x_stops_with_.E2.80.9Cinternal_error:_cannot_braket_Ef_.E2.80.9D_in_efermig"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=18" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x stops with “internal error: cannot braket Ef ” in efermig</span></h3>
<p>Possible reasons:
</p>
<ul><li> serious error in data, such as bad number of electrons, insuﬃcient number of bands, absurd value of broadening;
</li><li> the Fermi energy is found by bisection assuming that the integrated DOS N(E ) is an increasing function of the energy. This is not guaranteed for Methfessel-Paxton smearing of order 1 and can give problems when very few k-points are used. Use some other smearing function: simple Gaussian broadening or, better, Marzari-Vanderbilt 'cold smearing'.
</li></ul>
<a name="pw.x_yields_.27internal_error:_cannot_braket_Ef.27_message_in_efermit.2C_then_stops_because_.27charge_is_incorrect.27"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=19" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x yields 'internal error: cannot braket Ef' message in efermit, then stops because 'charge is incorrect'</span></h3>
<p>There is either a serious error in data (bad number of electrons, insuﬃcient number of bands), or too
few tetrahedra (i.e. k-points). The tetrahedron method may become unstable
in the latter case, especially if the bands are very narrow. Remember that
tetrahedra should be used only in conjunction with uniform k-point grids.
</p>
<a name="pw.x_yields_.27internal_error:_cannot_braket_Ef.27_message_in_efermit_but_doesn.E2.80.99t_stop"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=20" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x yields 'internal error: cannot braket Ef' message in efermit but doesn’t stop</span></h3>
<p>This may happen under special circumstances when you are calculating the band structure for selected high-symmetry lines. The message signals that occupations and Fermi energy are not correct (but eigen values and eigenvectors are). Remove occupations=’tetrahedra’ in the input data to get rid of the message.
</p>
<a name="in_parallel_execution.2C_pw.x_stops_complaining_that_.27some_processors_have_no_planes.27_or_.27smooth_planes.27_or_similar_strange_errors"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=21" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">in parallel execution, pw.x stops complaining that 'some processors have no planes' or 'smooth planes' or similar strange errors</span></h3>
<p>Your system does not require that many processors: reduce the number of
processors to a more sensible value. In particular, both <span class="texhtml"><i>N</i><sub>3</sub></span> and Nr3 must
be ≥ Npr (see section 7, “Performance Issues”, and in particular section 7.4,
“Parallelization issues”, for the meaning of these variables).
</p>
<a name="the_FFT_grids_in_pw.x_are_machine-dependent"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=22" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">the FFT grids in pw.x are machine-dependent</span></h3>
<p>Yes, they are! The
code automatically chooses the smallest grid that is compatible with the
specified cutoﬀ in the specified cell, and is an allowed value for the FFT
library used. Most FFT libraries are implemented, or perform well, only
with dimensions that factors into products of small numers (2, 3, 5 typically,
sometimes 7 and 11). Diﬀerent FFT libraries follow diﬀerent rules and thus
diﬀerent dimensions can result for the same system on diﬀerent machines (or
even on the same machine, with a diﬀerent FFT). See function allowed in
Modules/fft scalar.f90.
</p><p>As a consequence, the energy may be slightly diﬀerent on diﬀerent machines. 
The only piece that explicitly depends on the grid parameters is
the XC part of the energy that is computed numerically on the grid. The
differences should be small, though, expecially for LDA calculations.
</p><p>Manually setting the FFT grids to a desired value is possible, but slightly
tricky, using input variables nr1, nr2, nr3 and nr1s, nr2s, nr3s. The
code will still increase them if not acceptable. Automatic FFT grid 
dimensions are slightly overestimated, so one may try — very carefully — to reduce
them a little bit. The code will stop if too small values are required, it will
waste CPU time and memory for too large values.
</p><p>Note that in parallel execution, it is very convenient to have FFT grid
dimensions along <i>z</i> that are a multiple of the number of processors.
</p>
<a name="warning:_.27symmetry_operation_.23_N_not_allowed.27"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=23" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">warning: 'symmetry operation # N not allowed'</span></h3>
<p>This is not an error. pw.x determines first the symmetry operations (rotations) of the Bravais lattice; then checks which of these are symmetry operations of the system
(including if needed fractional translations). This is done by rotating (and
translating if needed) the atoms in the unit cell and verifying if the rotated
unit cell coincides with the original one.
</p><p>If a symmetry operation contains a fractional translation that is incompatible with the FFT grid, it is discarded in order to prevent problems with
symmetrization. Typical fractional translations are 1/2 or 1/3 of a lattice
vector. If the FFT grid dimension along that direction is not divisible respectively by 2 or by 3, the symmetry operation will not transform the FFT
grid into itself.
</p>
<a name="pw.x_doesn.E2.80.99t_.EF.AC.81nd_all_the_symmetries_you_expected"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=24" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x doesn’t find all the symmetries you expected</span></h3>
<p>See above to
learn how PWscf finds symmetry operations. Some of them might be missing
because:
</p>
<ul><li> the number of significant figures in the atomic positions is not large enough. In file PW/eqvect.f90, the variable accep is used to decide whether a rotation is a symmetry operation. Its current value (10−5) is quite strict: a rotated atom must coincide with another atom to 5 significant digits. You may change the value of accep and recompile.
</li><li> they are not acceptable symmetry operations of the Bravais lattice. This is the case for C<sub>60</sub>, for instance: the I<sub>h</sub> icosahedral group of C<sub>60</sub> contains 5-fold rotations that are incompatible with translation symmetry.
</li><li> the system is rotated with respect to symmetry axis. For instance: a C<sub>60</sub> molecule in the fcc lattice will have 24 symmetry operations (T<sub>h</sub> group) only if the double bond is aligned along one of the crystal axis; if C<sub>60</sub> is rotated in some arbitrary way, pw.x may not find any symmetry, apart from inversion.
</li><li> they contain a fractional translation that is incompatible with the FFT grid (see previous paragraph). Note that if you change cutoﬀ or unit cell volume, the automatically computed FFT grid changes, and this may explain changes in symmetry (and in the number of k-points as a consequence) for no apparent good reason (only if you have fractional translations in the system, though).
</li><li> a fractional translation, without rotation, is a symmetry operation of the system. This means that the cell is actually a supercell. In this case, all symmetry operations containing fractional translations are disabled. The reason is that in this rather exotic case there is no simple way to select those symmetry operations forming a true group, in the mathematical sense of the term.
</li></ul>
<a name="I_don.E2.80.99t_get_the_same_results_in_di.EF.AC.80erent_machines.21"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=25" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">I don’t get the same results in diﬀerent machines!</span></h3>
<p>If the difference
is small, do not panic. It is quite normal for iterative methods to reach convergence through diﬀerent paths as soon as anything changes. In particular,
between serial and parallel execution there are operations that are not performed in the same order. As the numerical accuracy of computer numbers
is finite, this can yield slightly diﬀerent results.
</p><p>It is also normal that the total energy converges to a better accuracy than
the parts it is composed of. Thus if the convergence threshold is for instance
10<sup>−8</sup> , you get 8-digit accuracy on the total energy, but one or two less on
other terms. It is not a problem, but if you mind, try to reduce the threshold
for instance to 10<sup>−10</sup> or 10<sup>−12</sup>. 
The diﬀerences should go away (but it will
probably take a few more iterations to converge).
</p>
<a name="the_CPU_time_is_time-dependent.21"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=26" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">the CPU time is time-dependent!</span></h3>
<p>Yes it is! On most machines and on
most operating systems, depending on machine load, on communication load
(for parallel machines), on various other factors (including maybe the phase
of the moon), reported CPU times may vary quite a lot for the same job.
Also note that what is printed is supposed to be the CPU time per process,
but with some compilers it is actually the wall time.
</p>
<a name=".27warning_:_N_eigenvectors_not_converged_....27"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=27" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">'warning&nbsp;: N eigenvectors not converged ...'</span></h3>
<p>This is a warning message that can be safely ignored if it is not present in the last steps of 
self-consistency. If it is still present in the last steps of self-consistency, and if
the number of unconverged eigenvector is a significant part of the total, it
may signal serious trouble in self-consistency (see next point) or something
badly wrong in input data.
</p>
<a name=".27warning_:_negative_or_imaginary_charge....27.2C_or_.27...core_charge_....27.2C_or_.27npt_with_rhoup.3C0....27_or_.27rho_dw.3C0....27"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=28" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">'warning&nbsp;: negative or imaginary charge...', or '...core charge ...', or 'npt with rhoup&lt;0...' or 'rho dw&lt;0...'</span></h3>
<p>These are warning messages that can be safely ignored unless the negative or imaginary charge is
sizable, let us say of the order of 0.1. If it is, something seriously wrong is going on.
Otherwise, the origin of the negative charge is the following. When one
transforms a positive function in real space to Fourier space and truncates at
some finite cutoﬀ, the positive function is no longer guaranteed to be positive
when transformed back to real space. This happens only with core corrections and with ultrasoft pseudopotentials. In some cases it may be a source
of trouble (see next point) but it is usually solved by increasing the cutoﬀ
for the charge density.
</p>
<a name="self-consistency_is_slow_or_does_not_converge"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=29" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">self-consistency is slow or does not converge</span></h3>
<p>Reduce mixing beta
from the default value (0.7) to ∼ 0.3 − 0.1 or smaller. Try the mixing mode
value that is more appropriate for your problem. For slab geometries used
in surface problems or for elongated cells, mixing mode=’local-TF’ should
be the better choice, dampening “charge sloshing”. You may also try to
increase mixing ndim to more than 8 (default value). Beware: the larger
mixing ndim, the larger the amount of memory you need.
</p><p>If the above doesn’t help: verify if your system is metallic or is close to
a metallic state, especially if you have few k-points. If the highest occupied
and lowest unoccupied state(s) keep exchanging place during self-consistency,
forget about reaching convergence. A typical sign of such behavior is that
the self-consistency error goes down, down, down, than all of a sudden up
again, and so on. Usually one can solve the problem by adding a few empty
bands and a broadening.
</p><p>Specific to US PP: the presence of negative charge density regions due to
either the pseudization procedure of the augmentation part or to truncation
at finite cutoﬀ may give convergence problems. Raising the ecutrho cutoﬀ for
charge density will usually help, especially in gradient-corrected calculations.
</p>
<a name="structural_optimization_is_slow_or_does_not_converge"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=30" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">structural optimization is slow or does not converge</span></h3>
<p>Typical structural optimizations, based on the BFGS algorithm, converge to the default
thresholds ( etot_conv_thr and forc_conv_thr ) in 15-25 BFGS steps (depending on the 
starting configuration). This may not happen when your
system is characterized by “ﬂoppy” low-energy modes, that make very difficult — and of little use anyway — to reach a well converged structure, no
matter what. Other possible reasons for a problematic convergence are listed
below.
</p><p>Close to convergence the self-consistency error in forces may become large
with respect to the value of forces. The resulting mismatch between forces
and energies may confuse the line minimization algorithm, which assumes
consistency between the two. The code reduces the starting self-consistency
threshold conv thr when approaching the minimum energy configuration, up
to a factor defined by upscale. Reducing conv_thr (or increasing upscale)
yields a smoother structural optimization, but if conv_thr becomes too small,
electronic self-consistency may not converge. You may also increase variables
etot_conv_thr and forc_conv_thr that determine the threshold for convergence
(the default values are quite strict).
</p><p>A limitation to the accuracy of forces comes from the absence of perfect
translational invariance. If we had only the Hartree potential, our PW calculation would be translationally invariant to machine precision. The presence of an exchange-correlation potential introduces Fourier components in the
potential that are not in our basis set. This loss of precision (more serious
for gradient-corrected functionals) translates into a slight but detectable loss
of translational invariance (the energy changes if all atoms are displaced by
the same quantity, not commensurate with the FFT grid). This sets a limit
to the accuracy of forces. The situation improves somewhat by increasing
the ecutrho cutoff.
</p>
<a name="pw.x_stops_during_variable-cell_optimization_in_checkallsym_with_.27non_orthogonal_operation.27_error"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=31" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">pw.x stops during variable-cell optimization in checkallsym with 'non orthogonal operation' error</span></h3>
<p>Variable-cell optimization may occasionally break the starting symmetry of the cell. When this happens, the
run is stopped because the number of k-points calculated for the starting
configuration may no longer be suitable. Possible solutions:
</p>
<ul><li> start with a nonsymmetric cell&lt;
</li><li> use a symmetry-conserving algorithm: the Wentzcovitch algorithm (cell dynamics=’damp-w’) shouldn’t break the symmetry.
</li></ul>
<a name="some_codes_in_PP.2F_complain_that_they_do_not_.EF.AC.81nd_some_.EF.AC.81les"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=32" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">some codes in PP/ complain that they do not find some files</span></h3>
<p>For Linux PC clusters in parallel execution: in at least some versions
of MPICH, the current directory is set to the directory where the executable
code resides, instead of being set to the directory where the code is executed.
This MPICH weirdness may cause unexpected failures in some postprocessing
codes that expect a data file in the current directory. Workaround: use
symbolic links, or copy the executable to the current directory.
</p>
<a name="ph.x_stops_with_.27error_reading_.EF.AC.81le.27"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=33" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">ph.x stops with 'error reading file'</span></h3>
<p>The data file produced by pw.x
is bad or incomplete or produced by an incompatible version of the code.
In parallel execution: if you did not set wf collect=.true., the number
of processors and pools for the phonon run should be the same as for the
self-consistent run; all files must be visible to all processors.
</p>
<a name="ph.x_mumbles_something_like_.27cannot_recover.27_or_.27error_reading_recover_.EF.AC.81le.27"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=34" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">ph.x mumbles something like 'cannot recover' or 'error reading recover file'</span></h3>
<p>You have a bad restart file from a preceding failed execution.
Remove all files recover* in outdir.
</p>
<a name="ph.x_says_.27occupation_numbers_probably_wrong.27_and_continues.3B_or_.27phonon_.2B_tetrahedra_not_implemented.27_and_stops"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=35" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">ph.x says 'occupation numbers probably wrong' and continues; or 'phonon + tetrahedra not implemented' and stops</span></h3>
<p>You have a
metallic or spin-polarized system but occupations are not set to 'smearing'.
Note that the correct way to calculate occupancies must be specified in the
input data of the non-selfconsistent calculation, if the phonon code reads
data from it. The non-selfconsistent calculation will not use this information
but the phonon code will.
</p>
<a name="ph.x_does_not_yield_acoustic_modes_with_.CF.89.28q.3D0.29.3D0"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=36" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">ph.x does not yield acoustic modes with ω(q=0)=0 </span></h3>
<p>This may
not be an error: the Acoustic Sum Rule (ASR) is never exactly verified,
because the system is never exactly translationally invariant as it should be
(see the discussion above). The calculated frequency of the acoustic mode
is typically less than 10 cm<sup>−1</sup> , but in some cases it may be much higher,
up to 100 cm<sup>−1</sup> . The ultimate test is to diagonalize the dynamical matrix
with program dynmat.x, imposing the ASR. If you obtain an acoustic mode
with a much smaller ω (let’s say &lt; 1 cm<sup>−1</sup> ) with all other modes virtually
unchanged, you can trust your results.
</p>
<a name="ph.x_yields_really_lousy_phonons.2C_with_bad_or_negative_frequencies_or_wrong_symmetries_or_gross_ASR_violations"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=37" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">ph.x yields really lousy phonons, with bad or negative frequencies or wrong symmetries or gross ASR violations</span></h3>
<p>Possible reasons:
</p>
<ul><li> wrong data file read.
</li><li> wrong atomic masses given in input will yield wrong frequencies (but the content of file fildyn should be valid, since the force constants, not the dynamical matrix, are written to file).
</li><li> convergence threshold for either SCF (conv_thr) or phonon calculation (tr2_ph) too large (try to reduce them).
</li><li> maybe your system does have negative or strange phonon frequencies, with the approximations you used. A negative frequency signals a mechanical instability of the chosen structure. Check that the structure is reasonable, and check the following parameters:
<ul><li> The cutoff for wavefunctions, ecutwfc
</li><li> For US PP: the cutoff for the charge density, ecutrho
</li><li> The k-point grid, especially for metallic systems!
</li></ul>
</li></ul>
<a name=".27Wrong_degeneracy.27_error_in_star_q"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Troubleshooting_%28PWscf%29&amp;action=edit&amp;section=38" title="Troubleshooting (PWscf)">edit</a>]</span> <span class="mw-headline">'Wrong degeneracy' error in star_q</span></h3>
<p>Verify the q-point for which you are calculating phonons. In order to check whether a symmetry operation belongs to the small group of q, the code compares q and the rotated q, with an acceptance tolerance of 
10<sup>−5</sup> (set in routine PW/eqvect.f90). You may run into trouble if your q-point differs from a 
high-symmetry point by an amount in that order of magnitude.
</p><p>Back to <a href="/wiki/index.php/Main_Page" title="Main Page">Main Page</a>
</p>
<a name="Frequently_Asked_Questions_.28FAQ.29"></a><h2><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=1" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline">Frequently Asked Questions (FAQ)</span></h2>
<a name="Installation_2"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=2" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline">Installation</span></h3>
<p>Most installation problems have obvious origins and can be solved by reading
error messages and acting accordingly. Sometimes the reason for a failure
is less obvious. In such a case, you should look into the 
<a href="/wiki/index.php/Installation#Installation_issues" title="Installation">Installation#Installation_issues</a>
section of the <a href="/wiki/index.php/User_Guide" title="User Guide">User Guide</a>, and into the pw_forum archive to see if a similar
problem (with solution) is described. If you get really weird error messages
during installation, look for them with your preferred Internet search engine
(such as Google).
</p>
<a name="What_Fortran_compiler_do_I_need_to_compile_Q-E.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=3" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>What Fortran compiler do I need to compile Q-E?</i></span></h4>
<p><b>A:</b> Any non-buggy, or not-too-buggy, fortran-95 compiler should work,
with minimal or no changes to the code. configure may not be able to
recognize your system, though.
</p>
<a name="Why_is_configure_saying_that_I_have_no_fortran_compiler.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=4" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>Why is configure saying that I have no fortran compiler?</i></span></h4>
<p><b>A:</b>You haven’t one. Really! More exactly, you have none of the fortran compilers
configure is trying in your execution path. If your hardware/software combination
is supported, fix your execution path.
</p>
<a name="Why_is_configure_saying_that_my_fortran_compiler_doesn.27t_work.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=5" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>Why is configure saying that my fortran compiler doesn't work?</i></span></h4>
<p><b>A:</b> Because it doesn't. Really! More exactly, configure has tried to compile a
small test program and didn't succeed. Your compiler may not be properly 
installed. For Intel compiler on PC's: you may have forgotten to run the
required initialization script for the compiler.
</p>
<a name="configure_says_.27unsupported_architecture.27.2C_what_should_I_do.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=6" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>configure says 'unsupported architecture', what should I do?</i></span></h4>
<p><b>A:</b> If compilation/linking still works, never mind, Otherwise, supply a suitable 
supported architecture to configure: see instructions in README.configure on 
what to do. Note that in most cases you may use configure to produce dependencies, 
then edit the file make.sys.
</p>
<a name="Why_doesn.27t_configure_recognize_that_I_have_a_parallel_machine.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=7" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>Why doesn't configure recognize that I have a parallel machine?</i></span></h4>
<p><b>A:</b>You need a properly configured complete parallel environment. If any piece 
is missing, configure will revert to serial compilation. In particular:
</p>
<ul><li> configure tries to locate a parallel compiler in a logical  place with a logical name,  but if it has a strange names or it is located  in a strange location, you will have to instruct configure to find it. Note that in most PC clusters (Beowulf), there is no parallel Fortran-95 compiler:  you have to configure an appropriate script, such as mpif90.
</li><li> configure tries to locate libraries (both mathematical and parallel libraries) in logical places with logical names, but if they have strange names or strange locations, you will have to rename/move them, or to instruct configure to find them (see subsection “Libraries”). Note that if MPI libraries are not found, parallel compilation is disabled.
</li><li> configure tests that the compiler and the libraries are compatible (i.e. the compiler may link the libraries without conflicts and without missing symbols). If they aren't and the compilation fail, configure will revert to serial compilation.
</li></ul>
<a name="Compilation_fails_with_.22internal_error.22.2C_what_should_I_do.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=8" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>Compilation fails with "internal error", what should I do?</i></span></h4>
<p><b>A:</b> Any message saying something like "internal compiler error" means
that your compiler is buggy. If you paid real money for your compiler,
complain with the software vendor. If not: sometimes reducing the optimization
level will do the trick, sometimes rearranging the code solves the problem,
but most often you will need to update your compiler to a less buggy version. 
</p>
<a name="Compilation_fails_at_linking_stage:_.22symbol_..._not_found.22"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=9" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>Compilation fails at linking stage: "symbol ... not found"</i></span></h4>
<p><b>A:</b> If the missing symbols (i.e. routines that are called but not found)
are in the code itself: most likely the fortran-to-C conventions used
in file include/c_defs.h are not appropriate. Change them and retry.
</p><p>If the missing symbols are in external libraries (Blas, Lapack, FFT, MPI libraries):
there is a name mismatch between what the compiler expects and what the
library provides. This case is described in detail in the User Guide.
</p><p>If the missing symbols aren't found anywhere either in the code or in the
libraries: they are system library symbols. i) If they are called by external 
libraries, you need to add a missing system library, or to use a different 
set of external libraries, compiled with the same compiler you are using. 
ii) If you are using no external libraries and still getting missing symbols, 
your compiler and compiler libraries are not correctly installed.
</p>
<a name="Input_data_2"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=10" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline">Input data</span></h3>
<a name="Where_can_I_find_the_crystal_structure.2Fatomic_positions_of_XYZ.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=11" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>Where can I find the crystal structure/atomic positions of XYZ?</i></span></h4>
<p><b>A:</b> The following site contains a lot of crystal structures: <a href="http://cst-www.nrl.navy.mil/lattice" class="external free" title="http://cst-www.nrl.navy.mil/lattice" rel="nofollow">http://cst-www.nrl.navy.mil/lattice</a> .
"Since this seems to come up often, I'd like to point out that the American Mineralogist Crystal Structure Database (<a href="http://rruff.geo.arizona.edu/AMS/amcsd" class="external free" title="http://rruff.geo.arizona.edu/AMS/amcsd" rel="nofollow">http://rruff.geo.arizona.edu/AMS/amcsd</a>) is another excellent place to find structures, though you will have to use it in conjunction with Bilbao (<a href="http://www.cryst.ehu.es" class="external free" title="http://www.cryst.ehu.es" rel="nofollow">http://www.cryst.ehu.es</a>), 
and have some understanding of space groups and Wyckoff positions".
</p>
<a name="Where_can_I_find_the_Brillouin_Zone.2Fhigh-symmetry_points.2Firreps_for_XYZ.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=12" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>Where can I find the Brillouin Zone/high-symmetry points/irreps for XYZ?</i></span></h4>
<p><b>A:</b> "You might find this web site useful:
<a href="http://www.cryst.ehu.es/cryst/get_kvec.html" class="external free" title="http://www.cryst.ehu.es/cryst/get_kvec.html" rel="nofollow">http://www.cryst.ehu.es/cryst/get_kvec.html</a>" (info by Cyrille Barreteau, nov. 2007).
Or else: in textbooks, such as e.g. "The mathematical theory of symmetry 
in solids", by Bradley and Cracknell.
</p>
<a name="Why_is_the_code_saying_.22Wrong_atomic_coordinates.22.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=13" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>Why is the code saying "Wrong atomic coordinates"?</i></span></h4>
<p><b>A:</b> Because they are: two or more atoms in the list of atoms have
overlapping, or anyway too close, positions. Can't you see why? look better, 
and remember that the code cheks periodic images as well.
</p>
<a name="The_code_stops_with_an_.22error_reading_namelist_xxxx.22"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=14" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>The code stops with an "error reading namelist xxxx"</i></span></h4>
<p><b>A:</b> Most likely there is a misspelled variable in namelist xxxx.
If there isn't any (have you looked carefully? really??
REALLY???), beware control 
characters like DOS ^M (control-M): they can confuse
the namelist-reading code. 
</p><p>If this message concerns the first namelist to be read
(usually "&amp;control"), and if you are running 
in parallel: try "code -inp input_file" instead of "code &lt; input_file". 
Some MPI libraries do not properly handle input redirection.
</p>
<a name="How_can_I_choose_parameters_for_variable-cell_molecular_dynamics.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=15" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>How can I choose parameters for variable-cell molecular dynamics?</i></span></h4>
<p><b>A</b>: “A common mistake many new users make is to set the time step dt
improperly to the same order of magnitude as for CP algorithm, or
not setting dt at all. This will produce a ‘not evolving dynamics’.
Good values for the original RMW (RM Wentzcovitch) dynamics are dt= 50 ÷ 70.
The choice of the cell mass is a delicate matter. An off-optimal mass will
make convergence slower. Too small masses, as well as too long time
steps, can make the algorithm unstable. A good cell mass will make
the oscillation times for internal degrees of freedom comparable to cell
degrees of freedom in non-damped Variable-Cell MD. Test calculations
are advisable before extensive calculation.
I have tested the damping algorithm that I have developed and it has
worked well so far. It allows for a much longer time step (dt=100 ÷ 150)
than the RMW one and is much more stable with very small cell masses,
which is useful when the cell shape, not the internal degrees of freedom,
is far out of equilibrium. It also converges in a smaller number of steps
than RMW.” (Info from Cesar Da Silva: the new damping algorithm is the default
since v. 3.1).
</p>
<a name="What_are_the_nr1b.2C_nr2b.2C_nr3b.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=16" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>What are the nr1b, nr2b, nr3b?</i></span></h4>
<p><b>A:</b> <i>ecutrho</i> defines the resolution on the real space FFT mesh (as expressed 
by nr1, nr2 and nr3, that the code left on its own sets automatically).
In the ultrasoft case we refer to this mesh as the ‘hard’ mesh, since it 
is denser than the smooth mesh that is needed to represent the square 
of the non-norm-conserving wavefunctions.
</p><p>On this ‘hard’, fine-spaced mesh, you need to determine the size of the
cube that will encompass the largest of the augmentation charges - this
is what nr1b, nr2b, nr3b are.
</p><p>So, nr1b is independent of the system size, but dependent on the size
of the augmentation charge (that doesn’t vary that much) and on the
real-space resolution needed by augmentation charges (rule of thumb:
ecutrho is between 6 and 12 times ecutwfc).
</p><p>In practice, nr1b et al. are often in the region of 20-24-28; testing seems
again a necessity (unless the code started automagically to estimate these).
</p><p>The core charge is in principle finite only at the core region (as defined
by rcut ) and vanishes out side the core. Numerically the charge is
represented in a Fourier series which may give rise to small charge
oscillations outside the core and even to negative charge density, but
only if the cut-oﬀ is too low. Having these small boxes removes the
charge oscillations problem (at least outside the box) and also oﬀers
some numerical advantages in going to higher cut-offs.
</p><p>The small boxes should be set as small as possible, but large enough
to contain the core of the largest element in your system.
The formula for determining the box size is quite simple: 
</p>
<pre>  nr1b = (2 ∗ rcut )/Lx ∗ nr1
</pre>
<p>where rcut is the cut-off radius for the largest element and Lx is the
physical length of your box along the x axis. You have to round your
result to the nearest larger integer.” (info by Nicola Marzari)
</p>
<a name="Self_Consistency"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=17" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline">Self Consistency</span></h3>
<a name="How_is_the_charge_density_.28the_potential.2C_etc..29_stored.3F_What_position_in_real_space_corresponds_to_an_array_value.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=18" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>How is the charge density (the potential, etc.) stored? What position in real space corresponds to an array value?</i></span></h4>
<p><b>A:</b> The index of arrays used to store functions defined on 3D meshes is
actually a shorthand for three indeces, following the FORTRAN convention (“leftmost index runs faster”). An example will explain this better. Suppose you have a 3D array of dimension (nr1,nr2,nr3), say psi(nr1,nr2,nr3). FORTRAN compilers store this array sequentially in the computer RAM in the following way:
</p>
<pre>       psi(1,1,1)
       psi(2,1,1)
       ...
       psi(nr1,1,1)
       psi(1,2,1)
       psi(2,2,1)
       ...
       psi(nr1,2,1)
       ...
       psi(nr1,nr2,1)
       psi(1,1,nr3)
</pre>
<p>etc
Let ind be the position of the (i,j,k) element in the above list: the
relation between ind and (i,j,k) is:
</p>
<pre>            ind = i + (j − 1) ∗ nr1 + (k − 1) ∗ nr2 ∗ nr1
</pre>
<p>This should clarify the relation between 1D and 3D indexing. In real
space, the (i,j,k) point of the mesh is
</p>
<pre>            <img class='tex' src="/wiki/images/math/c/4/9/c496681f0cd0080f0df22d2fb225dda7.png" alt="r_{ijk}=\frac{i-1}{nr1} * \tau_1  +  \frac{j-1}{nr2} * \tau_2 + \frac{k-1}{nr3} * \tau_3" />
</pre>
<p>where the <span class="texhtml">&tau;</span> ’s are the basis vectors of the Bravais lattice. The latter
are stored row-wise in the “AT” array:
</p>
<pre>            <span class="texhtml">&tau;<sub>1</sub></span> = at(:, 1), <span class="texhtml">&tau;<sub>2</sub></span> = at(:, 2), <span class="texhtml">&tau;<sub>3</sub></span> = at(:, 3)
</pre>
<p>(info by Stefano Baroni)
</p>
<a name="What_is_the_difference_between_total_and_absolute_magnetization.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=19" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>What is the difference between total and absolute magnetization?</i></span></h4>
<p><b>A:</b> The total magnetization is the integral of the magnetization in the cell:
</p><p><img class='tex' src="/wiki/images/math/2/a/1/2a1790a0d5cfc207f68d54e43fda9800.png" alt="M_T = \int (n_{up}-n_{down}) d^3r" />.
</p><p>The absolute magnetization is the integral of the absolute value of the magnetization 
in the cell:
</p><p><img class='tex' src="/wiki/images/math/5/e/3/5e398117b889c8551d5647a0e25aef58.png" alt="M_A= \int |n_{up}-n_{down}| d^3r" />
</p><p>In a simple feromagnetic material they should be equal (except possibly for an overall sign)
In simple antiferromagnets (like FeO, NiO) <span class="texhtml"><i>M</i><sub><i>T</i></sub></span> is zero and <span class="texhtml"><i>M</i><sub><i>A</i></sub></span> is 
twice the magnetization of each of the two atoms. (info by Stefano de Gironcoli)
</p>
<a name="How_can_I_calculate_magnetic_moments_for_each_atom.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=20" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>How can I calculate magnetic moments for each atom?</i></span></h4>
<p><b>A:</b> There is no 'right' way of defining the local magnetic moment
around an atom in a multi-atom system. However an approximate way to define
it is via the projected density of states on the atomic orbitals (code
projwfc.x, see example08 for its use as a postprocessing tool). This
code generate many files with the density of states projected on each
atomic wavefunction of each atom and a BIG amount of data on the
standard output, the last few lines of which contain the decomposition
of Lowdin charges on angular momentum and spin component of each
atom.
</p>
<a name="How_do_I_perform_a_calculation_with_spin-orbit_interactions.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=21" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>How do I perform a calculation with spin-orbit interactions?</i></span></h4>
<p><b>A:</b>  The following input variables are relevant for a spin-orbit calculation:
</p>
<pre>     noncolin=.true./.false.
     lspinorb=.true./.false.
     starting_magnetization (one for each type of atoms)
</pre>
<p>To make a spin-orbit calculation noncolin must be true. 
If starting_magnetization is set to zero (or not given)  the code makes a spin orbit calculation without spin magnetization (it assumes that time reversal symmetry holds and it does not calculate the magnetization). The states are still two component spinors but the total magnetization is zero.
</p><p>If starting_magnetization is different from zero it makes a non collinear spin polarized calculation with spin orbit. The final spin magnetization might be zero or different from zero depending on the system.
</p><p>Furthermore to make a spin-orbit calculation you must use fully relativistic pseudopotentials at least for the atoms in which you think that spin orbit is large. If all the pseudopotentials are scalar relativistic the calculation becomes equivalent to a noncolinear calculation without spin orbit.
(Andrea Dal Corso, 2007-07-27)
</p>
<a name="What_is_the_order_of_Ylm_components_in_projected_DOS_.2F_projection_of_atomic_wavefunctions.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=22" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> <i>What is the order of <span class="texhtml"><i>Y</i><sub><i>l</i><i>m</i></sub></span> components in projected DOS / projection of atomic wavefunctions?</i></span></h4>
<p><b>A:</b> "The order is, I think:
</p>
<pre>   1   <span class="texhtml"><i>P</i><sub>0,0</sub>(<i>t</i>)</span>
   2   <span class="texhtml"><i>P</i><sub>1,0</sub>(<i>t</i>)</span>
   3   <span class="texhtml"><i>P</i><sub>1,1</sub>(<i>t</i>)<i>c</i><i>o</i><i>s</i>&phi;</span>
   4   <span class="texhtml"><i>P</i><sub>1,1</sub>(<i>t</i>)<i>s</i><i>i</i><i>n</i>&phi;</span> 
   5   <span class="texhtml"><i>P</i><sub>2,0</sub>(<i>t</i>)</span>
   6   <span class="texhtml"><i>P</i><sub>2,1</sub>(<i>t</i>)<i>c</i><i>o</i><i>s</i>&phi;</span> 
   7   <span class="texhtml"><i>P</i><sub>2,1</sub>(<i>t</i>)<i>s</i><i>i</i><i>n</i>&phi;</span>
   8   <span class="texhtml"><i>P</i><sub>2,2</sub>(<i>t</i>)<i>c</i><i>o</i><i>s</i>2&phi;</span>
   9   <span class="texhtml"><i>P</i><sub>2,2</sub>(<i>t</i>)<i>s</i><i>i</i><i>n</i>2&phi;</span>
</pre>
<p>and so on; <span class="texhtml"><i>P</i><sub><i>l</i>,<i>m</i></sub></span>=Legendre Polynomials, <span class="texhtml"><i>t</i> = <i>c</i><i>o</i><i>s</i>&theta;</span>  = z /r, <span class="texhtml">&phi;</span>= atan(y /x). No warranty. Anybody really interested in knowing 
<i>for sure</i> which spherical harmonic combination is which should look into routine 
ylmr2 in flib/ylmr2.f90".
</p>
<a name="Phonons"></a><h3><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=23" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> Phonons </span></h3>
<a name="Is_there_a_simple_way_to_determine_the_symmetry_of_a_given_phonon_mode.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=24" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> Is there a simple way to determine the symmetry of a given phonon mode?</span></h4>
<p><b>A:</b> A symmetry analyzer was added in v.3.2 by Andrea Dal Corso. The following info may still be of interest to somebody, though:
</p><p>See the ISOTROPY package: <a href="http://stokes.byu.edu/iso/isotropy.html" class="external free" title="http://stokes.byu.edu/iso/isotropy.html" rel="nofollow">http://stokes.byu.edu/iso/isotropy.html</a>.
</p><p>“Please follow <a href="http://dx.doi.org/10.1016/0010-4655(94)00164-W" class="external free" title="http://dx.doi.org/10.1016/0010-4655(94)00164-W" rel="nofollow">http://dx.doi.org/10.1016/0010-4655(94)00164-W</a> and
<a href="http://dx.doi.org/10.1016/0010-4655(74)90057-5" class="external free" title="http://dx.doi.org/10.1016/0010-4655(74)90057-5" rel="nofollow">http://dx.doi.org/10.1016/0010-4655(74)90057-5</a>. These are connected to some 
programs found in the Computer Physics Communications Program Library 
(<a href="http://www.cpc.cs.qub.ac.uk" class="external free" title="http://www.cpc.cs.qub.ac.uk" rel="nofollow">http://www.cpc.cs.qub.ac.uk</a> ) which are described in the articles:<br />
ACKJ v1.0 Normal coordinate analysis of crystals, J.Th.M. de Hosson.<br />
ACMI v1.0 Group-theoretical analysis of lattice vibrations, T.G. Worlton, J.L. Warren. See erratum Comp. Phys. Commun. 4(1972)382.<br />
ACMM v1.0 Improved version of group-theoretical analysis of lattice dynamics, J.L. Warren, T.G. Worlton.” (Info from Pascal Thibaudeau)
</p>
<a name="I_am_not_getting_zero_acoustic_mode_frequencies.2C_why.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=25" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> I am not getting zero acoustic mode frequencies, why? </span></h4>
<p><b>A:</b> "If you treat, e.g., a molecule, the first six frequencies should vanish. 
However, due to convergence (number of plane waves, size of the supercell, 
etc. ) they often appear as imaginary or small real, even if all other 
frequencies are converged with respect to ecut and celldm.
</p><p>If you have a bulk structure, then imaginary frequencies indicate a 
lattice instability. However, they can appear also as a result of a 
non-converged groundstate (Ecut, #k, ...).
</p><p>Recently I also found that the parameters tr2_ph for the phonons and 
conv_thr for the groundstate can affect the quality of the phonon 
calculation, especially the "vanishing" frequencies for molecules."
(Info from Katalyn Gaal-Nagy)
</p>
<a name="Why_do_I_get_negative_phonon_frequencies.3F"></a><h4><span class="editsection">[<a href="/wiki/index.php?title=Frequently_Asked_Questions&amp;action=edit&amp;section=26" title="Frequently Asked Questions">edit</a>]</span> <span class="mw-headline"> Why do I get negative phonon frequencies? </span></h4>
<p><b>A:</b> If these occur for acoustic frequencies at Gamma point, see above.
If these occur for rotational modes in a molecule into a supercell: 
it is a fictitious effect of the finite supercell size. If these
occur in other cases, it depends. It may be a problem of bad
convergence (see above) or it may signal a real instability.
</p><p>An example: large negative phonon frequencies in 1-dimensional chains.
"It is because probably some of atoms are sitting on the saddle points 
of the energy surface. Since QE symmetrizes charge density to avoid small 
numerical oscillation, the system cannot break the symmetry with the help 
of numerical noise. Check your system's stability by displacing one or more 
atoms a little bit along the direction of eigen-vector which has negative 
frequency. The eigen-vector can be found in the output of dynamical matrices 
of ph.x. One example here is: for 1d aluminum chain, the LO mode will be 
negative if you place two atoms at (0.0,0.0,0.0) and (0.0,0.0,0.5) of crystal 
coordinates. To break the symmetry enforced by QE code, change the second atom 
coordinate to (0.0,0.0,0.505). Relax the system. You will find the atom will 
get itself a comfortable place at (0.0,0.0,0.727), showing a typical dimerization 
effect." (info by Nicola Marzari).
</p><!-- 
Pre-expand include size: 165163 bytes
Post-expand include size: 166233 bytes
Template argument size: 34 bytes
Maximum: 2097152 bytes
-->

<!-- Saved in parser cache with key quantumdb:pcache:idhash:1411-0!1!0!!en!2 and timestamp 20080513171054 -->
<div class="printfooter">
Retrieved from "<a href="http://www.quantum-espresso.org/wiki/index.php/Printable_Quantum-Espresso_Documentation">http://www.quantum-espresso.org/wiki/index.php/Printable_Quantum-Espresso_Documentation</a>"</div>
	    	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-main"
	       class="selected"	       ><a href="/wiki/index.php/Printable_Quantum-Espresso_Documentation">Article</a></li><li id="ca-talk"
	       class="new"	       ><a href="/wiki/index.php?title=Talk:Printable_Quantum-Espresso_Documentation&amp;action=edit">Discussion</a></li><li id="ca-edit"
	       	       ><a href="/wiki/index.php?title=Printable_Quantum-Espresso_Documentation&amp;action=edit">Edit</a></li><li id="ca-history"
	       	       ><a href="/wiki/index.php?title=Printable_Quantum-Espresso_Documentation&amp;action=history">History</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-personal">
	  <h5>Personal tools</h5>
	  <div class="pBody">
	    <ul>
	    <li id="pt-login"><a href="/wiki/index.php?title=Special:Userlogin&amp;returnto=Printable_Quantum-Espresso_Documentation">Log in / create account</a></li>	    </ul>
	  </div>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(/grafica/quantum_espresso6_trasparentbg.png);"
	    href="/"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-mainpage"><a href="/wiki/index.php/Main_Page">Main Page</a></li>
	     	      <li id="n-portal"><a href="/wiki/index.php/QuantumEspresso:Community_Portal">Community portal</a></li>
	     	      <li id="n-currentevents"><a href="/wiki/index.php/Current_events">Current events</a></li>
	     	      <li id="n-recentchanges"><a href="/wiki/index.php/Special:Recentchanges">Recent changes</a></li>
	     	      <li id="n-randompage"><a href="/wiki/index.php/Special:Random">Random page</a></li>
	     	      <li id="n-help"><a href="/wiki/index.php/Help:Contents">Help</a></li>
	     	      <li id="n-sitesupport"><a href="/wiki/index.php/QuantumEspresso:Site_support">Donations</a></li>
	     	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div class="pBody">
	    <form name="searchform" action="/wiki/index.php/Special:Search" id="searchform">
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go"
	        />&nbsp;<input type='submit' name="fulltext"
	        class="searchButton"
	        value="Search" />
	    </form>
	  </div>
	</div>
	<div class="portlet" id="p-tb">
	  <h5>Toolbox</h5>
	  <div class="pBody">
	    <ul>
		  		  <li id="t-whatlinkshere"><a href="/wiki/index.php/Special:Whatlinkshere/Printable_Quantum-Espresso_Documentation">What links here</a></li>
		  		  <li id="t-recentchangeslinked"><a href="/wiki/index.php/Special:Recentchangeslinked/Printable_Quantum-Espresso_Documentation">Related changes</a></li>
		                	      	      	      	      	      	      	      <li id="t-upload"><a href="/wiki/index.php/Special:Upload">Upload file</a></li>	      	      <li id="t-specialpages"><a href="/wiki/index.php/Special:Specialpages">Special pages</a></li>	      	      	      <li id="t-print"><a href="/wiki/index.php?title=Printable_Quantum-Espresso_Documentation&amp;printable=yes">Printable version</a></li>
	      	    </ul>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="/wiki/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>		<ul id="f-list">
	  <li id="f-lastmod"> This page was last modified 17:29, 10 May 2008.</li>	  <li id="f-viewcount">This page has been accessed 87 times.</li>	  	  	  	  <li id="f-about"><a href="/wiki/index.php/QuantumEspresso:About" title="QuantumEspresso:About">About QuantumEspresso</a></li>	  <li id="f-disclaimer"><a href="/wiki/index.php/QuantumEspresso:General_disclaimer" title="QuantumEspresso:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
    <!-- Served by democritos.sissa.it in 0.337 secs. -->  </body>
</html>
