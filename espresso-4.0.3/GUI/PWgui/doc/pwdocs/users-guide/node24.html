<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>8 Troubleshooting (PWscf)</TITLE>
<META NAME="description" CONTENT="8 Troubleshooting (PWscf)">
<META NAME="keywords" CONTENT="users-guide">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="users-guide.css">

<LINK REL="next" HREF="node25.html">
<LINK REL="previous" HREF="node19.html">
<LINK REL="up" HREF="users-guide.html">
<LINK REL="next" HREF="node25.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html532"
  HREF="node25.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.gif"></A> 
<A NAME="tex2html528"
  HREF="users-guide.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.gif"></A> 
<A NAME="tex2html522"
  HREF="node23.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.gif"></A> 
<A NAME="tex2html530"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html533"
  HREF="node25.html">9 Frequently Asked Questions</A>
<B> Up:</B> <A NAME="tex2html529"
  HREF="users-guide.html">User's Guide for Quantum-ESPRESSO</A>
<B> Previous:</B> <A NAME="tex2html523"
  HREF="node23.html">7.4 Parallelization issues</A>
   <B>  <A NAME="tex2html531"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00090000000000000000">
8 Troubleshooting (PWscf)</A>
</H1>

<P>
Almost all problems in PWscf arise from incorrect input data and
result in error stops. Error messages should be self-explanatory, 
but unfortunately this is not always true. If the code issues a
warning messages and continues, pay attention to it but do not
assume that something is necessarily wrong in your calculation:
most warning messages signal harmless problems.

<P>
Typical <TT>pw.x</TT> and/or <TT>ph.x</TT> (mis-)behavior:

<P>

<H4><A NAME="SECTION00090010000000000000">
8.0.0.1 <TT>pw.x</TT> yields a message like ``error while loading
           shared libraries: ... cannot open shared object file''
           and does not start.</A>
</H4>

<P>
Possible reasons: 

<P>

<UL>
<LI>If you are running on the same machines on which the code was
    compiled, this is a library configuration problem.
    The solution is machine-dependent.
    On Linux, find the path to the missing libraries; then either add
    it to file <TT>/etc/ld.so.conf</TT> and run <TT>ldconfig</TT>
    (must be done as root), or add it to variable
    <TT>LD_LIBRARY_PATH</TT> and export it.
    Another possibility is to load non-shared version of libraries
    (ending with <TT>.a</TT>) instead of shared ones (ending with
    <TT>.so</TT>).
</LI>
<LI>If you are <I>not</I> running on the same machines on which the
    code was compiled: you need either to have the same shared
    libraries installed on both machines, or to load statically all
    libraries (using appropriate <TT>configure</TT> or loader options). 
    The same applies to Beowulf-style parallel machines: the needed 
    shared libraries must be present on all PC's.
</LI>
</UL>

<P>

<H4><A NAME="SECTION00090020000000000000">
8.0.0.2 errors in examples with parallel execution</A>
</H4>

<P>
If you get error messages in the example scripts - i.e. not errors
in the codes - on a parallel  machine, such as e.g. :
``<TT>run_example: -n: command not found</TT>''
you have forgotten the `''` in the definitions of 
<TT>PARA_PREFIX</TT> and <TT>PARA_POSTFIX</TT>.

<P>

<H4><A NAME="SECTION00090030000000000000">
8.0.0.3 <TT>pw.x</TT> prints the first few lines and then nothing
happens (parallel execution).</A>
</H4>

<P>
If the code looks like it is not reading from input, maybe it isn't:
the MPI libraries need to be properly configured to accept input 
redirection. See section ``Running on parallel machines'', or inquire 
with your local computer wizard (if any).

<P>

<H4><A NAME="SECTION00090040000000000000">
8.0.0.4 <TT>pw.x</TT> stops with error in reading.</A>
</H4>

<P>
There is an error in the input data.
Usually it is a misspelled namelist variable, or an empty input file.
Note that out-of-bound indices in dimensioned variables read in the
namelist may cause the code to crash with really mysterious error
messages.
Also note that input data files containing <TT>^M</TT> (Control-M)
characters at the end of lines (typically, files coming from Windows
PC) may yield error in reading.
If none of the above applies and the code stops at the first namelist
(``control'') and you are running in parallel: your MPI libraries
might not be properly configured to allow input redirection, so that 
what you are effectively reading is an empty file.
See section ``Running on parallel machines'', or inquire with your 
local computer wizard (if any).

<P>

<H4><A NAME="SECTION00090050000000000000">
8.0.0.5 <TT>pw.x</TT> mumbles something like ``cannot recover'' or
           ``error reading recover file''.</A>
</H4>

<P>
You are trying to restart from a previous job that either produced 
corrupted files, or did not do what you think it did. No luck:
you have to restart from scratch.

<P>

<H4><A NAME="SECTION00090060000000000000">
8.0.0.6 <TT>pw.x</TT> stops with ``inconsistent DFT'' error.</A>
</H4>

<P>
As a rule, the flavor  of DFT used in the calculation should be the
same as the one used in the generation of PP's, and all PP's should 
be generated  using the same flavor of DFT. This is actually enforced: 
the type of DFT is read from PP files and it is checked that the same 
DFT is read from all PP's. If this does not hold, the code stops with 
the above error message. 

<P>
If you really want to use PP's generated with different DFT, or
to perform a calculation with a DFT that differs from what used in
PP generation, change the appropriate field in the PP file(s), at
your own risk.

<P>

<H4><A NAME="SECTION00090070000000000000">
8.0.0.7 <TT>pw.x</TT> stops with error in cdiaghg or rdiaghg.</A>
</H4>

<P>
Possible reasons for such behavior are not always clear, but they
typically fall into one of the following cases:

<UL>
<LI>serious error in data, such as bad atomic positions or bad crystal
    structure/supercell;
</LI>
<LI>a bad PP, typicall with a ghost, but also a US-PP with non-positive
    charge density, leading to a violation of positiveness of the S 
    matrix appearing in the US-PP formalism;
</LI>
<LI>a failure of the algorithm performing subspace diagonalization. 
    The LAPACK algorithms used by cdiaghg/rdiaghg are very robust 
    and extensively tested. Still, it may seldom happen that such
    algorithms fail. Try to use conjugate-gradient diagonalization 
    (<TT>diagonalization='cg'</TT>), a slower but very robust 
    algorithm, and see what happens.
</LI>
<LI>buggy libraries. Machine-optimized mathematical libraries are 
    very fast but sometimes not so robust from a numerical point
    of view. Suspicious behavior: you get an error that is not
    reproducible on other architectures or that disappears if the 
    calculation is repeated with even minimal changes in parameters.
    One known case: HP-Compaq alphas with <TT>cxml</TT> libraries. 
    Try to use compiled BLAS and LAPACK (or better, ATLAS) instead of
    machine-optimized libraries.
</LI>
</UL>

<P>

<H4><A NAME="SECTION00090080000000000000">
8.0.0.8 <TT>pw.x</TT> crashes with ``floating invalid'' or 
``floating divide by zero''.</A>
</H4>

<P>
If this happens on HP-Compaq True64 Alpha machines with an old
version of the compiler: the compiler is most likely buggy.
Otherwise, move to next item.

<P>

<H4><A NAME="SECTION00090090000000000000">
8.0.0.9 <TT>pw.x</TT> crashes with no error message at all.</A>
</H4>

<P>
This happens quite often in parallel execution, or under a batch
queue, or if you are writing the output to a file.
When the program crashes, part of the output, including the error
message, may be lost, or hidden into error files where nobody looks
into.
It is the fault of the operating system, not of the code.
Try to run interactively and to write to the screen.
If this doesn't help, move to next point.

<P>

<H4><A NAME="SECTION000900100000000000000">
8.0.0.10 <TT>pw.x</TT> crashes with ``segmentation fault'' or
           similarly obscure messages.</A>
</H4>

<P>
Possible reasons:

<UL>
<LI>too much RAM memory requested (see next item).
</LI>
<LI>if you are using highly optimized mathematical libraries, verify
    that they are designed for your hardware.
    In particular, for Intel compiler and MKL libraries, verify that
    you loaded the correct set of CPU-specific MKL libraries.
</LI>
<LI>buggy compiler.
    If you are using Portland or Intel compilers on Linux PC's or
    clusters, see section <A HREF="node11.html#installissues">2.4</A>, ``Installation
    issues''.
</LI>
</UL>

<P>

<H4><A NAME="SECTION000900110000000000000">
8.0.0.11 <TT>pw.x</TT> works for simple systems, but not for large
           systems or whenever more RAM is needed.</A>
</H4>

<P>
Possible solutions:

<UL>
<LI>increase the amount of RAM you are authorized to use (which may be
    much smaller than the available RAM).
    Ask your system administrator if you don't know what to do.
</LI>
<LI>reduce <TT>nbnd</TT> to the strict minimum, or reduce the cutoffs,
    or the cell size.
</LI>
<LI>use conjugate-gradient (<TT>diagonalization='cg'</TT>: slow 
    but very robust): it requires less memory than the default 
    Davidson algorithm.
</LI>
<LI>in parallel execution, use more processors, or use the same number
    of processors with less pools.
    Remember that parallelization with respect to k-points (pools)
    does not distribute memory: parallelization with respect to
    <B>R</B>- (and <B>G</B>-) space does.
</LI>
<LI>IBM only (32-bit machines): if you need more than 256 MB you must
    specify it at link time (option <TT>-bmaxdata</TT>).
</LI>
<LI>buggy or weird-behaving compiler.
    Some versions of the Portland and Intel compilers on Linux PC's 
    or clusters have this problem. For Intel ifort 8.1, the problem
    seems to be due to the allocation of large automatic arrays
    that exceeds the available stack. Increasing the stack size 
    (with commands <TT>limits</TT> or <TT>ulimit</TT>) may (or may
    not) solve the problem. In particular, if you try to run <TT>ph.x</TT> 
    on a PC with ifort you will get segmentation faults unless you run
    small systems.
    It is a compiler problem and the only solution is to reduce the
    size of arrays if you can (for instance by running in parallel 
    or on more processors) or to find a different machine or compiler.
</LI>
</UL>

<P>

<H4><A NAME="SECTION000900120000000000000">
8.0.0.12 <TT>pw.x</TT> crashes in parallel execution with an obscure
            message related to MPI errors.</A>
</H4>

<P>
See info from Axel Kohlmeyer:
<BR>
<A NAME="tex2html45"
  NAME="http://www.democritos.it/pipermail/pw_forum/2005-April/002338.html"><FONT SIZE="-1"><TT>http://www.democritos.it/pipermail/pw_forum/2005-April/002338.html</TT></FONT></A>
<P>
Random crashes due to MPI errors have often been reported in Linux PC 
clusters. We cannot rule out the possibility that bugs in Quantum-ESPRESSO
cause such behavior, but we are quite confident that the likely explanation
is a hardware problem (defective RAM for instance) or a software bug (in MPI 
libraries, compiler, operating system).

<P>

<H4><A NAME="SECTION000900130000000000000">
8.0.0.13 <TT>pw.x</TT> runs but nothing happens.</A>
</H4>

<P>
Possible reasons:

<UL>
<LI>in parallel execution, the code died on just one processor.
    Unpredictable behavior may follow.
</LI>
<LI>in serial execution, the code encountered a floating-point error
    and goes on producing NaN's (Not a Number) forever unless
    exception handling is on (and usually it isn't).
    In both cases, look for one of the reasons given above.
</LI>
<LI>maybe your calculation will take more time than you expect.
</LI>
</UL>

<P>

<H4><A NAME="SECTION000900140000000000000">
8.0.0.14 <TT>pw.x</TT> yields weird results.</A>
</H4>

<P>
Possible solutions:

<UL>
<LI>if this happens after a change in the code or in compilation or
    preprocessing options, try <TT>make clean</TT> and recompile.
    The <TT>make</TT> command should take care of all dependencies,
    but do not rely too heavily on it. 
    If the problem persists, <TT>make clean</TT> and recompile with
    reduced optimization level.
</LI>
<LI>maybe your input data are weird.
</LI>
</UL>

<P>

<H4><A NAME="SECTION000900150000000000000">
8.0.0.15 <TT>pw.x</TT> stops with error message ``the system is
           metallic, specify occupations''.</A>
</H4>

<P>
You did not specify state occupations, but you need to, since your
system appears to have an odd number of electrons.
The variable controlling how metallicity is treated is
<TT>occupations</TT> in namelist <TT>&amp;SYSTEM</TT>.
The default, <TT>occupations='fixed'</TT>, occupies the lowest
<TT>nelec/2</TT> states and works only for insulators with a gap.
In all other cases, use <TT>'smearing'</TT> or <TT>'tetrahedra'</TT>.
See file <TT>INPUT_PW</TT> for more details.

<P>

<H4><A NAME="SECTION000900160000000000000">
8.0.0.16 <TT>pw.x</TT> stops with ``internal error: cannot braket Ef'' in
           <TT>efermig</TT>.</A>
</H4>

<P>
Possible reasons:

<UL>
<LI>serious error in data, such as bad number of electrons,
    insufficient number of bands, absurd value of broadening;
</LI>
<LI>the Fermi energy is found by bisection assuming that the
    integrated DOS <I>N</I>(<I>E</I>)
<tex2html_verbatim_mark> is an increasing function of the energy. 
    This is <EM>not</EM> guaranteed for Methfessel-Paxton smearing of
    order 1 and can give problems when very few k-points are used.
    Use some other smearing function: simple Gaussian broadening or,
    better, Marzari-Vanderbilt ``cold smearing''.
</LI>
</UL>

<P>

<H4><A NAME="SECTION000900170000000000000">
8.0.0.17 <TT>pw.x</TT> yields ``internal error: cannot braket Ef'' message
in <TT>efermit</TT>, then stops because ``charge is incorrect''.</A>
</H4>

<P>
There is either a serious error in data (bad number of electrons, 
insufficient number of bands), or too few tetrahedra (i.e. k-points). 
The tetrahedron method may become unstable in the latter case, especially 
if the bands are very narrow. Remember that tetrahedra should be used only
in conjunction with uniform k-point grids.

<P>

<H4><A NAME="SECTION000900180000000000000">
8.0.0.18 <TT>pw.x</TT> yields ``internal error: cannot braket Ef'' message
in <TT>efermit</TT> but doesn't stop.</A>
</H4>

<P>
This may happen under special circumstances when you are calculating the band 
structure for selected high-symmetry lines. The message signals that 
occupations and Fermi energy are not correct (but eigenvalues and eigenvectors 
are). Remove <TT>occupations='tetrahedra'</TT> in the input data to get rid of 
the message.

<P>

<H4><A NAME="SECTION000900190000000000000">
8.0.0.19 in parallel execution, <TT>pw.x</TT> stops complaining that
           ``some processors have no planes'' or ``smooth planes'' or
           some other strange error.</A>
</H4>

<P>
Your system does not require that many processors: reduce the number
of processors to a more sensible value.
In particular, both <I>N</I><SUB>3</SUB>
<tex2html_verbatim_mark> and <I>Nr</I><SUB>3</SUB>
<tex2html_verbatim_mark> must be <!-- MATH
 $\geq N_{pr}$
 -->
<IMG
 WIDTH="20" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="img8.gif"
 ALT="$ \geq$"> <I>N</I><SUB>pr</SUB>
<tex2html_verbatim_mark> (see
section <A HREF="node19.html#performance">7</A>, ``Performance Issues'', and in particular
section <A HREF="node23.html#parissues">7.4</A>, ``Parallelization issues'', for the meaning
of these variables).

<P>

<H4><A NAME="SECTION000900200000000000000">
8.0.0.20 the FFT grids in <TT>pw.x</TT> are machine-dependent.</A>
</H4>

<P>
Yes, they are!
The code automatically chooses the smallest grid that is compatible
with the specified cutoff in the specified cell, <I>and</I> is an
allowed value for the FFT library used.
Most FFT libraries are implemented, or perform well, only with
dimensions that factors into products of small numers (2, 3, 5
typically, sometimes 7 and 11).
Different FFT libraries follow different rules and thus different
dimensions can result for the same system on different machines (or
even on the same machine, with a different FFT).
See function <TT>allowed</TT> in <TT>Modules/fft_scalar.f90</TT>.

<P>
As a consequence, the energy may be slightly different on different
machines.
The only piece that depends explicitely on the grid parameters is the
XC part of the energy that is computed numerically on the grid.
The differences should be small, though, expecially for LDA
calculations.

<P>
Manually setting the FFT grids to a desired value is possible, but
slightly tricky, using input variables <TT>nr1, nr2, nr3</TT> and
<TT>nr1s, nr2s, nr3s</TT>.
The code will still increase them if not acceptable.
Automatic FFT grid dimensions are slightly overestimated, so one may
try -- very carefully -- to reduce them a little bit.
The code will stop if too small values are required, it will waste CPU
time and memory for too large values.

<P>
Note that in parallel execution, it is very convenient to have FFT
grid dimensions along <I>z</I>
<tex2html_verbatim_mark> that are a multiple of the number of
processors.

<P>

<H4><A NAME="SECTION000900210000000000000">
8.0.0.21 ``warning: symmetry operation # N not allowed''.</A>
</H4>

<P>
This is not an error.
<TT>pw.x</TT> determines first the symmetry operations (rotations)
of the Bravais lattice; then checks which of these are symmetry
operations of the system (including if needed fractional
translations).
This is done by rotating (and translating if needed) the atoms in
the unit cell and verifying if the rotated unit cell coincides
with the original one. 

<P>
If a symmetry operation contains a
fractional translation that is incompatible with the FFT grid,
it is discarded in order to prevent problems with symmetrization.
Typical fractional translations are 1/2 or 1/3 of a lattice
vector. If the FFT grid dimension along that direction is not 
divisible respectively by 2 or by 3, the symmetry operation will 
not transform the FFT grid into itself.

<P>

<H4><A NAME="SECTION000900220000000000000">
8.0.0.22 <TT>pw.x</TT> doesn't find all the symmetries you
           expected.</A>
</H4>

<P>
See above to learn how PWscf finds symmetry operations.
Some of them might be missing because:

<UL>
<LI>the number of significant figures in the atomic positions is not
    large enough.
    In file <TT>PW/eqvect.f90</TT>, the variable <TT>accep</TT> is
    used to decide whether a rotation is a symmetry operation.
    Its current value (10<SUP>-5</SUP>
<tex2html_verbatim_mark>) is quite strict: a rotated atom must
    coincide with another atom to 5 significant digits.
    You may change the value of <TT>accep</TT> and recompile.
</LI>
<LI>they are not acceptable symmetry operations of the Bravais
    lattice.
    This is the case for C<SUB>60</SUB>
<tex2html_verbatim_mark>, for instance: the <I>I</I><SUB>h</SUB>
<tex2html_verbatim_mark> icosahedral
    group of C<SUB>60</SUB>
<tex2html_verbatim_mark> contains 5-fold rotations that are incompatible
    with translation symmetry.
</LI>
<LI>the system is rotated with respect to symmetry axis.
    For instance: a C<SUB>60</SUB>
<tex2html_verbatim_mark> molecule in the fcc lattice will have 24
    symmetry operations (<I>T</I><SUB>h</SUB>
<tex2html_verbatim_mark> group) only if the double bond is
    aligned along one of the crystal axis; if C<SUB>60</SUB>
<tex2html_verbatim_mark> is rotated in
    some arbitrary way, <TT>pw.x</TT> may not find any symmetry, apart
    from inversion.
</LI>
<LI>they contain a fractional translation that is incompatible with
    the FFT grid (see previous paragraph).
    Note that if you change cutoff or unit cell volume, the
    automatically computed FFT grid changes, and this may explain
    changes in symmetry (and in the number of k-points as a
    consequence) for no apparent good reason (only if you have
    fractional translations in the system, though).
</LI>
<LI>a fractional translation, without rotation, is a symmetry
    operation of the system. This means that the cell is actually 
    a supercell. In this case, all symmetry operations containing 
    fractional translations are disabled.
    The reason is that in this rather exotic case there is no simple
    way to select those symmetry operations forming a true group, in
    the mathematical sense of the term.
</LI>
</UL>

<P>

<H4><A NAME="SECTION000900230000000000000">
8.0.0.23 I don't get the same results in different machines!</A>
</H4>

<P>
If the difference is small, do not panic. It is quite normal for iterative 
methods to reach convergence through different paths as soon as anything 
changes. In particular, between serial and parallel execution there are 
operations that are not performed in the same order. As the numerical 
accuracy of computer numbers is finite, this can yield slightly different 
results.

<P>
It is also normal that the total energy converges to a better accuracy 
than the parts it is composed of. Thus if the convergence threshold is 
for instance 10<SUP>-8</SUP>
<tex2html_verbatim_mark>, you get 8-digit accuracy on the total energy, 
but one or two less on other terms. It is not a problem, but if you mind,
try to reduce the threshold for instance to 10<SUP>-10</SUP>
<tex2html_verbatim_mark> or 10<SUP>-12</SUP>
<tex2html_verbatim_mark>.
The differences should go away (but it will probably take a few more 
iterations to converge).

<P>

<H4><A NAME="SECTION000900240000000000000">
8.0.0.24 the CPU time is time-dependent!</A>
</H4>

<P>
Yes it is!
On most machines and on most operating systems, depending on machine
load, on communication load (for parallel machines), on various other
factors (including maybe the phase of the moon), reported CPU times
may vary quite a lot for the same job.
Also note that what is printed is supposed to be the CPU time per
process, but with some compilers it is actually the wall time.

<P>

<H4><A NAME="SECTION000900250000000000000">
8.0.0.25 ``warning : N eigenvectors not converged ...''</A>
</H4>

<P>
This is a warning message that can be safely ignored if it
is not present in the last steps of self-consistency. If it 
is still present in the last steps of self-consistency, and
if the number of unconverged eigenvector is a significant 
part of the total, it may signal serious trouble in self-consistency
(see next point) or something badly wrong in input data.

<P>

<H4><A NAME="SECTION000900260000000000000">
8.0.0.26 ``warning : negative or imaginary charge...'', or
``...core charge ...'', or ``npt with rhoup&lt;
<tex2html_verbatim_mark>0...'' or ''rhodw&lt;
<tex2html_verbatim_mark>0...'' </A>
</H4>

<P>
These are warning messages that can be safely ignored unless the 
negative or imaginary charge is sizable,
let us say O(0.1). If it is, something seriously 
wrong is going on. Otherwise, the origin of the negative
charge is the following. When one transforms a positive 
function in real space to Fourier space and truncates at 
some finite cutoff, the positive function is no longer 
guaranteed to be positive when transformed back to real 
space. This happens only with core corrections and with 
ultrasoft pseudopotentials. In some cases it may be a 
source of trouble (see next point) but it is usually 
solved by increasing the cutoff for the charge density.

<P>

<H4><A NAME="SECTION000900270000000000000">
8.0.0.27 self-consistency is slow or does not converge.</A>
</H4>

<P>
Reduce <TT>mixing_beta</TT> from the default value (0.7) to <!-- MATH
 $\sim
0.3-0.1$
 -->
<IMG
 WIDTH="20" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="img5.gif"
 ALT="$ \sim$"> 0.3 - 0.1
<tex2html_verbatim_mark> or smaller. Try the <TT>mixing_mode</TT> value that is
more appropriate for your problem. For slab geometries used in surface 
problems or for elongated cells, <TT>mixing_mode='local-TF'</TT> should
be the better choice, dampening ``charge sloshing''.  You may also try to 
increase <TT>mixing_ndim</TT> to more than 8 (default value). Beware: 
the larger <TT>mixing_ndim</TT>, the larger the amount of memory you need.

<P>
If the above doesn't help: verify if your system is metallic or is
close to a metallic state, especially if you have few k-points.
If the highest occupied and lowest unoccupied state(s) keep exchanging
place during self-consistency, forget about reaching convergence. A 
typical sign of such behavior is that the self-consistency error 
goes down, down, down, than all of a sudden up again, and so on.
Usually one can solve the problem by adding a few empty bands and a
broadening.

<P>
Specific to US PP: the presence of negative charge density regions due
to either the pseudization procedure of the augmentation part or to
truncation at finite cutoff may give convergence problems.
Raising the <TT>ecutrho</TT> cutoff for charge density will usually
help, especially in gradient-corrected calculations.

<P>

<H4><A NAME="SECTION000900280000000000000">
8.0.0.28 structural optimization is slow or does not converge.</A>
</H4>

<P>
Typical structural optimizations, based on the BFGS algorithm, converge to 
the default thresholds ( <TT>etot_conv_thr</TT> and 
<TT>forc_conv_thr</TT> ) in 15-25 BFGS steps (depending on the starting 
configuration). This may not happen when your system is characterized by 
``floppy'' low-energy modes, that make very difficult -- and of little use 
anyway -- to reach a well converged structure, no matter what.  Other 
possible reasons for a problematic convergence are listed below.

<P>
Close to convergence the self-consistency error in forces may become
large with respect to the value of forces.  The resulting mismatch
between forces and energies may confuse the line minimization
algorithm, which assumes consistency between the two.  The code
reduces the starting self-consistency threshold
<TT>conv_thr</TT> when approaching the minimum energy configuration,
up to a factor defined by <TT>upscale</TT>.  Reducing
<TT>conv_thr</TT> (or increasing <TT>upscale</TT>) yields a smoother
structural optimization, but if <TT>conv_thr</TT> becomes too small,
electronic self-consistency may not converge.  You may also increase
variables <TT>etot_conv_thr</TT> and
<TT>forc_conv_thr</TT> that determine the threshold for convergence
(the default values are quite strict).

<P>
A limitation to the accuracy of forces comes from the absence of
perfect translational invariance.  If we had only the Hartree
potential, our PW calculation would be translationally invariant to
machine precision.  The presence of an exchange-correlation potential
introduces Fourier components in the potential that are not in our
basis set.  This loss of precision (more serious for
gradient-corrected functionals) translates into a slight but
detectable loss of translational invariance (the energy changes if all
atoms are displaced by the same quantity, not commensurate with the
FFT grid).  This sets a limit to the accuracy of forces.  The
situation improves somewhat by increasing the <TT>ecutrho</TT> cutoff.

<P>

<H4><A NAME="SECTION000900290000000000000">
8.0.0.29 <TT>pw.x</TT> stops during variable-cell optimization
in <TT>checkallsym</TT> with ``non orthogonal operation'' error.</A>
</H4>

<P>
Variable-cell optimization may occasionally break the starting
symmetry of the cell. When this happens, the run is stopped
because the number of k-points calculated for the starting
configuration may no longer be suitable. Possible solutions:

<UL>
<LI>start with a nonsymmetric cell
</LI>
<LI>use a symmetry-conserving algorithm: the Wentzcovitch
algorithm 
<BR>(<TT>cell_dynamics='damp-w'</TT>) shouldn't break the symmetry.
</LI>
</UL>

<P>

<H4><A NAME="SECTION000900300000000000000">
8.0.0.30 Why are codes in PP/ complaining that they do not
find some files?</A>
</H4>

<P>
For Linux PC clusters in parallel execution: in at least some 
versions of MPICH, the current directory is set to the directory where
the <I>executable code</I> resides, instead of being set to the
directory where the code is executed.
This MPICH weirdness may cause unexpected failures in some
postprocessing codes that expect a data file in the current directory.
Workaround: use symbolic links, or copy the executable to the current
directory.

<P>

<H4><A NAME="SECTION000900310000000000000">
8.0.0.31 <TT>ph.x</TT> stops with ``error reading file''.</A>
</H4>

<P>
The data file produced by <TT>pw.x</TT> is bad or incomplete or
produced by an incompatible version of the code.
In parallel execution: if you did not set <TT>wf_collect=.true.</TT>,
the number of processors and pools for the phonon run should be the 
same as for the self-consistent run; all files must be visible to all 
processors.

<P>

<H4><A NAME="SECTION000900320000000000000">
8.0.0.32 <TT>ph.x</TT> mumbles something like ``cannot recover'' or
           ``error reading recover file''.</A>
</H4>

<P>
You have a bad restart file from a preceding failed execution.
Remove all files <TT>recover*</TT> in <TT>outdir</TT>.

<P>

<H4><A NAME="SECTION000900330000000000000">
8.0.0.33 <TT>ph.x</TT> says ``occupation numbers probably wrong''
and continues; or ``phonon + tetrahedra not implemented'' and stops</A>
</H4>

<P>
You have a metallic or spin-polarized system but occupations are not 
set to ``smearing''. Note that the correct way to calculate occupancies 
must be specified in the input data of the non-selfconsistent 
calculation, if the phonon code reads data from it. The non-selfconsistent 
calculation will not use this information but the phonon code will.

<P>

<H4><A NAME="SECTION000900340000000000000">
8.0.0.34 <TT>ph.x</TT> does not yield acoustic modes with <IMG
 WIDTH="17" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="img1.gif"
 ALT="$ \omega$"> = 0
<tex2html_verbatim_mark>
           at <!-- MATH
 $\mathbf{q}=0$
 -->
<B>q</B> = 0
<tex2html_verbatim_mark>.</A>
</H4>

<P>
This may not be an error: the Acoustic Sum Rule (ASR) is never exactly
verified, because the system is never exactly translationally
invariant as it should be (see the discussion above).
The calculated frequency of the acoustic mode is typically less than
10 cm<SUP>-1</SUP>
<tex2html_verbatim_mark>, but in some cases it may be much higher, up to 100
cm<SUP>-1</SUP>
<tex2html_verbatim_mark>.
The ultimate test is to diagonalize the dynamical matrix with program
<TT>dynmat.x</TT>, imposing the ASR.
If you obtain an acoustic mode with a much smaller <IMG
 WIDTH="17" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="img1.gif"
 ALT="$ \omega$">
<tex2html_verbatim_mark> (let's say
&lt; 1
<tex2html_verbatim_mark> cm<SUP>-1</SUP>
<tex2html_verbatim_mark>) with all other modes virtually unchanged, you
can trust your results.

<P>

<H4><A NAME="SECTION000900350000000000000">
8.0.0.35 <TT>ph.x</TT> yields really lousy phonons, with bad or
           negative frequencies or wrong symmetries or gross ASR
           violations.</A>
</H4>

<P>
Possible reasons:

<UL>
<LI>wrong data file read.
</LI>
<LI>wrong atomic masses given in input will yield wrong frequencies
    (but the content of file <TT>fildyn</TT> should be valid, since the
    force constants, not the dynamical matrix, are written to file).
</LI>
<LI>convergence threshold for either SCF (<TT>conv_thr</TT>) or phonon
    calculation (<TT>tr2_ph</TT>) too large (try to reduce them).
</LI>
<LI>maybe your system <I>does</I> have negative or strange phonon
    frequencies, with the approximations you used.
    A negative frequency signals a mechanical instability of the
    chosen structure.
    Check that the structure is reasonable, and check the following
    parameters:
    
<UL>
<LI>The cutoff for wavefunctions, <TT>ecutwfc</TT>
</LI>
<LI>For US PP: the cutoff for the charge density,
            <TT>ecutrho</TT>
</LI>
<LI>The k-point grid, especially for metallic systems!
    
</LI>
</UL>
</LI>
</UL>

<P>

<H4><A NAME="SECTION000900360000000000000">
8.0.0.36 ``Wrong degeneracy'' error in star_q.</A>
</H4>

<P>
Verify the <B>q</B>-point for which you are calculating phonons.
In order to check whether a symmetry operation belongs to the small
group of <B>q</B>, the code compares <B>q</B> and the rotated
<B>q</B>, with an acceptance tolerance of 10<SUP>-5</SUP>
<tex2html_verbatim_mark> (set in routine
<TT>PW/eqvect.f90</TT>).
You may run into trouble if your <B>q</B>-point differs from a
high-symmetry point by an amount in that order of magnitude.

<P>
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html534"
  HREF="node24.html#SECTION00090010000000000000">8.0.0.1 <TT>pw.x</TT> yields a message like ``error while loading
           shared libraries: ... cannot open shared object file''
           and does not start.</A>
<LI><A NAME="tex2html535"
  HREF="node24.html#SECTION00090020000000000000">8.0.0.2 errors in examples with parallel execution</A>
<LI><A NAME="tex2html536"
  HREF="node24.html#SECTION00090030000000000000">8.0.0.3 <TT>pw.x</TT> prints the first few lines and then nothing
happens (parallel execution).</A>
<LI><A NAME="tex2html537"
  HREF="node24.html#SECTION00090040000000000000">8.0.0.4 <TT>pw.x</TT> stops with error in reading.</A>
<LI><A NAME="tex2html538"
  HREF="node24.html#SECTION00090050000000000000">8.0.0.5 <TT>pw.x</TT> mumbles something like ``cannot recover'' or
           ``error reading recover file''.</A>
<LI><A NAME="tex2html539"
  HREF="node24.html#SECTION00090060000000000000">8.0.0.6 <TT>pw.x</TT> stops with ``inconsistent DFT'' error.</A>
<LI><A NAME="tex2html540"
  HREF="node24.html#SECTION00090070000000000000">8.0.0.7 <TT>pw.x</TT> stops with error in cdiaghg or rdiaghg.</A>
<LI><A NAME="tex2html541"
  HREF="node24.html#SECTION00090080000000000000">8.0.0.8 <TT>pw.x</TT> crashes with ``floating invalid'' or 
``floating divide by zero''.</A>
<LI><A NAME="tex2html542"
  HREF="node24.html#SECTION00090090000000000000">8.0.0.9 <TT>pw.x</TT> crashes with no error message at all.</A>
<LI><A NAME="tex2html543"
  HREF="node24.html#SECTION000900100000000000000">8.0.0.10 <TT>pw.x</TT> crashes with ``segmentation fault'' or
           similarly obscure messages.</A>
<LI><A NAME="tex2html544"
  HREF="node24.html#SECTION000900110000000000000">8.0.0.11 <TT>pw.x</TT> works for simple systems, but not for large
           systems or whenever more RAM is needed.</A>
<LI><A NAME="tex2html545"
  HREF="node24.html#SECTION000900120000000000000">8.0.0.12 <TT>pw.x</TT> crashes in parallel execution with an obscure
            message related to MPI errors.</A>
<LI><A NAME="tex2html546"
  HREF="node24.html#SECTION000900130000000000000">8.0.0.13 <TT>pw.x</TT> runs but nothing happens.</A>
<LI><A NAME="tex2html547"
  HREF="node24.html#SECTION000900140000000000000">8.0.0.14 <TT>pw.x</TT> yields weird results.</A>
<LI><A NAME="tex2html548"
  HREF="node24.html#SECTION000900150000000000000">8.0.0.15 <TT>pw.x</TT> stops with error message ``the system is
           metallic, specify occupations''.</A>
<LI><A NAME="tex2html549"
  HREF="node24.html#SECTION000900160000000000000">8.0.0.16 <TT>pw.x</TT> stops with ``internal error: cannot braket Ef'' in
           <TT>efermig</TT>.</A>
<LI><A NAME="tex2html550"
  HREF="node24.html#SECTION000900170000000000000">8.0.0.17 <TT>pw.x</TT> yields ``internal error: cannot braket Ef'' message
in <TT>efermit</TT>, then stops because ``charge is incorrect''.</A>
<LI><A NAME="tex2html551"
  HREF="node24.html#SECTION000900180000000000000">8.0.0.18 <TT>pw.x</TT> yields ``internal error: cannot braket Ef'' message
in <TT>efermit</TT> but doesn't stop.</A>
<LI><A NAME="tex2html552"
  HREF="node24.html#SECTION000900190000000000000">8.0.0.19 in parallel execution, <TT>pw.x</TT> stops complaining that
           ``some processors have no planes'' or ``smooth planes'' or
           some other strange error.</A>
<LI><A NAME="tex2html553"
  HREF="node24.html#SECTION000900200000000000000">8.0.0.20 the FFT grids in <TT>pw.x</TT> are machine-dependent.</A>
<LI><A NAME="tex2html554"
  HREF="node24.html#SECTION000900210000000000000">8.0.0.21 ``warning: symmetry operation # N not allowed''.</A>
<LI><A NAME="tex2html555"
  HREF="node24.html#SECTION000900220000000000000">8.0.0.22 <TT>pw.x</TT> doesn't find all the symmetries you
           expected.</A>
<LI><A NAME="tex2html556"
  HREF="node24.html#SECTION000900230000000000000">8.0.0.23 I don't get the same results in different machines!</A>
<LI><A NAME="tex2html557"
  HREF="node24.html#SECTION000900240000000000000">8.0.0.24 the CPU time is time-dependent!</A>
<LI><A NAME="tex2html558"
  HREF="node24.html#SECTION000900250000000000000">8.0.0.25 ``warning : N eigenvectors not converged ...''</A>
<LI><A NAME="tex2html559"
  HREF="node24.html#SECTION000900260000000000000">8.0.0.26 ``warning : negative or imaginary charge...'', or
``...core charge ...'', or ``npt with rhoup&lt;
<tex2html_verbatim_mark>0...'' or ''rhodw&lt;
<tex2html_verbatim_mark>0...'' </A>
<LI><A NAME="tex2html560"
  HREF="node24.html#SECTION000900270000000000000">8.0.0.27 self-consistency is slow or does not converge.</A>
<LI><A NAME="tex2html561"
  HREF="node24.html#SECTION000900280000000000000">8.0.0.28 structural optimization is slow or does not converge.</A>
<LI><A NAME="tex2html562"
  HREF="node24.html#SECTION000900290000000000000">8.0.0.29 <TT>pw.x</TT> stops during variable-cell optimization
in <TT>checkallsym</TT> with ``non orthogonal operation'' error.</A>
<LI><A NAME="tex2html563"
  HREF="node24.html#SECTION000900300000000000000">8.0.0.30 Why are codes in PP/ complaining that they do not
find some files?</A>
<LI><A NAME="tex2html564"
  HREF="node24.html#SECTION000900310000000000000">8.0.0.31 <TT>ph.x</TT> stops with ``error reading file''.</A>
<LI><A NAME="tex2html565"
  HREF="node24.html#SECTION000900320000000000000">8.0.0.32 <TT>ph.x</TT> mumbles something like ``cannot recover'' or
           ``error reading recover file''.</A>
<LI><A NAME="tex2html566"
  HREF="node24.html#SECTION000900330000000000000">8.0.0.33 <TT>ph.x</TT> says ``occupation numbers probably wrong''
and continues; or ``phonon + tetrahedra not implemented'' and stops</A>
<LI><A NAME="tex2html567"
  HREF="node24.html#SECTION000900340000000000000">8.0.0.34 <TT>ph.x</TT> does not yield acoustic modes with <IMG
 WIDTH="17" HEIGHT="19" ALIGN="BOTTOM" BORDER="0"
 SRC="img1.gif"
 ALT="$ \omega$"> = 0
<tex2html_verbatim_mark>
           at <!-- MATH
 $\mathbf{q}=0$
 -->
<B>q</B> = 0
<tex2html_verbatim_mark>.</A>
<LI><A NAME="tex2html568"
  HREF="node24.html#SECTION000900350000000000000">8.0.0.35 <TT>ph.x</TT> yields really lousy phonons, with bad or
           negative frequencies or wrong symmetries or gross ASR
           violations.</A>
<LI><A NAME="tex2html569"
  HREF="node24.html#SECTION000900360000000000000">8.0.0.36 ``Wrong degeneracy'' error in star_q.</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>
<!--Navigation Panel-->
<A NAME="tex2html532"
  HREF="node25.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.gif"></A> 
<A NAME="tex2html528"
  HREF="users-guide.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.gif"></A> 
<A NAME="tex2html522"
  HREF="node23.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.gif"></A> 
<A NAME="tex2html530"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html533"
  HREF="node25.html">9 Frequently Asked Questions</A>
<B> Up:</B> <A NAME="tex2html529"
  HREF="users-guide.html">User's Guide for Quantum-ESPRESSO</A>
<B> Previous:</B> <A NAME="tex2html523"
  HREF="node23.html">7.4 Parallelization issues</A>
   <B>  <A NAME="tex2html531"
  HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
Paolo Giannozzi
2008-05-14
</ADDRESS>
</BODY>
</HTML>
